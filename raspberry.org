#+PROPERTY: header-args+ :var  JRR5_IP_="192.168.1.241"
#+PROPERTY: header-args+ :var  JRR5_IP="jrr5.local"
#+PROPERTY: header-args+ :var  CONDA_ENV="pyyton3"

Somewhat dirtyish trick to be able to tangle files pointed by a global property.

#+BEGIN_SRC elisp :eval no-export :exports none
(defun jj-org-tmp-get-global-prop ( prop )
  "Read global org property 'prop'"
(let ((keyVal 
       (seq-find (lambda (x) (string= (car(split-string  x "=")) prop))
		 (org-babel--get-vars (org-babel-parse-header-arguments (org-entry-get-with-inheritance "header-args")))
		)))	
  (if keyVal (string-trim  (nth 1 (split-string keyVal "=" )) "\""  "\""  )))
)
#+END_SRC

#+RESULTS:
: jj-org-tmp-get-global-prop

* Design
** PCB design

[[file:jrr-pcb.org]]

** 3.5inch TFT display

In jrr.org

#+begin_example
ssh pi@$IP  "cd LCD-show; sudo ./MHS35-show"

#+end_example

Search for MHS35-show finds

http://www.lcdwiki.com/MHS-3.5inch_RPi_Display#Product_Features

with specs

| Name                                  | Description                          |
|---------------------------------------+--------------------------------------|
| SKU                                   | MHS3528                              |
| Screen Size                           | 3.5inch                              |
| LCD Type                              | TFT                                  |
| Module Interface                      | SPI (upports up to 125MHz SPI input) |
| Resolution                            | 320*480 (Pixel)                      |
| Touch Screen Controller               | XPT2046                              |
| LCD Driver IC                         | ILI9486                              |
| Backlight                             | LED                                  |
| power consumption                     | 0.16A*5V                             |
| Working temperature）                 | -20~60                               |
| Active Area                           | 48.96x73.44(mm)                      |
| Module PCB Size                       | 85.42*55.60 (mm)                     |
| Package Size                          | 136x98x41 (mm)                       |
| Product Weight(Package containing)(g) | 92 (g)                               |


Especially LCD Driver IC ~ILI9486~

Locate ILI9486 python driver https://github.com/SirLefti/Python_ILI9486

** Raspberry PI pinout

https://pinout.xyz/

** Physical design

https://datasheets.raspberrypi.com/rpi3/raspberry-pi-3-b-plus-product-brief.pdf

[[file:pics-keep/RPI-physical-dimensions.png]]

** Current

Mitattu USB virrankultus jrr1
- n. 0.37A max volyymi
- n. 0.57A max virta

--> 1.1A sulake ok

--> USB-C current resistores
   - https://community.infineon.com/t5/Knowledge-Base-Articles/USB-Type-C-connector-Rp-Rd-and-Ra-termination-resistors/ta-p/253544

     DFP Advertisement 	     Resistor Pull-up to
     4.75 V – 5.5 V 	     Resistor Pull-up to
     3.3 ± 5%
     Default USB power 	     56 kΩ ± 20% 	     36 kΩ ± 20%
     1.5 A at 5 V 	     22 kΩ ± 5% 	     12 kΩ ± 5%
     3.0 A at 5 V 	     10 kΩ ± 5% 	     4.7 kΩ ± 5%

| DFP Advertisement | Pull-up to 4.75 V – 5.5 V | Pull-up to 3.3 ± 5% |
|-------------------+---------------------------+---------------------|
| Default USB power | 56 kΩ ± 20%               | 36 kΩ ± 20%         |
| 1.5 A at 5 V      | 22 kΩ ± 5%                | 12 kΩ ± 5%          |
| 3.0 A at 5 V      | 10 kΩ ± 5%                | 4.7 kΩ ± 5%         |

--> 22kOhm     

* Establish ssh connection in Raspberry
** Insert SD card && ping

Insert SD, and boot Raspberry. Set ~JRR5_IP~

#+BEGIN_SRC bash :eval no-export :results output
echo JRR5_IP=$JRR5_IP
#+END_SRC

#+RESULTS:
: JRR5_IP=jrr5.local

and expect succesful ping
#+call: ping-ip()

#+RESULTS:
: Ping JRR5_IP=192.168.1.241 on ti 19.11.2024 13.36.53 +0200
: PING 192.168.1.241 (192.168.1.241) 56(84) bytes of data.
: 64 bytes from 192.168.1.241: icmp_seq=1 ttl=64 time=112 ms
: 64 bytes from 192.168.1.241: icmp_seq=2 ttl=64 time=5.19 ms
: 64 bytes from 192.168.1.241: icmp_seq=3 ttl=64 time=5.70 ms
: 
: --- 192.168.1.241 ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2002ms
: rtt min/avg/max/mdev = 5.190/40.927/111.888/50.177 ms

** Establish ssh connection and copy ssh-identity

#+BEGIN_SRC bash :eval no-export :results output
echo JRR5_IP=$JRR5_IP
#+END_SRC

#+RESULTS:
: JRR5_IP=jrr5.local




#+call: ping-ip()

#+RESULTS:
: Ping JRR5_IP=jrr5.local on to 5.6.2025 09.28.50 +0300
: PING jrr5.local (192.168.125.236) 56(84) bytes of data.
: 64 bytes from jrr5.localdomain (192.168.125.236): icmp_seq=1 ttl=64 time=1235 ms
: 64 bytes from jrr5.localdomain (192.168.125.236): icmp_seq=2 ttl=64 time=227 ms
: 64 bytes from jrr5.localdomain (192.168.125.236): icmp_seq=3 ttl=64 time=237 ms
: 
: --- jrr5.local ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2009ms
: rtt min/avg/max/mdev = 227.099/566.210/1234.892/472.845 ms, pipe 2



Paste from command line
#+BEGIN_SRC sh :eval no-export :results output
echo ssh-copy-id -i ~/.ssh/id_rsa pi@$JRR5_IP
#+END_SRC

#+RESULTS:
: ssh-copy-id -i /home/jj/.ssh/id_rsa pi@192.168.110.73

Test it
#+BEGIN_SRC bash :eval no-export :results output 
ssh pi@$JRR5_IP hostname
#+END_SRC

#+RESULTS:
: jrr5

#+call: greet-tramp()

#+RESULTS:
: Greet ti 1.7.2025 10.33.54 +0300 from host 'eero' (using eshell tramp)


** Create entry into ~.ssh/config~

#+call: ping-ip[:dir "."]()

#+RESULTS:
: Ping JRR5_IP=jrr5.local on to 5.6.2025 09.29.08 +0300
: PING jrr5.local (192.168.125.236) 56(84) bytes of data.
: 64 bytes from jrr5.localdomain (192.168.125.236): icmp_seq=1 ttl=64 time=2.53 ms
: 64 bytes from jrr5.localdomain (192.168.125.236): icmp_seq=2 ttl=64 time=4.55 ms
: 64 bytes from jrr5.localdomain (192.168.125.236): icmp_seq=3 ttl=64 time=5.66 ms
: 
: --- jrr5.local ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2003ms
: rtt min/avg/max/mdev = 2.533/4.248/5.660/1.294 ms




#+BEGIN_SRC bash :eval no-export :results output
FILE=~/.ssh/config
START="added by raspberry.org in jrr5 - start"
END="added by raspberry.org in jrr5 - end"

sed -i -e "/$START/,/$END/d" $FILE

cat <<HERE >> $FILE
# $START
host jrr5
     user pi
     IdentityFile ~/.ssh/id_rsa
     hostname ${JRR5_IP}
# $END
HERE
#+END_SRC

#+RESULTS:

Test eshell in ~:dir /ssh:jrr5:~

#+BEGIN_SRC bash :eval no-export :results output :dir /ssh:jrr5:
pwd
hostname
date
#+END_SRC

#+RESULTS:
: /home/pi
: jrr5
: Tue Nov 19 13:42:23 EET 2024


#+BEGIN_SRC bash :eval no-export :results output
# ssh sorsa hostname
ssh jrr5 "hostname;pwd;date"
#+END_SRC

#+RESULTS:
: jrr5
: /home/pi
: Tue Nov 19 13:42:11 EET 2024

#+call: hosti()

#+RESULTS:
: jrr5 on Tue Nov 19 13:43:38 EET 2024


#+call: hosti[:dir .]()

#+RESULTS:
: eero on ti 19.11.2024 13.43.56 +0200

* OS install & config
:PROPERTIES:
:header-args+: :dir  /ssh:jrr5:
:END:
** ~vlc~: vlc playrer


#+call: apt-install(PKG="vlc")

#+RESULTS:
: Running 'sudo apt install -y vlc' in host 'jrr5' on Wed Nov 20 14:31:34 EET 2024
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 67%Building dependency tree... 97%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: vlc is already the newest version (1:3.0.21-0+rpt3+deb12u1).
: 0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.

Ensure that ffmpgeg is installed

#+BEGIN_SRC bash :eval no-export :results output :dir /ssh:jrr5:
echo "Running in host $(hostname) on $(date)"
ffmpeg --help 2>&1; true
#+END_SRC

#+RESULTS:
#+begin_example
Running in host jrr5 on Wed Nov 20 14:39:18 EET 2024
ffmpeg version 5.1.6-0+deb12u1+rpt1 Copyright (c) 2000-2024 the FFmpeg developers
  built with gcc 12 (Debian 12.2.0-14)
  configuration: --prefix=/usr --extra-version=0+deb12u1+rpt1 --toolchain=hardened --incdir=/usr/include/aarch64-linux-gnu --enable-gpl --disable-stripping --disable-mmal --enable-gnutls --enable-ladspa --enable-libaom --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libjack --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librabbitmq --enable-librist --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-libzmq --enable-libzvbi --enable-lv2 --enable-omx --enable-openal --enable-opencl --enable-opengl --enable-sand --enable-sdl2 --disable-sndio --enable-libjxl --enable-neon --enable-v4l2-request --enable-libudev --enable-epoxy --libdir=/usr/lib/aarch64-linux-gnu --arch=arm64 --enable-pocketsphinx --enable-librsvg --enable-libdc1394 --enable-libdrm --enable-vout-drm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libx264 --enable-libplacebo --enable-librav1e --enable-shared
  libavutil      57. 28.100 / 57. 28.100
  libavcodec     59. 37.100 / 59. 37.100
  libavformat    59. 27.100 / 59. 27.100
  libavdevice    59.  7.100 / 59.  7.100
  libavfilter     8. 44.100 /  8. 44.100
  libswscale      6.  7.100 /  6.  7.100
  libswresample   4.  7.100 /  4.  7.100
  libpostproc    56.  6.100 / 56.  6.100
Hyper fast Audio and Video encoder
usage: ffmpeg [options] [[infile options] -i infile]... {[outfile options] outfile}...

Getting help:
    -h      -- print basic options
    -h long -- print more options
    -h full -- print all options (including all format and codec specific options, very long)
    -h type=name -- print all options for the named decoder/encoder/demuxer/muxer/filter/bsf/protocol
    See man ffmpeg for detailed description of the options.

Print help / information / capabilities:
-L                  show license
-h topic            show help
-? topic            show help
-help topic         show help
--help topic        show help
-version            show version
-buildconf          show build configuration
-formats            show available formats
-muxers             show available muxers
-demuxers           show available demuxers
-devices            show available devices
-codecs             show available codecs
-decoders           show available decoders
-encoders           show available encoders
-bsfs               show available bit stream filters
-protocols          show available protocols
-filters            show available filters
-pix_fmts           show available pixel formats
-layouts            show standard channel layouts
-sample_fmts        show available audio sample formats
-dispositions       show available stream dispositions
-colors             show available color names
-sources device     list sources of the input device
-sinks device       list sinks of the output device
-hwaccels           show available HW acceleration methods

Global options (affect whole program instead of just one file):
-loglevel loglevel  set logging level
-v loglevel         set logging level
-report             generate a report
-max_alloc bytes    set maximum size of a single allocated block
-y                  overwrite output files
-n                  never overwrite output files
-ignore_unknown     Ignore unknown stream types
-filter_threads     number of non-complex filter threads
-filter_complex_threads  number of threads for -filter_complex
-stats              print progress report during encoding
-max_error_rate maximum error rate  ratio of decoding errors (0.0: no errors, 1.0: 100% errors) above which ffmpeg returns an error instead of success.
-vol volume         change audio volume (256=normal)

Per-file main options:
-f fmt              force format
-c codec            codec name
-codec codec        codec name
-pre preset         preset name
-map_metadata outfile[,metadata]:infile[,metadata]  set metadata information of outfile from infile
-t duration         record or transcode "duration" seconds of audio/video
-to time_stop       record or transcode stop time
-fs limit_size      set the limit file size in bytes
-ss time_off        set the start time offset
-sseof time_off     set the start time offset relative to EOF
-seek_timestamp     enable/disable seeking by timestamp with -ss
-timestamp time     set the recording timestamp ('now' to set the current time)
-metadata string=string  add metadata
-program title=string:st=number...  add program with specified streams
-target type        specify target file type ("vcd", "svcd", "dvd", "dv" or "dv50" with optional prefixes "pal-", "ntsc-" or "film-")
-apad               audio pad
-frames number      set the number of frames to output
-filter filter_graph  set stream filtergraph
-filter_script filename  read stream filtergraph description from a file
-reinit_filter      reinit filtergraph on input parameter changes
-discard            discard
-disposition        disposition

Video options:
-vframes number     set the number of video frames to output
-r rate             set frame rate (Hz value, fraction or abbreviation)
-fpsmax rate        set max frame rate (Hz value, fraction or abbreviation)
-s size             set frame size (WxH or abbreviation)
-aspect aspect      set aspect ratio (4:3, 16:9 or 1.3333, 1.7777)
-vn                 disable video
-vcodec codec       force video codec ('copy' to copy stream)
-timecode hh:mm:ss[:;.]ff  set initial TimeCode value.
-pass n             select the pass number (1 to 3)
-vf filter_graph    set video filters
-ab bitrate         audio bitrate (please use -b:a)
-b bitrate          video bitrate (please use -b:v)
-dn                 disable data

Audio options:
-aframes number     set the number of audio frames to output
-aq quality         set audio quality (codec-specific)
-ar rate            set audio sampling rate (in Hz)
-ac channels        set number of audio channels
-an                 disable audio
-acodec codec       force audio codec ('copy' to copy stream)
-vol volume         change audio volume (256=normal)
-af filter_graph    set audio filters

Subtitle options:
-s size             set frame size (WxH or abbreviation)
-sn                 disable subtitle
-scodec codec       force subtitle codec ('copy' to copy stream)
-stag fourcc/tag    force subtitle tag/fourcc
-fix_sub_duration   fix subtitles duration
-canvas_size size   set canvas size (WxH or abbreviation)
-spre preset        set the subtitle options to the indicated preset


#+end_example

Generate sine wave in ~tmp/sine_1000.wav~

Ref: https://stackoverflow.com/questions/5109038/linux-sine-wave-audio-generator

#+BEGIN_SRC bash :eval no-export :results output :dir /ssh:jrr5:
echo "Running in $(pwd) in host '$(hostname)' on $(date)"
FILE="tmp/sine_1000.wav"
rm -f $FILE
ffmpeg -f lavfi -i "sine=f=1000:d=2" -ac 2 -y -nostdin $FILE 2>&1; true
ls -ltr $FILE
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi in host 'jrr5' on Wed Nov 20 14:52:03 EET 2024
ffmpeg version 5.1.6-0+deb12u1+rpt1 Copyright (c) 2000-2024 the FFmpeg developers
  built with gcc 12 (Debian 12.2.0-14)
  configuration: --prefix=/usr --extra-version=0+deb12u1+rpt1 --toolchain=hardened --incdir=/usr/include/aarch64-linux-gnu --enable-gpl --disable-stripping --disable-mmal --enable-gnutls --enable-ladspa --enable-libaom --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libcdio --enable-libcodec2 --enable-libdav1d --enable-libflite --enable-libfontconfig --enable-libfreetype --enable-libfribidi --enable-libglslang --enable-libgme --enable-libgsm --enable-libjack --enable-libmp3lame --enable-libmysofa --enable-libopenjpeg --enable-libopenmpt --enable-libopus --enable-libpulse --enable-librabbitmq --enable-librist --enable-librubberband --enable-libshine --enable-libsnappy --enable-libsoxr --enable-libspeex --enable-libsrt --enable-libssh --enable-libsvtav1 --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvorbis --enable-libvpx --enable-libwebp --enable-libx265 --enable-libxml2 --enable-libxvid --enable-libzimg --enable-libzmq --enable-libzvbi --enable-lv2 --enable-omx --enable-openal --enable-opencl --enable-opengl --enable-sand --enable-sdl2 --disable-sndio --enable-libjxl --enable-neon --enable-v4l2-request --enable-libudev --enable-epoxy --libdir=/usr/lib/aarch64-linux-gnu --arch=arm64 --enable-pocketsphinx --enable-librsvg --enable-libdc1394 --enable-libdrm --enable-vout-drm --enable-libiec61883 --enable-chromaprint --enable-frei0r --enable-libx264 --enable-libplacebo --enable-librav1e --enable-shared
  libavutil      57. 28.100 / 57. 28.100
  libavcodec     59. 37.100 / 59. 37.100
  libavformat    59. 27.100 / 59. 27.100
  libavdevice    59.  7.100 / 59.  7.100
  libavfilter     8. 44.100 /  8. 44.100
  libswscale      6.  7.100 /  6.  7.100
  libswresample   4.  7.100 /  4.  7.100
  libpostproc    56.  6.100 / 56.  6.100
Input #0, lavfi, from 'sine=f=1000:d=2':
  Duration: N/A, start: 0.000000, bitrate: 705 kb/s
  Stream #0:0: Audio: pcm_s16le, 44100 Hz, mono, s16, 705 kb/s
Stream mapping:
  Stream #0:0 -> #0:0 (pcm_s16le (native) -> pcm_s16le (native))
Output #0, wav, to 'tmp/sine_1000.wav':
  Metadata:
    ISFT            : Lavf59.27.100
  Stream #0:0: Audio: pcm_s16le ([1][0][0][0] / 0x0001), 44100 Hz, stereo, s16, 1411 kb/s
    Metadata:
      encoder         : Lavc59.37.100 pcm_s16le
size=       4kB time=00:00:00.02 bitrate=1438.1kbits/s speed=1.16e+04x    size=     345kB time=00:00:02.00 bitrate=1411.5kbits/s speed=65.2x    
video:0kB audio:345kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.022109%
-rw-r--r-- 1 pi pi 352878 Nov 20 14:52 tmp/sine_1000.wav
#+end_example
** ~audacity~: the world's most popular audio editing and recording app

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"

#+END_SRC

#+RESULTS:
: Running in host 'jrr5' on Tue Nov 26 10:31:46 EET 2024

#+BEGIN_SRC bash :eval no-export :results output
sudo apt-get -y install audacity
#+END_SRC

#+RESULTS:
#+begin_example
Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 57%Building dependency tree... 76%Building dependency tree... 96%Building dependency tree... Done
Reading state information... 0% Reading state information... 0%Reading state information... Done
The following additional packages will be installed:
  audacity-data libflac++10 libpcre2-32-0 libportaudio2 libportsmf0 libsbsms10
  libsuil-0-0 libvamp-hostsdk3v5 libwxbase3.2-1 libwxgtk3.2-1
Suggested packages:
  ladspa-plugin
The following NEW packages will be installed:
  audacity audacity-data libflac++10 libpcre2-32-0 libportaudio2 libportsmf0
  libsbsms10 libsuil-0-0 libvamp-hostsdk3v5 libwxbase3.2-1 libwxgtk3.2-1
0 upgraded, 11 newly installed, 0 to remove and 9 not upgraded.
Need to get 12.7 MB of archives.
After this operation, 61.3 MB of additional disk space will be used.
0% [Working]            Get:1 http://deb.debian.org/debian bookworm/main arm64 audacity-data all 3.2.4+dfsg-1 [2409 kB]
0% [1 audacity-data 0 B/2409 kB 0%]11% [1 audacity-data 1679 kB/2409 kB 70%]                                         17% [Working]             Get:2 http://deb.debian.org/debian bookworm/main arm64 libflac++10 arm64 1.4.2+ds-2 [50.4 kB]
17% [2 libflac++10 2888 B/50.4 kB 6%]                                     19% [Working]             Get:3 http://deb.debian.org/debian bookworm/main arm64 libportaudio2 arm64 19.6.0-1.2 [61.2 kB]
19% [3 libportaudio2 2335 B/61.2 kB 4%]                                       21% [Working]             Get:4 http://deb.debian.org/debian bookworm/main arm64 libportsmf0 arm64 0.1~svn20101010-6 [52.3 kB]
21% [4 libportsmf0 5776 B/52.3 kB 11%]                                      23% [Working]             Get:5 http://deb.debian.org/debian bookworm/main arm64 libsbsms10 arm64 2.3.0-1 [100 kB]
23% [5 libsbsms10 0 B/100 kB 0%]                                26% [Working]             Get:6 http://deb.debian.org/debian bookworm/main arm64 libsuil-0-0 arm64 0.10.18-1 [26.2 kB]
26% [6 libsuil-0-0 9433 B/26.2 kB 36%]                                      28% [Working]             Get:7 http://deb.debian.org/debian bookworm/main arm64 libvamp-hostsdk3v5 arm64 2.10.0-3 [81.7 kB]
28% [7 libvamp-hostsdk3v5 769 B/81.7 kB 1%]                                           30% [Working]             Get:8 http://deb.debian.org/debian bookworm/main arm64 libpcre2-32-0 arm64 10.42-1 [207 kB]
30% [8 libpcre2-32-0 15.5 kB/207 kB 8%]                                       33% [Working]             Get:9 http://deb.debian.org/debian bookworm/main arm64 libwxbase3.2-1 arm64 3.2.2+dfsg-2 [835 kB]
33% [9 libwxbase3.2-1 2966 B/835 kB 0%]                                       40% [Working]             Get:10 http://deb.debian.org/debian bookworm/main arm64 libwxgtk3.2-1 arm64 3.2.2+dfsg-2 [3984 kB]
40% [10 libwxgtk3.2-1 153 B/3984 kB 0%]51% [10 libwxgtk3.2-1 1615 kB/3984 kB 41%]61% [10 libwxgtk3.2-1 3242 kB/3984 kB 81%]                                          67% [Working]             Get:11 http://deb.debian.org/debian bookworm/main arm64 audacity arm64 3.2.4+dfsg-1 [4880 kB]
68% [11 audacity 21.2 kB/4880 kB 0%]77% [11 audacity 1571 kB/4880 kB 32%]88% [11 audacity 3250 kB/4880 kB 67%]98% [11 audacity 4807 kB/4880 kB 98%]                                     100% [Working]              Fetched 12.7 MB in 4s (3109 kB/s)
Selecting previously unselected package audacity-data.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 128596 files and directories currently installed.)
Preparing to unpack .../00-audacity-data_3.2.4+dfsg-1_all.deb ...
Unpacking audacity-data (3.2.4+dfsg-1) ...
Selecting previously unselected package libflac++10:arm64.
Preparing to unpack .../01-libflac++10_1.4.2+ds-2_arm64.deb ...
Unpacking libflac++10:arm64 (1.4.2+ds-2) ...
Selecting previously unselected package libportaudio2:arm64.
Preparing to unpack .../02-libportaudio2_19.6.0-1.2_arm64.deb ...
Unpacking libportaudio2:arm64 (19.6.0-1.2) ...
Selecting previously unselected package libportsmf0:arm64.
Preparing to unpack .../03-libportsmf0_0.1~svn20101010-6_arm64.deb ...
Unpacking libportsmf0:arm64 (0.1~svn20101010-6) ...
Selecting previously unselected package libsbsms10:arm64.
Preparing to unpack .../04-libsbsms10_2.3.0-1_arm64.deb ...
Unpacking libsbsms10:arm64 (2.3.0-1) ...
Selecting previously unselected package libsuil-0-0:arm64.
Preparing to unpack .../05-libsuil-0-0_0.10.18-1_arm64.deb ...
Unpacking libsuil-0-0:arm64 (0.10.18-1) ...
Selecting previously unselected package libvamp-hostsdk3v5:arm64.
Preparing to unpack .../06-libvamp-hostsdk3v5_2.10.0-3_arm64.deb ...
Unpacking libvamp-hostsdk3v5:arm64 (2.10.0-3) ...
Selecting previously unselected package libpcre2-32-0:arm64.
Preparing to unpack .../07-libpcre2-32-0_10.42-1_arm64.deb ...
Unpacking libpcre2-32-0:arm64 (10.42-1) ...
Selecting previously unselected package libwxbase3.2-1:arm64.
Preparing to unpack .../08-libwxbase3.2-1_3.2.2+dfsg-2_arm64.deb ...
Unpacking libwxbase3.2-1:arm64 (3.2.2+dfsg-2) ...
Selecting previously unselected package libwxgtk3.2-1:arm64.
Preparing to unpack .../09-libwxgtk3.2-1_3.2.2+dfsg-2_arm64.deb ...
Unpacking libwxgtk3.2-1:arm64 (3.2.2+dfsg-2) ...
Selecting previously unselected package audacity.
Preparing to unpack .../10-audacity_3.2.4+dfsg-1_arm64.deb ...
Unpacking audacity (3.2.4+dfsg-1) ...
Setting up libportaudio2:arm64 (19.6.0-1.2) ...
Setting up libvamp-hostsdk3v5:arm64 (2.10.0-3) ...
Setting up audacity-data (3.2.4+dfsg-1) ...
Setting up libportsmf0:arm64 (0.1~svn20101010-6) ...
Setting up libsuil-0-0:arm64 (0.10.18-1) ...
Setting up libflac++10:arm64 (1.4.2+ds-2) ...
Setting up libpcre2-32-0:arm64 (10.42-1) ...
Setting up libsbsms10:arm64 (2.3.0-1) ...
Setting up libwxbase3.2-1:arm64 (3.2.2+dfsg-2) ...
Setting up libwxgtk3.2-1:arm64 (3.2.2+dfsg-2) ...
Setting up audacity (3.2.4+dfsg-1) ...
Processing triggers for shared-mime-info (2.2-1) ...
Processing triggers for mailcap (3.70+nmu1) ...
Processing triggers for desktop-file-utils (0.26-1) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for gnome-menus (3.36.0-1.1) ...
Processing triggers for libc-bin (2.36-9+rpt2+deb12u9) ...
Processing triggers for man-db (2.11.2-2) ...
#+end_example
** ~evtest~

#+call: apt-update()

#+RESULTS:
: Running 'sudo apt-get update' in host 'jrr5' on Fri Mar 14 15:23:39 EET 2025
: 0% [Working]            Hit:1 http://deb.debian.org/debian bookworm InRelease
: 0% [Connecting to archive.raspberrypi.com]                                          Hit:2 http://deb.debian.org/debian-security bookworm-security InRelease
:                                           Get:3 http://deb.debian.org/debian bookworm-updates InRelease [55.4 kB]
: 0% [Connecting to archive.raspberrypi.com (46.235.231.111)]                                                           Get:4 http://archive.raspberrypi.com/debian bookworm InRelease [39.3 kB]
:                                                            0% [4 InRelease 14.2 kB/39.3 kB 36%]                                    0% [Working]0% [Working]0% [Working]0% [Working]0% [Working]26% [Working]             Get:5 http://archive.raspberrypi.com/debian bookworm/main arm64 Packages [518 kB]
: 26% [5 Packages 5547 B/518 kB 1%]                                 62% [Working]62% [5 Packages store 0 B] [Waiting for headers]                                                Get:6 http://archive.raspberrypi.com/debian bookworm/main armhf Packages [546 kB]
: 62% [5 Packages store 0 B] [6 Packages 5547 B/546 kB 1%]                                                        82% [6 Packages 295 kB/546 kB 54%]                                  100% [Working]100% [6 Packages store 0 B]                           100% [Working]              Fetched 1158 kB in 3s (380 kB/s)
: Reading package lists... 0%Reading package lists... 0%Reading package lists... 0%Reading package lists... 10%Reading package lists... 19%Reading package lists... 28%Reading package lists... 34%Reading package lists... 34%Reading package lists... 36%Reading package lists... 47%Reading package lists... 58%Reading package lists... 67%Reading package lists... 68%Reading package lists... 68%Reading package lists... 78%Reading package lists... 90%Reading package lists... 91%Reading package lists... 91%Reading package lists... 91%Reading package lists... 91%Reading package lists... 91%Reading package lists... 91%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 92%Reading package lists... 94%Reading package lists... 94%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 95%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 96%Reading package lists... 97%Reading package lists... 97%Reading package lists... 98%Reading package lists... 98%Reading package lists... 99%Reading package lists... Done

#+call: apt-install(PKG="evtest")

#+RESULTS:
#+begin_example
Running 'sudo apt install -y evtest' in host 'jrr5' on Wed Jan 15 08:57:26 EET 2025
Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 70%Building dependency tree... Done
Reading state information... 0% Reading state information... 0%Reading state information... Done
The following additional packages will be installed:
  evemu-tools libevemu3
The following NEW packages will be installed:
  evemu-tools evtest libevemu3
0 upgraded, 3 newly installed, 0 to remove and 117 not upgraded.
Need to get 43.6 kB of archives.
After this operation, 211 kB of additional disk space will be used.
[33m0% [Working][0m            Get:1 http://deb.debian.org/debian bookworm/main arm64 libevemu3 arm64 2.7.0-3 [12.4 kB]
[33m8% [1 libevemu3 4332 B/12.4 kB 35%][0m[33m                                   29% [Working][0m             Get:2 http://deb.debian.org/debian bookworm/main arm64 evemu-tools arm64 2.7.0-3 [15.3 kB]
[33m31% [2 evemu-tools 767 B/15.3 kB 5%][0m[33m                                    64% [Working][0m             Get:3 http://deb.debian.org/debian bookworm/main arm64 evtest arm64 1:1.35-1 [15.8 kB]
[33m72% [3 evtest 4332 B/15.8 kB 27%][0m[33m                                 100% [Working][0m              Fetched 43.6 kB in 0s (597 kB/s)
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously unselected package libevemu3:arm64.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 128946 files and directories currently installed.)
Preparing to unpack .../libevemu3_2.7.0-3_arm64.deb ...
Unpacking libevemu3:arm64 (2.7.0-3) ...
Selecting previously unselected package evemu-tools.
Preparing to unpack .../evemu-tools_2.7.0-3_arm64.deb ...
Unpacking evemu-tools (2.7.0-3) ...
Selecting previously unselected package evtest.
Preparing to unpack .../evtest_1%3a1.35-1_arm64.deb ...
Unpacking evtest (1:1.35-1) ...
Setting up libevemu3:arm64 (2.7.0-3) ...
Setting up evtest (1:1.35-1) ...
Setting up evemu-tools (2.7.0-3) ...
Processing triggers for man-db (2.11.2-2) ...
Processing triggers for libc-bin (2.36-9+rpt2+deb12u9) ...
#+end_example

Testing evtest

#+BEGIN_SRC elisp :noweb yes :results output :eval no-export :exports none 
(start-process "server" "buf-server" "xterm"  "-T" "evtest" "-fa" "'Monospace'" "-fs" "12"  "-hold" "-e"  "bash" "-c" "ssh jrr5 sudo evtest")
#+END_SRC

#+RESULTS:

** ~python3-pip~: 

#+call: apt-install(PKG="python3-pip")

#+RESULTS:
: Running 'sudo apt install -y python3-pip' in host 'jrr5' on Sun Dec  8 21:48:46 EET 2024
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 71%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: python3-pip is already the newest version (23.0.1+dfsg-1+rpt1).
: 0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.

** ~python-pil~: install PKG 'pillow'

#+call: apt-install(PKG="python3-pillow")

#+RESULTS:
: Running 'sudo apt install -y python3-pillow' in host 'jrr5' on Sun Dec  8 21:56:00 EET 2024
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 71%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: Note, selecting 'python3-pil' instead of 'python3-pillow'
: python3-pil is already the newest version (9.4.0-1.1+deb12u1).
: python3-pil set to manually installed.
: 0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.

** ~RPi.GPIO~
:PROPERTIES:
:header-args+: :var  PKG="python3-Jetson.GPIO"
:END:

#+call: apt-search(PKG="GPIO")

#+RESULTS:
#+begin_example
Running in host 'jrr5' on Sun Dec  8 22:09:26 EET 2024
PKG=GPIO
airspyhf - HF+VHF software defined radio receiver - user runtime
libbcm2835-dev - access to GPIO and other IO functions on the Broadcom BCM 2835 chip
librte-raw-cnxk-gpio23 - Data Plane Development Kit (librte-raw-cnxk-gpio runtime library)
ledmon - Enclosure LED Utilities
gpiod - Tools for interacting with Linux GPIO character device - binary
libgpiod-dev - C library for interacting with Linux GPIO device - static libraries and headers
libgpiod-doc - C library for interacting with Linux GPIO device - library documentation
libgpiod2 - C library for interacting with Linux GPIO device - shared libraries
python3-libgpiod - Python bindings for libgpiod (Python 3)
libhipi-perl - Raspberry Pi GPIO Perl Modules
libpigpiod-if2-1 - Client library for Raspberry Pi GPIO control
python3-ftdi - user-space driver for popular FTDI devices
python3-ftdi-doc - user-space driver for popular FTDI devices. Documentation
python-periphery-doc - Peripheral I/O (Documentation)
python3-periphery - Peripheral I/O (Python3 version)
python3-rpi.gpio - Module to control Raspberry Pi GPIO channels (Python 3)
rpi.gpio-common - Module to control Raspberry Pi GPIO channels (common files)
stm32flash - STM32 chip flashing utility using a serial bootloader
svxlink-gpio - GPIO control scripts SvxLink amateur radio server
liblgpio-dev - Control GPIO pins via gpiochip devices - static libraries and headers
liblgpio1 - Control GPIO pins via gpiochip devices - shared libraries
libpigpio-dev - Client tools for Raspberry Pi GPIO control
libpigpio1 - Library for Raspberry Pi GPIO control
libpigpiod-if-dev - Development headers for client libraries for Raspberry Pi GPIO control
libpigpiod-if1 - Client library for Raspberry Pi GPIO control (deprecated)
librgpio-dev - Control GPIO pins remotely via rgpiod - static libraries and headers
librgpio1 - Control GPIO pins remotely via rgpiod - shared libraries
pigpio - Raspberry Pi GPIO control transitional package.
pigpio-tools - Client tools for Raspberry Pi GPIO control
pigpiod - Client tools for Raspberry Pi GPIO control
python-gpiozero-doc - Documentation for the gpiozero Python API
python-pigpio - Python module which talks to the pigpio daemon (Python 2)
python-rpi-lgpio-doc - Compatibility shim for lgpio emulating the RPi.GPIO API - docs
python3-gpiozero - Simple API for controlling devices attached to a Pi's GPIO pins
python3-lgpio - Control GPIO pins via gpiochip devices - python3 bindings
python3-lgpio-dbgsym - debug symbols for python3-lgpio
python3-pigpio - Python module which talks to the pigpio daemon (Python 3)
python3-rgpio - Control GPIO pins remotely via rgpiod - python3 bindings
python3-rpi-lgpio - Compatibility shim for lgpio emulating the RPi.GPIO API
raspi-gpio - Dump the state of the BCM270x GPIOs
raspi-gpio-dbgsym - debug symbols for raspi-gpio
raspi-utils-core - Collection of scripts and simple applications
rgpio-tools - Control GPIO pins remotely
rgpiod - Daemon permitting remote control of GPIO pins
#+end_example

#+call: apt-install-doc()

#+RESULTS:
: Running 'sudo apt install -y python3-Jetson.GPIO' in host 'jrr5' on Sun Dec  8 22:06:54 EET 2024
: PKG=python3-Jetson.GPIO

#+call: apt-install()

#+RESULTS:
: Running 'sudo apt install -y python3-Jetson.GPIO' in host 'jrr5' on Sun Dec  8 22:06:57 EET 2024
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 71%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: [1;31mE: [0mUnable to locate package python3-Jetson.GPIO[0m
: [1;31mE: [0mCouldn't find any package by glob 'python3-Jetson.GPIO'[0m

** ~python3-numpy~

#+call: apt-search(PKG="python3-numpy")

#+RESULTS:
: Running in host 'jrr5' on Mon Dec  9 09:51:09 EET 2024
: PKG=python3-numpy
: python3-numpy - Fast array facility to the Python 3 language
: python3-stl - stl file and 3d object handling for the Python language
: python3-numpydoc - Sphinx extension to support docstrings in Numpy format -- Python3
: python3-numpy-groupies - performs operations on/with subsets of n-dim arrays
: python3-numpysane - more-reasonable core functionality for numpy

#+call: apt-install(PKG="python3-numpy")

#+RESULTS:
: Running 'sudo apt install -y python3-numpy' in host 'jrr5' on Mon Dec  9 09:51:29 EET 2024
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 70%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: python3-numpy is already the newest version (1:1.24.2-1+deb12u1).
: 0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.

** ~spidev~ and ~spi-tools~
:PROPERTIES:
:header-args+: :var  PKG="python3-spidev"
:END:


#+call: apt-search(PKG="spidev")

#+RESULTS:
: Running in host 'jrr5' on Mon Dec  9 09:52:05 EET 2024
: PKG=spidev
: flashrom - Identify, read, write, erase, and verify BIOS/ROM/flash chips
: spi-tools - Simple command line tools to help using Linux spidev devices
: python3-spidev - Bindings for Linux SPI access through spidev (Python 3)
: python3-spidev-dbgsym - debug symbols for python3-spidev

#+call: apt-install(PKG="python3-spidev")

#+RESULTS:
: Running 'sudo apt install -y python3-spidev' in host 'jrr5' on Mon Dec  9 09:52:52 EET 2024
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 71%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: python3-spidev is already the newest version (20200602~200721-1+bookworm).
: 0 upgraded, 0 newly installed, 0 to remove and 39 not upgraded.

#+call: apt-install(PKG="spi-tools")

#+RESULTS:
#+begin_example
Running 'sudo apt install -y spi-tools' in host 'jrr5' on Mon Dec  9 09:53:13 EET 2024
Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 70%Building dependency tree... Done
Reading state information... 0% Reading state information... 0%Reading state information... Done
The following NEW packages will be installed:
  spi-tools
0 upgraded, 1 newly installed, 0 to remove and 39 not upgraded.
Need to get 9240 B of archives.
After this operation, 37.9 kB of additional disk space will be used.
[33m0% [Working][0m            Get:1 http://deb.debian.org/debian bookworm/main arm64 spi-tools arm64 0.8.4-1 [9240 B]
[33m13% [1 spi-tools 1444 B/9240 B 16%][0m[33m                                   100% [Working][0m              Fetched 9240 B in 0s (160 kB/s)
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously unselected package spi-tools.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 128884 files and directories currently installed.)
Preparing to unpack .../spi-tools_0.8.4-1_arm64.deb ...
Unpacking spi-tools (0.8.4-1) ...
Setting up spi-tools (0.8.4-1) ...
Processing triggers for man-db (2.11.2-2) ...
#+end_example

** ~pyyaml~: install yaml
:PROPERTIES:
:header-args+: :var  PKG="python3-yaml"
:END:

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
echo "PKG=$PKG"
#+END_SRC

#+RESULTS:
: Running in host 'jrr5' on Tue Dec 31 12:51:52 EET 2024
: PKG=python3-yaml

#+call: apt-search()

#+RESULTS:
: Running in host 'jrr5' on Tue Dec 31 12:51:07 EET 2024
: PKG=python3-yaml
: python3-yamlordereddictloader - loader and dump for PyYAML keeping keys order
: python3-yaml - YAML parser and emitter for Python3

#+call: apt-install()

#+RESULTS:
#+begin_example
Running 'sudo apt install -y python3-yaml' in host 'jrr5' on Tue Dec 31 12:51:29 EET 2024
Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 70%Building dependency tree... Done
Reading state information... 0% Reading state information... 0%Reading state information... Done
The following NEW packages will be installed:
  python3-yaml
0 upgraded, 1 newly installed, 0 to remove and 50 not upgraded.
Need to get 108 kB of archives.
After this operation, 505 kB of additional disk space will be used.
[33m0% [Working][0m            Get:1 http://deb.debian.org/debian bookworm/main arm64 python3-yaml arm64 6.0-3+b2 [108 kB]
[33m0% [1 python3-yaml 0 B/108 kB 0%][0m[33m                                 100% [Working][0m              Fetched 108 kB in 0s (1158 kB/s)
debconf: unable to initialize frontend: Dialog
debconf: (Dialog frontend will not work on a dumb terminal, an emacs shell buffer, or without a controlling terminal.)
debconf: falling back to frontend: Readline
Selecting previously unselected package python3-yaml.
(Reading database ... (Reading database ... 5%(Reading database ... 10%(Reading database ... 15%(Reading database ... 20%(Reading database ... 25%(Reading database ... 30%(Reading database ... 35%(Reading database ... 40%(Reading database ... 45%(Reading database ... 50%(Reading database ... 55%(Reading database ... 60%(Reading database ... 65%(Reading database ... 70%(Reading database ... 75%(Reading database ... 80%(Reading database ... 85%(Reading database ... 90%(Reading database ... 95%(Reading database ... 100%(Reading database ... 128891 files and directories currently installed.)
Preparing to unpack .../python3-yaml_6.0-3+b2_arm64.deb ...
Unpacking python3-yaml (6.0-3+b2) ...
Setting up python3-yaml (6.0-3+b2) ...
#+end_example

** Enable SPI

#+begin_example
sudo raspi-config
#+end_example

#+begin_example
Interfacing Options -> SPI -> Enable SPI Interface
#+end_example

Run example program

#+BEGIN_SRC bash :eval no-export :results output :dir /ssh:jrr5:src
echo "Running in host '$(hostname)' on $(date)"
epaper/epd_2in13b_V3_test.py 2>&1; true
#+END_SRC

#+RESULTS:
#+begin_example
Running in host 'jrr5' on Mon Dec  9 09:49:07 EET 2024
INFO:root:epd2in13b_V3 Demo
INFO:root:init
DEBUG:waveshare_epd.epdconfig:module_init
DEBUG:waveshare_epd.epdconfig:setwarnings
DEBUG:waveshare_epd.epdconfig:self.RST_PIN
Traceback (most recent call last):
  File "/home/pi/src/epaper/epd_2in13b_V3_test.py", line 23, in <module>
    epd.init()
  File "/home/pi/src/lib/waveshare_epd/epd2in13b_V3.py", line 78, in init
    if (epdconfig.module_init() != 0):
        ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/pi/src/lib/waveshare_epd/epdconfig.py", line 76, in module_init
    self.GPIO.setup(self.CS_PIN, self.GPIO.OUT)
  File "/usr/lib/python3/dist-packages/RPi/GPIO/__init__.py", line 704, in setup
    initial = _check(lgpio.gpio_read(_chip, gpio))
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3/dist-packages/lgpio.py", line 903, in gpio_read
    return _u2i(_lgpio._gpio_read(handle&0xffff, gpio))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/usr/lib/python3/dist-packages/lgpio.py", line 458, in _u2i
    raise error(error_text(v))
lgpio.error: 'GPIO not allocated'
#+end_example

** +ILI94486 driver+

[[https://github.com/ustropo/Python_ILI9486]]

#+BEGIN_SRC bash :eval no-export :results output
cd tmp
echo "Running in host '$(hostname)' on $(date)"
git clone https://github.com/ustropo/Python_ILI9486
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ti 7.1.2025 08.51.34 +0200

[[file:tmp/Python_ILI9486]]

** +Install RPI display driver+

Instructions from http://www.lcdwiki.com/3.5inch_RPi_Display#Driver_Installation


*** Git clone

#+BEGIN_SRC bash :eval no-export :results output 
cd tmp
echo "Running in $(pwd) host '$(hostname)' on $(date)"
git clone https://github.com/goodtft/LCD-show.git
#+END_SRC

#+RESULTS:
: Running in /home/pi/tmp host 'jrr5' on Tue Jan  7 11:45:37 EET 2025

*** Show result
:PROPERTIES:
:header-args+: :dir  /ssh:jrr5:tmp/LCD-show
:END:



#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
ls -ltr
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi/tmp/LCD-show host 'jrr5' on Tue Jan  7 11:47:33 EET 2025
total 688
-rwxr-xr-x 1 pi pi   4396 Jan  7 11:45 MHS40-show
-rwxr-xr-x 1 pi pi   4384 Jan  7 11:45 MHS35IPS-show
-rwxr-xr-x 1 pi pi   4557 Jan  7 11:45 MHS35B-show
-rwxr-xr-x 1 pi pi   4366 Jan  7 11:45 MHS35-show
-rwxr-xr-x 1 pi pi   4393 Jan  7 11:45 MHS32-show
-rwxr-xr-x 1 pi pi   1409 Jan  7 11:45 MHS24-show
-rwxr-xr-x 1 pi pi   1838 Jan  7 11:45 LCD7S-show
-rwxr-xr-x 1 pi pi   1838 Jan  7 11:45 LCD7H-show
-rwxr-xr-x 1 pi pi   1777 Jan  7 11:45 LCD7C-show
-rwxr-xr-x 1 pi pi   1773 Jan  7 11:45 LCD7B-show
-rwxr-xr-x 1 pi pi   1849 Jan  7 11:45 LCD55-show
-rwxr-xr-x 1 pi pi   3740 Jan  7 11:45 LCD5-show
-rwxr-xr-x 1 pi pi   4385 Jan  7 11:45 LCD35-show
-rwxr-xr-x 1 pi pi   4391 Jan  7 11:45 LCD32-show
-rwxr-xr-x 1 pi pi   4391 Jan  7 11:45 LCD28-show
-rwxr-xr-x 1 pi pi   4391 Jan  7 11:45 LCD24-show
-rwxr-xr-x 1 pi pi   4388 Jan  7 11:45 LCD24-3A+-show
-rwxr-xr-x 1 pi pi   4856 Jan  7 11:45 LCD154-show
-rwxr-xr-x 1 pi pi   1779 Jan  7 11:45 LCD101Y-show
-rwxr-xr-x 1 pi pi   1884 Jan  7 11:45 LCD101TMP-show
-rwxr-xr-x 1 pi pi   1794 Jan  7 11:45 LCD101S-show
-rwxr-xr-x 1 pi pi   1878 Jan  7 11:45 LCD101H-show
-rwxr-xr-x 1 pi pi    855 Jan  7 11:45 LCD-hdmi
-rwxr-xr-x 1 pi pi   1222 Jan  7 11:45 DPI7_1024_600-show
-rwxr-xr-x 1 pi pi   1222 Jan  7 11:45 DPI5_7_800_480-show
drwxr-xr-x 3 pi pi   4096 Jan  7 11:45 etc
drwxr-xr-x 2 pi pi   4096 Jan  7 11:45 boot
-rwxr-xr-x 1 pi pi   6520 Jan  7 11:45 README.md
-rw-r--r-- 1 pi pi   4019 Jan  7 11:45 PyMouse-1.0.tar.gz
-rwxr-xr-x 1 pi pi   4558 Jan  7 11:45 NANO24-show
-rw-r--r-- 1 pi pi   1751 Jan  7 11:45 Mouse_Key.py
-rwxr-xr-x 1 pi pi    750 Jan  7 11:45 MPI5094-show
-rwxr-xr-x 1 pi pi   1877 Jan  7 11:45 MPI5001-show
-rwxr-xr-x 1 pi pi   3286 Jan  7 11:45 MPI4009-show
-rwxr-xr-x 1 pi pi   3576 Jan  7 11:45 MPI4008-show
-rwxr-xr-x 1 pi pi   1064 Jan  7 11:45 MPI3510-show
-rwxr-xr-x 1 pi pi   1022 Jan  7 11:45 MPI3508_480_320-show
-rwxr-xr-x 1 pi pi   3478 Jan  7 11:45 MPI3508-show
-rwxr-xr-x 1 pi pi   4391 Jan  7 11:45 MIS35-show
-rwxr-xr-x 1 pi pi   4706 Jan  7 11:45 MHS40C-show
-rwxr-xr-x 1 pi pi   3215 Jan  7 11:45 system_restore.sh
-rwxr-xr-x 1 pi pi   1097 Jan  7 11:45 system_config.sh
-rwxr-xr-x 1 pi pi   3189 Jan  7 11:45 system_backup.sh
-rwxr-xr-x 1 pi pi   6482 Jan  7 11:45 rotate.sh
-rw-r--r-- 1 pi pi 119448 Jan  7 11:45 python-xlib_0.23-2_all.deb
-rwxr-xr-x 1 pi pi  43920 Jan  7 11:45 xinput-calibrator_0.7.5+git20140201-1+b2_arm64.deb
drwxr-xr-x 4 pi pi   4096 Jan  7 11:45 usr
-rwxr-xr-x 1 pi pi 119392 Jan  7 11:45 xserver-xorg-input-evdev_1%3a2.10.6-2_arm64.deb
-rwxr-xr-x 1 pi pi 117184 Jan  7 11:45 xserver-xorg-input-evdev_1%3a2.10.6-1+b1_armhf.deb
-rwxr-xr-x 1 pi pi  41542 Jan  7 11:45 xinput-calibrator_0.7.5-1_armhf.deb
#+end_example

** Install packages needed by ILI9486 -drive

As instructed on: https://github.com/SirLefti/Python_ILI9486

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
sudo apt -y install libopenjp2-7 libopenblas0 python3 python3-rpi-lgpio
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Tue Jan  7 13:22:40 EET 2025
: Reading package lists... 0%Reading package lists... 100%Reading package lists... Done
: Building dependency tree... 0%Building dependency tree... 0%Building dependency tree... 50%Building dependency tree... 50%Building dependency tree... 70%Building dependency tree... Done
: Reading state information... 0% Reading state information... 0%Reading state information... Done
: libopenjp2-7 is already the newest version (2.5.0-2).
: libopenblas0 is already the newest version (0.3.21+ds-4).
: python3 is already the newest version (3.11.2-1+b1).
: python3-rpi-lgpio is already the newest version (0.6-0~rpt1).
: 0 upgraded, 0 newly installed, 0 to remove and 51 not upgraded.

* Local app development
:PROPERTIES:
:header-args+: :var  SRC_DIR="src"
:END:
** +Run Waveshare examples on PI+                                  :noexport:
*** Clone Waveshare git to  ~/ssh:pi:tmp~
:PROPERTIES:
:header-args+: :dir /ssh:jrr5:tmp
:END:

Ref: https://www.waveshare.com/wiki/2.13inch_e-Paper_HAT_Manual#Working_With_Raspberry_Pi

#+BEGIN_SRC bash :eval no-export :results output
echo "Cloning to directory $(pwd) in host '$(hostname)' on $(date)"
pwd
#+END_SRC

#+RESULTS:
: Cloning to directory /home/pi/tmp in host 'jrr5' on Wed Dec 18 08:43:27 EET 2024
: /home/pi/tmp


#+BEGIN_SRC bash :eval no-export :results output 
echo "Running in host '$(hostname)' on $(date)"
git clone https://github.com/waveshare/e-Paper.git
#+END_SRC

#+RESULTS:
: Running in host 'jrr5' on Mon Dec  9 09:59:41 EET 2024

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in direcotory $(pwd) host '$(hostname)' on $(date)"
wget https://files.waveshare.com/upload/7/71/E-Paper_code.zip
#+END_SRC

#+RESULTS:
: Running in direcotory /home/pi/tmp host 'jrr5' on Mon Dec  9 10:03:33 EET 2024

#+BEGIN_SRC bash :eval no-export :results output 
echo "Running in host '$(hostname)' on $(date)"
unzip E-Paper_code.zip
#+END_SRC

#+RESULTS:
: Running in host 'jrr5' on Mon Dec  9 10:05:17 EET 2024
: Archive:  E-Paper_code.zip

*** 2in13 examples 
:PROPERTIES:
:header-args+: :dir /ssh:jrr5:tmp/e-Paper/RaspberryPi_JetsonNano/python/examples
:END:

#+call: edp-demo-ls()

#+RESULTS:
: List DEMOS='epd*2in13*' for 2.13 inch display in /home/pi/tmp/e-Paper/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Wed Dec 18 08:19:41 EET 2024
: epd_2in13_V2_test.py  epd_2in13_test.py      epd_2in13bc_test.py
: epd_2in13_V3_test.py  epd_2in13b_V3_test.py  epd_2in13d_test.py
: epd_2in13_V4_test.py  epd_2in13b_V4_test.py  epd_2in13g_test.py


#+call: edp-demo(EXAMPLE="epd_2in13b_V3_test.py")

Probably the best (smooth changes)

#+call: edp-demo(EXAMPLE="epd_2in13d_test.py")

- [[file:/ssh:jrr5:/home/pi/tmp/RaspberryPi_JetsonNano/python/examples/epd_2in13d_test.py]]

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in13d_test.py' in /home/pi/tmp/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Mon Dec  9 12:32:33 EET 2024
-rw-r--r-- 1 pi pi 3146 Dec 22  2023 epd_2in13d_test.py
INFO:root:epd2in13d Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:1.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:3.read bmp file
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:4.read bmp file on window
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:5.show time...
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example

Seems to work -however some flikering
#+call: edp-demo(EXAMPLE="epd_2in13bc_test.py")

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in13bc_test.py' in /home/pi/tmp/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Mon Dec  9 12:29:09 EET 2024
-rw-r--r-- 1 pi pi 3768 Dec 22  2023 epd_2in13bc_test.py
INFO:root:epd2in13bc Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:Drawing
INFO:root:1.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:2.Drawing on the Vertical image...
DEBUG:waveshare_epd.epd2in13bc:Vertical
DEBUG:waveshare_epd.epd2in13bc:Vertical
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:3.read bmp file
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:4.read bmp file on window
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example


Hangs
#+call: edp-demo(EXAMPLE="epd_2in13_test.py")

#+RESULTS:
: Running EXAMPLE='epd_2in13b_test.py' in /home/pi/tmp/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Mon Dec  9 12:31:38 EET 2024
: python3: can't open file '/home/pi/tmp/RaspberryPi_JetsonNano/python/examples/epd_2in13b_test.py': [Errno 2] No such file or directory

*** 2in7 -examples 
:PROPERTIES:
:header-args+: :dir /ssh:jrr5:tmp/e-Paper/RaspberryPi_JetsonNano/python/examples
:END:

#+call: edp-demo-ls(DEMOS="epd*2in7*")

#+RESULTS:
: List DEMOS='epd*2in7*' for Waveshare ePaper display in /home/pi/tmp/e-Paper/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Mon Dec 30 13:22:04 EET 2024
: epd_2in7_V2_test.py  epd_2in7_test.py  epd_2in7b_V2_test.py  epd_2in7b_test.py

#+call: edp-demo(EXAMPLE="epd_2in7_V2_test.py")

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in7_V2_test.py' in /home/pi/tmp/e-Paper/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Mon Dec 30 13:23:18 EET 2024
-rw-r--r-- 1 pi pi 5987 Dec  9 10:01 epd_2in7_V2_test.py
INFO:root:epd2in7 Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Quick refresh demo
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:1.Drawing on the Vertical image...
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:2.read bmp file
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Normal refresh demo
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:3.read bmp file on window
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:4.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:5.show time
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:4Gray display--------------------------------
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example


#+begin_example
Running EXAMPLE='epd_2in7_V2_test.py' in /home/pi/tmp/e-Paper/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Wed Dec 18 08:27:12 EET 2024
-rw-r--r-- 1 pi pi 5987 Dec  9 10:01 epd_2in7_V2_test.py
INFO:root:epd2in7 Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Quick refresh demo
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:1.Drawing on the Vertical image...
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:2.read bmp file
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Normal refresh demo
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:3.read bmp file on window
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:4.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:5.show time
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Horizontal
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:4Gray display--------------------------------
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:Vertical
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy
DEBUG:waveshare_epd.epd2in7_V2:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example

** +Copy epaper demo-code to ~tmp/RaspberryPi_JetsonNano~ from to ~src~+
:PROPERTIES:
:header-args+: :var  DEMO_DIR_OLD="tmp/RaspberryPi_JetsonNano"
:header-args+: :var  DEMO_DIR="tmp/e-Paper/RaspberryPi_JetsonNano"
:END:

*** Init directories

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
echo "DEMO_DIR_DIR=$DEMO_DIR"
echo "SRC_DIR=$SRC_DIR"
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ma 9.12.2024 10.13.09 +0200
: DEMO_DIR_DIR=tmp/RaspberryPi_JetsonNano
: SRC_DIR=src

Init local directories

*Warning deletes directories*
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
rm -rf src/lib
rm -rf src/pic
rm -rf src/examples
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ma 9.12.2024 12.50.53 +0200


#+call: create-dir[:dir .](DIR="src/lib")

#+RESULTS:
: Create DIR=src/lib in host='eero' on ma 9.12.2024 12.51.10 +0200
: Directory src/lib created

#+call: create-dir[:dir .](DIR="src/lib/waveshare_epd")

#+RESULTS:
: Create DIR=src/lib/waveshare_epd in host='eero' on ma 9.12.2024 12.51.12 +0200
: Directory src/lib/waveshare_epd created

#+call: create-dir[:dir .](DIR="src/pic")

#+RESULTS:
: Create DIR=src/pic in host='eero' on ma 9.12.2024 12.51.14 +0200
: Directory src/pic created

#+call: create-dir[:dir .](DIR="src/examples")

#+RESULTS:
: Create DIR=src/examples in host='eero' on ma 9.12.2024 12.51.16 +0200
: Directory src/examples created

*** Copy files  ~DEMO_DIR~  to ~SRC_DIR~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
echo "DEMO_DIR_DIR=$DEMO_DIR"
echo "SRC_DIR=$SRC_DIR"
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ke 18.12.2024 10.52.33 +0200
: DEMO_DIR_DIR=tmp/e-Paper/RaspberryPi_JetsonNano
: SRC_DIR=src

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
ls -ltr $DEMO_DIR/python/examples/epd_2in13d_test.py
ls -ltr $DEMO_DIR/python/examples/epd_2in7_V2_test.py
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ke 18.12.2024 10.52.42 +0200
: -rw-rw-r-- 1 jj jj 3056 joulu   9 09:55 tmp/e-Paper/RaspberryPi_JetsonNano/python/examples/epd_2in13d_test.py
: -rw-rw-r-- 1 jj jj 5987 joulu   9 09:55 tmp/e-Paper/RaspberryPi_JetsonNano/python/examples/epd_2in7_V2_test.py


: Running in host 'eero' on ke 18.12.2024 08.31.53 +0200
: -rw-rw-r-- 1 jj jj 3146 joulu  22  2023 tmp/RaspberryPi_JetsonNano/python/examples/epd_2in13d_test.py
: -rw-rw-r-- 1 jj jj 6146 joulu  22  2023 tmp/RaspberryPi_JetsonNano/python/examples/epd_2in7_V2_test.py

Copy pics files
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
cp -R $DEMO_DIR/python/pic/100x100.bmp $SRC_DIR/pic
cp -R $DEMO_DIR/python/pic/2in13*.bmp $SRC_DIR/pic
cp -R $DEMO_DIR/python/pic/2in7*.bmp $SRC_DIR/pic
cp -R $DEMO_DIR/python/pic/Font.ttc $SRC_DIR/pic
cp -R $DEMO_DIR/python/lib/waveshare_epd/epdconfig.py $SRC_DIR/lib/waveshare_epd
#+END_SRC

#+RESULTS:
: Running in host 'eero' on to 19.12.2024 10.17.39 +0200

#+name: edp-copy-ls
#+BEGIN_SRC bash :eval no-export :results output :var DRIVER="epd2in13d" EXAMPLE="epd_2in13d_test"
echo "Running in host '$(hostname)' on $(date)"
echo DRIVER=$DRIVER
echo EXAMPLE=$EXAMPLE
ls -ltr $DEMO_DIR/python/lib/waveshare_epd/$DRIVER.py
ls -ltr $DEMO_DIR/python/examples/$EXAMPLE.py 
#+END_SRC

#+RESULTS: edp-copy-ls
: Running in host 'eero' on ke 18.12.2024 10.53.08 +0200
: DRIVER=epd2in13d
: EXAMPLE=epd_2in13d_test
: -rw-rw-r-- 1 jj jj 12269 joulu   9 09:55 tmp/e-Paper/RaspberryPi_JetsonNano/python/lib/waveshare_epd/epd2in13d.py
: -rw-rw-r-- 1 jj jj 3056 joulu   9 09:55 tmp/e-Paper/RaspberryPi_JetsonNano/python/examples/epd_2in13d_test.py

#+name: edp-copy
#+BEGIN_SRC bash :eval no-export :results output :var DRIVER="epd2in13d" EXAMPLE="epd_2in13d_test"
echo "Running in $(pwd) host '$(hostname)' on $(date)"
echo DRIVER=$DRIVER
echo EXAMPLE=$EXAMPLE
echo DEMO_DIR=$DEMO_DIR
echo SRC_DIR=$SRC_DIR
set -x
cp $DEMO_DIR/python/lib/waveshare_epd/$DRIVER.py $SRC_DIR/lib/waveshare_epd
cp $DEMO_DIR/python/examples/$EXAMPLE.py $SRC_DIR/examples/
#+END_SRC

#+RESULTS: edp-copy
: Running in host 'eero' on ke 18.12.2024 10.53.14 +0200
: DRIVER=epd2in13d
: EXAMPLE=epd_2in13d_test

#+call: edp-copy-ls(DRIVER="epd2in7_V2", EXAMPLE="epd_2in7_V2_test")

#+RESULTS:
: Running in host 'eero' on ke 18.12.2024 11.37.00 +0200
: DRIVER=epd2in7_V2
: EXAMPLE=epd_2in7_V2_test
: -rw-rw-r-- 1 jj jj 18647 joulu   9 09:55 tmp/e-Paper/RaspberryPi_JetsonNano/python/lib/waveshare_epd/epd2in7_V2.py
: -rw-rw-r-- 1 jj jj 5987 joulu   9 09:55 tmp/e-Paper/RaspberryPi_JetsonNano/python/examples/epd_2in7_V2_test.py

#+call: edp-copy(DRIVER="epd2in7_V2", EXAMPLE="epd_2in7_V2_test")

#+RESULTS:
: Running in /home/jj/work/järviradio-radio host 'eero' on ke 18.12.2024 11.37.10 +0200
: DRIVER=epd2in7_V2
: EXAMPLE=epd_2in7_V2_test
: DEMO_DIR=tmp/e-Paper/RaspberryPi_JetsonNano
: SRC_DIR=src

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
echo "SRC_DIR=$var"
ls -ltr $SRC_DIR/examples
ls -ltr $SRC_DIR/lib/waveshare_epd
ls -ltr $SRC_DIR/pic
#+END_SRC

#+RESULTS:
#+begin_example
Running in host 'eero' on ke 18.12.2024 10.53.35 +0200
SRC_DIR=
total 20
-rw-rw-r-- 1 jj jj 3761 joulu   9 09:55 epd_2in13b_V3_test.py
-rw-rw-r-- 1 jj jj 3768 joulu   9 09:55 epd_2in13bc_test.py
-rw-rw-r-- 1 jj jj 3056 joulu  18 10:53 epd_2in13d_test.py
-rw-rw-r-- 1 jj jj 5987 joulu  18 10:53 epd_2in7_V2_test.py
total 23
-rw-rw-r-- 1 jj jj  9973 joulu  18 10:53 epdconfig.py
-rw-rw-r-- 1 jj jj 12269 joulu  18 10:53 epd2in13d.py
-rw-rw-r-- 1 jj jj  6624 joulu  18 10:53 epd2in7b_V2.py
total 3599
-rw-rw-r-- 1 jj jj    1662 joulu  18 10:53 100x100.bmp
-rw-rw-r-- 1 jj jj    3966 joulu  18 10:53 2in13-v2.bmp
-rw-rw-r-- 1 jj jj   92054 joulu  18 10:53 2in13g.bmp
-rw-rw-r-- 1 jj jj    2974 joulu  18 10:53 2in13d.bmp
-rw-rw-r-- 1 jj jj    2974 joulu  18 10:53 2in13d_1.bmp
-rw-rw-r-- 1 jj jj    3966 joulu  18 10:53 2in13b_V4r.bmp
-rw-rw-r-- 1 jj jj    3966 joulu  18 10:53 2in13b_V4b.bmp
-rw-rw-r-- 1 jj jj    4062 joulu  18 10:53 2in13.bmp
-rw-rw-r-- 1 jj jj    2974 joulu  18 10:53 2in13bc-ry.bmp
-rw-rw-r-- 1 jj jj    2974 joulu  18 10:53 2in13bc-b.bmp
-rw-rw-r-- 1 jj jj    2976 joulu  18 10:53 2in13_b1.bmp
-rw-rw-r-- 1 jj jj    3966 joulu  18 10:53 2in13_2.bmp
-rw-rw-r-- 1 jj jj    3966 joulu  18 10:53 2in13_1.bmp
-rw-rw-r-- 1 jj jj    2976 joulu  18 10:53 2in13_y1.bmp
-rw-rw-r-- 1 jj jj 5177387 joulu  18 10:53 Font.ttc
#+end_example

** Create sprite file  ~src/resources/icon-sprite.png~


#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
echo "SRC_DIR=$SRC_DIR"
#+END_SRC

#+RESULTS:
: Running in /home/jj/work/järviradio-radio host 'eero' on su 29.12.2024 18.59.46 +0200
: SRC_DIR=src


Ensure that dowload directory ~resources/sprite~ exists [[file:resources/sprite]]
#+call: create-dir(DIR="resources/sprite")

Download png files from https://www.pngwing.com/en/free-png-hntlj/download

Create application resources directory
#+call: create-dir(DIR="src/resources")

[[file:src/resources]]

#+RESULTS:
: Create DIR=src/resources in host='jrr5' on Sun Dec 29 18:59:54 EET 2024
: Directory src/resources already exists

Convert svg-files in ~resources~ to png files ~resources/sprite~

Converted manually *no used*
#+BEGIN_SRC bash :eval no :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
for svg in $(ls -1 resources/*.svg); do
    png_dir=$(dirname $svg)/sprite
    svg_base=$(basename -- $svg)
    png_file="${svg_base%.*}".png
    echo "svg=$svg, png_dir=$png_dir, png_file=$png_file"
    # https://stackoverflow.com/questions/6589358/convert-svg-to-png-in-python/6599172#6599172
    inkscape $svg  --export-filename=$png_dir/$png_file
done    

#+END_SRC

#+RESULTS:
: Running in /home/jj/work/jarviradio-radio host 'eero' on to 13.3.2025 12.29.31 +0200
: svg=resources/07-keyboard-ok.svg, png_dir=resources/sprite, png_file=07-keyboard-ok.png
: svg=resources/08-keyboard-nok.svg, png_dir=resources/sprite, png_file=08-keyboard-nok.png
: svg=resources/09-keyboard-ok.svg, png_dir=resources/sprite, png_file=09-keyboard-ok.png


Help for python script ~src/spriter.py~ 
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
python3 src/spriter.py --help
#+END_SRC

#+RESULTS:
#+begin_example
Running in host 'eero' on to 13.3.2025 12.01.55 +0200
usage: spriter.py [-h] [-i INPUT_DIRECTORY] [-o OUTPUT_FILE]
                  [--icon-width ICON_WIDTH] [--icon-height ICON_HEIGHT] [-v]

Create icon sprite

options:
  -h, --help            show this help message and exit
  -i INPUT_DIRECTORY, --input-directory INPUT_DIRECTORY
                        input directory
  -o OUTPUT_FILE, --output-file OUTPUT_FILE
                        Output file
  --icon-width ICON_WIDTH
                        Size of icon element in sprite
  --icon-height ICON_HEIGHT
                        Size of icon element in sprite
  -v, --verbose
#+end_example

Content of sprite input directory [[file:resources/sprite]]

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
ls -ltr resources/sprite
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/jj/work/jarviradio-radio host 'eero' on su 16.3.2025 14.48.16 +0200
total 233
-rw-rw-r-- 1 jj jj 159363 joulu  28 11:15 02-net-nok.png
-rw-rw-r-- 1 jj jj   5121 joulu  28 11:15 08-keyboard-nok.png
-rw-rw-r-- 1 jj jj   5121 joulu  28 11:15 03-stream-play.png
-rw-rw-r-- 1 jj jj   4680 joulu  28 11:16 04-stream-paused.png
-rw-rw-r-- 1 jj jj  23492 joulu  28 16:39 01-net-ok.png
-rw-rw-r-- 1 jj jj    555 tammi  17 21:57 05-dot.png
-rw-rw-r-- 1 jj jj    206 tammi  17 22:52 06-dash.png
-rw------- 1 jj jj   1460 maalis 13 13:12 07-keyboard-ok.png
-rw------- 1 jj jj    265 maalis 13 13:14 09-keyboard-nok.png
#+end_example



Create icon sprite file  ~src/resources/icon-sprite.png~
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
python3 src/spriter.py -o src/resources/icon-sprite.png
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ti 27.5.2025 08.23.18 +0300
: parser.input_directory='/home/jj/work/jarviradio-radio/src/../resources/sprite'

Icon sprite file created [[file:src/resources/icon-sprite.png]]

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host $(pwd) '$(hostname)' on $(date)"
ls -ltr src/resources
#+END_SRC

#+RESULTS:
: Running in host /home/jj/work/järviradio-radio 'eero' on pe 17.1.2025 21.53.53 +0200
: total 5
: -rw-rw-r-- 1 jj jj 441 joulu  29 19:00 icon-sprite.png

** Clone driver Python_ILI9486  for 3.5" TFT display
 
https://github.com/SirLefti/Python_ILI9486

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
cd $SRC_DIR
git clone https://github.com/SirLefti/Python_ILI9486
#+END_SRC

#+RESULTS:
: Running in /home/jj/work/järviradio-radio host 'eero' on ti 7.1.2025 13.16.43 +0200

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
ls -latr src/Python_ILI9486
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/jj/work/järviradio-radio host 'eero' on ti 7.1.2025 13.17.17 +0200
total 131
drwxrwxr-x 9 jj jj    42 tammi   7 13:16 ..
-rw-rw-r-- 1 jj jj  1598 tammi   7 13:16 README.md
-rw-rw-r-- 1 jj jj  1136 tammi   7 13:16 LICENSE
-rw-rw-r-- 1 jj jj 11381 tammi   7 13:16 ILI9486.py
-rw-rw-r-- 1 jj jj    80 tammi   7 13:16 .gitignore
-rw-rw-r-- 1 jj jj    86 tammi   7 13:16 config.py
-rw-rw-r-- 1 jj jj 75673 tammi   7 13:16 sample.png
-rw-rw-r-- 1 jj jj    31 tammi   7 13:16 requirements.txt
-rw-rw-r-- 1 jj jj  2168 tammi   7 13:16 image.py
drwxrwxr-x 8 jj jj    13 tammi   7 13:16 .git
drwxrwxr-x 3 jj jj    11 tammi   7 13:16 .
#+end_example

Remove git directory from ~Python_ILI9486~ clone 

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
rm -rf src/Python_ILI9486/.git
#+END_SRC

#+RESULTS:
: Running in /home/jj/work/järviradio-radio host 'eero' on ti 7.1.2025 13.17.58 +0200

** Convert streamer icons from ~runner/icons~ to ~cnf/icons~

Ensure that directory ~cnf/icons~ exists
#+call: create-dir(DIR="cnf/icons")

#+RESULTS:
: Create DIR=cnf/icons in host='jrr5' on Mon Mar 17 10:15:29 EET 2025
: Directory cnf/icons created

List streamer icons input files in ~runner/icons~
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
ls -ltr runner/icons
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/jj/work/jarviradio-radio host 'eero' on ma 17.3.2025 10.15.31 +0200
total 226
-rw-r--r-- 1 jj jj  8584 maalis 16  2020 yle-radio-1.png
-rw-r--r-- 1 jj jj  7501 maalis 16  2020 radio-suomi.png
-rw-r--r-- 1 jj jj  6805 maalis 16  2020 yle-puhe.png
-rw-r--r-- 1 jj jj 30975 maalis 16  2020 järviradio.png
-rw-r--r-- 1 jj jj  9873 maalis 16  2020 jrr.png
-rw-r--r-- 1 jj jj 11144 maalis 16  2020 jrr-stop.png
-rw-rw-r-- 1 jj jj 33672 maalis 17  2020 classic.png
-rw-rw-r-- 1 jj jj 25408 maalis 17  2020 järviratio.png
-rw------- 1 jj jj  8251 touko   8  2020 jrr-help.png
-rw-rw-r-- 1 jj jj 29271 maalis 26  2023 rondo.png
-rw-rw-r-- 1 jj jj  2123 joulu  13 12:50 yle-1.jpeg
-rw-rw-r-- 1 jj jj  3236 tammi  13 14:31 YLE-1.png
-rw-rw-r-- 1 jj jj  2680 tammi  13 14:33 YLE-SUOMI.png
-rw-rw-r-- 1 jj jj  7351 tammi  13 14:35 JÄRVIRADIO.png
#+end_example

Convert (=resize) icon files in directory ~runner/icons~ to directory ~.icons/v2~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
# python3 jrr.py -v convert --icons-from runner/icons --icons-to  .icons/v2 2>&1; true
# python3 jrr.py -v convert --icons-from runner/icons --icons-to  .icons/v2 --yes
python3 jrr.py -v convert --icons-from runner/icons --icons-to  cnf/icons --yes 2>&1; true
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/jj/work/jarviradio-radio host 'eero' on ma 17.3.2025 12.00.22 +0200
2025-03-17:12:00:22,885 INFO     [jrr.py:125] logging.level: 0
2025-03-17:12:00:22,885 INFO     [jrr_converter.py:86] image_dir: runner/icons
2025-03-17:12:00:22,885 INFO     [jrr_converter.py:91] icon_dir: cnf/icons
2025-03-17:12:00:22,885 INFO     [jrr_converter.py:95] image_dir: runner/icons
2025-03-17:12:00:22,885 INFO     [jrr_converter.py:99] image_path: runner/icons/yle-radio-1.png
2025-03-17:12:00:22,893 INFO     [jrr_converter.py:99] image_path: runner/icons/JÄRVIRADIO.png
2025-03-17:12:00:22,895 INFO     [jrr_converter.py:99] image_path: runner/icons/jrr-help.png
2025-03-17:12:00:22,897 INFO     [jrr_converter.py:99] image_path: runner/icons/radio-suomi.png
2025-03-17:12:00:22,900 INFO     [jrr_converter.py:99] image_path: runner/icons/rondo.png
2025-03-17:12:00:22,904 INFO     [jrr_converter.py:99] image_path: runner/icons/classic.png
2025-03-17:12:00:22,911 INFO     [jrr_converter.py:99] image_path: runner/icons/jrr.png
2025-03-17:12:00:22,912 INFO     [jrr_converter.py:99] image_path: runner/icons/yle-puhe.png
2025-03-17:12:00:22,917 INFO     [jrr_converter.py:99] image_path: runner/icons/järviratio.png
2025-03-17:12:00:22,920 INFO     [jrr_converter.py:99] image_path: runner/icons/yle-1.jpeg
2025-03-17:12:00:22,922 INFO     [jrr_converter.py:99] image_path: runner/icons/YLE-1.png
2025-03-17:12:00:22,923 INFO     [jrr_converter.py:99] image_path: runner/icons/jrr-stop.png
2025-03-17:12:00:22,925 INFO     [jrr_converter.py:99] image_path: runner/icons/YLE-SUOMI.png
2025-03-17:12:00:22,926 INFO     [jrr_converter.py:99] image_path: runner/icons/järviradio.png
cnf/icons/yle-radio-1.png - created
cnf/icons/JÄRVIRADIO.png - created
cnf/icons/jrr-help.png - created
cnf/icons/radio-suomi.png - created
cnf/icons/rondo.png - created
cnf/icons/classic.png - created
cnf/icons/jrr.png - created
cnf/icons/yle-puhe.png - created
cnf/icons/järviratio.png - created
cnf/icons/yle-1.jpeg - created
cnf/icons/YLE-1.png - created
cnf/icons/jrr-stop.png - created
cnf/icons/YLE-SUOMI.png - created
cnf/icons/järviradio.png - created
#+end_example



* App  install and config to ROOT_DIR -target
:PROPERTIES:
:header-args+: :var  ROOT_DIR="/ssh:jrr5:"
:header-args+: :dir /ssh:jrr5:
:END:

** Create directories

Directory where järviradioradio v1 icons exitss
#+call: create-dir(DIR=".icons")

Directory where järviradioradio v2 thumbs are found
#+call: create-dir(DIR=".icons/v2")

#+RESULTS:
: Create DIR=.icons/v2 in host='jrr5' on Fri Dec 13 12:29:35 EET 2024
: Directory .icons/v2 created

#+call: create-dir(DIR="tmp")

#+RESULTS:
: Create DIR=tmp in host='jrr5' on Wed Nov 20 14:58:56 EET 2024
: Directory tmp already exists

#+call: create-dir(DIR="bin")

#+RESULTS:
: Create DIR=bin in host='jrr5' on Tue Jul  1 14:42:52 EEST 2025
: Directory bin already exists

#+call: create-dir(DIR="jrr")

#+RESULTS:
: Create DIR=jrr in host='jrr5' on Tue Jul  1 14:42:49 EEST 2025
: Directory jrr already exists

#+call: create-dir(DIR="jrr/bin")

#+RESULTS:
: Create DIR=jrr/bin in host='jrr5' on Tue Jul  1 14:52:27 EEST 2025
: Directory jrr/bin created

** Config path 
*** Ensure that we are running on target system

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
#+END_SRC

#+RESULTS:
: Running in host 'jrr5' on Tue Jul  1 14:43:02 EEST 2025

*** ~.profile~:
:PROPERTIES:
:header-args+: :var  START="added from org-document raspberry.org - start"
:header-args+: :var  END="added from org-document raspberry - end"
:END:



Remove tags (if they exist)

#+BEGIN_SRC bash :eval no-export :results output
FILE=.profile
# START="added from org-document jrr5.org - start"
# END="added from org-document jrr5.org - end"

echo "modifying $FILE on host '$(hostname)'"
([ -f $FILE ] && echo $FILE file already exits - not created ) || (echo $FILE did not exist - created  && touch $FILE )

sed -i -e "/$START/,/$END/d" $FILE
#+END_SRC

#+RESULTS:
: modifying .profile on host 'jrr5'
: .profile file already exits - not created

#+BEGIN_SRC bash :eval no-export :results output
FILE=.profile
#START="added from org-document jrr5.org - start"
#END="added from org-document jrr5.org - end"

echo "modifying $FILE on host '$(hostname)'"
([ -f $FILE ] && echo $FILE file already exits - not created ) || (echo $FILE did not exist - created  && touch $FILE )

sed -i -e "/$START/,/$END/d" $FILE

cat <<HERE | tee -a $FILE
# $START

# echo running $FILE
if [ -d "\$HOME/jrr/bin" ] ; then
     PATH=\$HOME/jrr/bin:\$PATH
fi

# $END
HERE
#+END_SRC

#+RESULTS:
#+begin_example
modifying .profile on host 'jrr5'
.profile file already exits - not created
# added from org-document raspberry.org - start

# echo running .profile
if [ -d "$HOME/jrr/bin" ] ; then
     PATH=$HOME/jrr/bin:$PATH
fi

# added from org-document raspberry - end
#+end_example

*** +~.bashrc~ : for login shells+

No need to use ~.bashrc~ because ~.profile~ adds necassary directories to path
to path.

#+BEGIN_SRC bash :eval no-export :results output :dir .
echo "Running in host '$(hostname)' on $(date)"
ssh jrr5 'echo PATH=$PATH in host $(hostname) on $(date)'
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ke 20.11.2024 15.01.39 +0200
: PATH=/usr/local/bin:/usr/bin:/bin:/usr/games in host jrr5 on Wed Nov 20 15:01:40 EET 2024


#+BEGIN_SRC bash :eval no-export :results output
echo "PATH=$PATH in host '$(hostname)' on $(date)"
#+END_SRC

#+RESULTS:
: PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/local/sbin in host 'jrr5' on Wed Nov 20 15:01:45 EET 2024


#+BEGIN_SRC bash :eval no-export :results output
FILE=.bashrc
START="added from org-document jrr5.org - start"
END="added from org-document jrr5.org - end"

echo "Modifying $FILE on host '$(hostname)' on $(date)"

([ -f $FILE ] && echo $FILE file already exits - not created ) || (echo $FILE did not exist - created  && touch $FILE )

sed -i -e "/$START/,/$END/d" $FILE

#+END_SRC

#+RESULTS:
: Modifying .bashrc on host 'jrr5' on Wed Nov 20 15:25:47 EET 2024
: .bashrc file already exits - not created

#+BEGIN_SRC bash :eval no-export :results output
FILE=.bashrc
START="added from org-document jrr5.org - start"
END="added from org-document jrr5.org - end"

echo "Modifying $FILE on host '$(hostname)' on $(date)"

([ -f $FILE ] && echo $FILE file already exits - not created ) || (echo $FILE did not exist - created  && touch $FILE )

sed -i -e "/$START/,/$END/d" $FILE

cat <<HERE | tee -a $FILE
# $START
# echo running $FILE
if [ -d "\$HOME/.local/bin" ] ; then
     PATH=\$HOME/.local/bin:\$PATH
fi
if [ -d "\$HOME/bin" ] ; then
     PATH=\$HOME/bin:\$PATH
fi
# $END
HERE
    #+END_SRC

    #+RESULTS:
    #+begin_example
    Modifying .bashrc on host 'jrr5' on Wed Nov 20 15:02:32 EET 2024
    .bashrc file already exits - not created
    # added from org-document jrr5.org - start
    # echo running .bashrc
    if [ -d "$HOME/.local/bin" ] ; then
         PATH=$HOME/.local/bin:$PATH
    fi
    if [ -d "$HOME/bin" ] ; then
         PATH=$HOME/bin:$PATH
    fi
    # added from org-document jrr5.org - end
    #+end_example

*** ~.ssh/environment~ : for setting path for ssh

#+BEGIN_SRC bash :eval no-export :results output
hostname
ls -ltr /etc/ssh/sshd_config*
#+END_SRC

#+RESULTS:
: jrr5
: -rw-r--r-- 1 root root 3221 Nov 13  2024 /etc/ssh/sshd_config.bak
: -rw-r--r-- 1 root root 3221 Nov 20  2024 /etc/ssh/sshd_config
: -rw-r--r-- 1 root root 3221 Mar 14 15:33 /etc/ssh/sshd_config.ucf-dist
: 
: /etc/ssh/sshd_config.d:
: total 0

Show PermitUserEnvironment (initial value)
#+BEGIN_SRC bash :eval no-export :results output
cat /etc/ssh/sshd_config | grep PermitUserEnvironment
#+END_SRC

#+RESULTS:
: PermitUserEnvironment yes


This was initial value
: #PermitUserEnvironment no


Show content of ~/etc/ssh/sshd_config~
#+BEGIN_SRC bash :eval no-export :results output
FILE=/etc/ssh/sshd_config
cat $FILE
#+END_SRC


Original
#+begin_example

# This is the sshd server system-wide configuration file.  See
# sshd_config(5) for more information.

# This sshd was compiled with PATH=/usr/local/bin:/usr/bin:/bin:/usr/games

# The strategy used for options in the default sshd_config shipped with
# OpenSSH is to specify options with their default value where
# possible, but leave them commented.  Uncommented options override the
# default value.

Include /etc/ssh/sshd_config.d/*.conf

#Port 22
#AddressFamily any
#ListenAddress 0.0.0.0
#ListenAddress ::

#HostKey /etc/ssh/ssh_host_rsa_key
#HostKey /etc/ssh/ssh_host_ecdsa_key
#HostKey /etc/ssh/ssh_host_ed25519_key

# Ciphers and keying
#RekeyLimit default none

# Logging
#SyslogFacility AUTH
#LogLevel INFO

# Authentication:

#LoginGraceTime 2m
#PermitRootLogin prohibit-password
#StrictModes yes
#MaxAuthTries 6
#MaxSessions 10

#PubkeyAuthentication yes

# Expect .ssh/authorized_keys2 to be disregarded by default in future.
#AuthorizedKeysFile	.ssh/authorized_keys .ssh/authorized_keys2

#AuthorizedPrincipalsFile none

#AuthorizedKeysCommand none
#AuthorizedKeysCommandUser nobody

# For this to work you will also need host keys in /etc/ssh/ssh_known_hosts
#HostbasedAuthentication no
# Change to yes if you don't trust ~/.ssh/known_hosts for
# HostbasedAuthentication
#IgnoreUserKnownHosts no
# Don't read the user's ~/.rhosts and ~/.shosts files
#IgnoreRhosts yes

# To disable tunneled clear text passwords, change to no here!
PasswordAuthentication no
#PermitEmptyPasswords no

# Change to yes to enable challenge-response passwords (beware issues with
# some PAM modules and threads)
KbdInteractiveAuthentication no

# Kerberos options
#KerberosAuthentication no
#KerberosOrLocalPasswd yes
#KerberosTicketCleanup yes
#KerberosGetAFSToken no

# GSSAPI options
#GSSAPIAuthentication no
#GSSAPICleanupCredentials yes
#GSSAPIStrictAcceptorCheck yes
#GSSAPIKeyExchange no

# Set this to 'yes' to enable PAM authentication, account processing,
# and session processing. If this is enabled, PAM authentication will
# be allowed through the KbdInteractiveAuthentication and
# PasswordAuthentication.  Depending on your PAM configuration,
# PAM authentication via KbdInteractiveAuthentication may bypass
# the setting of "PermitRootLogin prohibit-password".
# If you just want the PAM account and session checks to run without
# PAM authentication, then enable this but set PasswordAuthentication
# and KbdInteractiveAuthentication to 'no'.
UsePAM yes

#AllowAgentForwarding yes
#AllowTcpForwarding yes
#GatewayPorts no
X11Forwarding yes
#X11DisplayOffset 10
#X11UseLocalhost yes
#PermitTTY yes
PrintMotd no
#PrintLastLog yes
#TCPKeepAlive yes
#PermitUserEnvironment no
#Compression delayed
#ClientAliveInterval 0
#ClientAliveCountMax 3
#UseDNS no
#PidFile /run/sshd.pid
#MaxStartups 10:30:100
#PermitTunnel no
#ChrootDirectory none
#VersionAddendum none

# no default banner path
#Banner none

# Allow client to pass locale environment variables
AcceptEnv LANG LC_*

# override default of no subsystems
Subsystem	sftp	/usr/lib/openssh/sftp-server

# Example of overriding settings on a per-user basis
#Match User anoncvs
#	X11Forwarding no
#	AllowTcpForwarding no
#	PermitTTY no
#	ForceCommand cvs server
#+end_example



Ensure ~PermitUserEnvironment yes~ in ~/etc/ssh/sshd_config~
#+BEGIN_SRC bash :eval no-export :results output
FILE=/etc/ssh/sshd_config
sudo sed -e 's!.*PermitUserEnvironment.*!PermitUserEnvironment yes!' -i.bak $FILE
#+END_SRC

#+RESULTS:

Show value ~PermitUserEnvironment~
#+BEGIN_SRC bash :eval no-export :results output
cat /etc/ssh/sshd_config | grep PermitUserEnvironment
#+END_SRC

#+RESULTS:
: PermitUserEnvironment yes



Restart (maybe reboot)
#+call: reboot()


Wait for wakeup
#+call: ping-ip[:dir .]()

#+RESULTS:
: Ping JRR5_IP=jrr5.local on ti 1.7.2025 14.49.52 +0300
: PING jrr5.local (192.168.1.241) 56(84) bytes of data.
: 64 bytes from jrr5.local (192.168.1.241): icmp_seq=1 ttl=64 time=2.75 ms
: 64 bytes from jrr5.local (192.168.1.241): icmp_seq=2 ttl=64 time=4.73 ms
: 64 bytes from jrr5.local (192.168.1.241): icmp_seq=3 ttl=64 time=5.98 ms
: 
: --- jrr5.local ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2003ms
: rtt min/avg/max/mdev = 2.751/4.487/5.979/1.329 ms


And wait that reboot finished
#+call: greet-tramp()

#+RESULTS:
: Greet Tue Jul  1 14:49:58 EEST 2025 from host 'jrr5' (using eshell tramp)


Configure =~/.ssh/environment= (which initially does not exists)



#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
ls -ltr .ssh
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Tue Jul  1 14:50:27 EEST 2025
: total 12
: -rw------- 1 pi pi 390 Nov 13  2024 authorized_keys
: -rwx------ 1 pi pi  49 Nov 20  2024 environment
: -rw-r--r-- 1 pi pi 142 Jun  5 09:31 known_hosts


Safe to create file =~/.ssh/environment= in tramp path pointed by

~ROOT_DIR~ because it was non-existent:
#+begin_src txt :tangle (concat  (jj-org-tmp-get-global-prop "ROOT_DIR" )  ".ssh/" "environment")
#ENV=~/.profile
BASH_ENV=~/.profile
#SSH_LOGIN=Y
#+end_src

Set permissions 
#+BEGIN_SRC bash :eval no-export :results output
FILE=~/.ssh/environment
chmod 700 $FILE
ls -ltr $FILE
echo "Content of FILE=$FILE in host $(hostname) on $(date)"
cat $FILE
#+END_SRC

#+RESULTS:
: -rwx------ 1 pi pi 49 Nov 20 15:08 /home/pi/.ssh/environment
: Content of FILE=/home/pi/.ssh/environment in host jrr5 on Wed Nov 20 15:09:48 EET 2024
: #ENV=~/.profile
: BASH_ENV=~/.profile
: #SSH_LOGIN=Y


#+call: tramp-path()

#+RESULTS:
: Path info in host 'jrr5' on Wed Nov 20 15:14:34 EET 2024 for user pi
: PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/local/sbin


: Path info host welleri on Thu Sep 7 12:59:02 EEST 2023 for user pi
: PATH=/home/pi/.local/bin:/home/pi/bin:/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/local/sbin

#+call: ssh-path[:dir .](TARGET="jrr5")

#+RESULTS:
: call ssh TARGET=jrr5 from eero on ti 1.7.2025 14.51.12 +0300
: PATH@jrr5=/usr/local/bin:/usr/bin:/bin:/usr/games


: call ssh TARGET=jrr5 from eero on ke 20.11.2024 15.12.29 +0200
: ssh PATH@jrr5=/usr/local/bin:/usr/bin:/bin:/usr/games


: call ssh lavatin 'echo ... '  on eero
: ssh PATH@sorsa=/usr/local/bin:/usr/bin:/bin:/usr/games

*** Test PATH -setting

#+call: greet-login()

#+RESULTS:
: PATH@jrr5--login=/home/pi/jrr/bin:/home/pi/bin:/home/pi/jrr/bin:/home/pi/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games


: running .profile
: PATH@jrr5--login=/home/pi/bin:/home/pi/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games

#+call: ssh-path[:dir "."](TARGET="jrr5")

#+RESULTS:
: call ssh TARGET=jrr5 from eero on ke 20.11.2024 15.27.24 +0200
: PATH@jrr5=/usr/local/bin:/usr/bin:/bin:/usr/games


#+call: tramp-path()

#+RESULTS:
: Path info in host 'jrr5' on Wed Nov 20 15:27:31 EET 2024 for user pi
: PATH=/home/pi/bin:/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/local/sbin

** ~bin/sine-gen.sh~: generate sine wave

Ref: https://trac.ffmpeg.org/wiki/AudioChannelManipulation

#+begin_src bash :eval no  :tangle (concat  (jj-org-tmp-get-global-prop "ROOT_DIR" )  "bin/" "sine-gen.sh") :shebang "#!/bin/bash"

VERSION=0.1
# 1=warning
DEBUG=1
TS_FORMAT="+%Y%m%d-%T"

# output device, one from list-devices, default  none
AUDIO_OUT="" 
SOUND_DIR=$HOME/tmp
DURATION=60
LEFT_FREQ="1000"
RIGHT_FREQ="440"
VOLUME=1.0
# override
FILE=""

# filter_complex string to add for stero/mono
MONO_OR_STEREO_CMD=""

# Left and Right channel gains
RGAIN=1.0
LGAIN=1.0
GAIN=8.0

# ------------------------------------------------------------------
# Subrus

log() {
    local LEVEL=$1
    local MSG=$2
    if [ $DEBUG -ge $LEVEL ]; then
        	echo $(date $TS_FORMAT): $0'|'$MSG 1>&2
    fi
}

usage() {
    echo 
    echo usage: $(basename $0)
    echo $0 - $VERSION
    echo ""
    echo "Generate sine waves"
    echo ""
    echo "Usage:"
    echo "$0 [options]  -- <commands>"
    echo "options:"
    echo "--sh_trace"
    echo "--version             : print out version number && exit 0"
    echo "--mono                : pan stereo streams to one mono stream"
    echo "--device AUDIO_OUT    : Set audio AUDIO_OUT one from 'list-devices', defaults $AUDIO_OUT"
    echo "--gain GAIN           : Volume gain, default $GAIN"
    echo "--rgain RGAIN         : Volume on right channel, default $RGAIN"
    echo "--lgain LGAIN         : Volume on left channel, default $LGAIN"
    echo "--left FREQ           : Set left ch frequency, default $LEFT_FREQ"
    echo "--right FREQ          : Set right ch frequency, default $RIGHT_FREQ"
    echo "--volume VOLUME       : Set output VOLUME"
    echo "--duration DURATION   : Set duration of generated sound file to DURATION=$DURATION secs"
    echo "--file FILE           : Use sound FILE"
    echo "--debug|-v (multiple) : increment debug level"
    echo "-?|--help             : usage"
    echo ""
    echo "commands:"
    echo "alsa-devices          : list ALSA hw devices"
    echo "list-devices          : list audio devices"
    echo "gen                   : sine signal generator RIGHT=$RIGHT_FREQ Hz, LEFT=$LEFT_FREQ Hz, GAIN=$GAIN DURATION=$DURATION s"
    echo "sine                  : generate 'sine FILE'"
    echo "play                  : play FILE"
    echo ""
    echo "Examples:"
    echo ""
    echo
    echo "# generate sine wave LEFT_FREQ=$LEFT_FREQ, RIGHT_FREQ=$RIGHT_FREQ to sound FILE=$FILE w"
    echo "$0 sine"
    echo ""
    echo "# play sound FILE=$FILE"
    echo "$0 play"
    echo ""

}

init_audio_out() {
    # Try USB ADC card
    log 2 "Init audio starts"
    log 3 "Audio devices $(aplay -L | grep '^hw:')"
    AUDIO_OUT=$(aplay -L | grep '^hw:CARD=Audio'); 
    if [ -z "$AUDIO_OUT" ]; then
        AUDIO_OUT=$(aplay -L | grep '^hw:CARD=SE')
    fi
    if [ -z "$AUDIO_OUT" ]; then
        AUDIO_OUT=$(aplay -L | grep '^hw:CARD=Headphones')
    fi
    if [ -z "$AUDIO_OUT" ]; then
        log 1 "Could not set AUDIO_OUT from $(aplay -L | grep '^hw:') devices"
    fi

}

# Options - after functions


# ------------------------------------------------------------------
while :
do
    if [ -z "$1" ]; then
	    break
    fi

    log 3 "Check option for '$1'"

    case "$1" in
        
	--sh_trace|--sh-trace)
	    set -x
	    shift
	    ;;
    
	--volume)
	    shift
	    VOLUME=$1; shift
	    ;;

	--gain)
	    shift
	    GAIN=$1; shift
	    ;;
    
	--mono)
	    shift
	    MONO_OR_STEREO_CMD=",pan=mono|c0=0.5*c0+0.5*c1"
	    ;;
    
	--rgain)
	    shift
	    RGAIN=$1; shift
	    ;;

	--lgain)
	    shift
	    LGAIN=$1; shift
	    ;;

	--device)
	    shift
	    AUDIO_OUT=$1; shift
        log 2 "Opiotion --device $AUDIO_OUT"
	    ;;

	--left)
	    shift
	    # LEFT_FREQ=$1; shift
	    LEFT_FREQ=$(($1+0)); shift
	    ;;
    
	--file)
	    shift
	    FILE=$1; shift
	    ;;
    
	--duration)
	    shift
	    DURATION=$1; shift
        log 1 "set DURATION=$DURATION"
	    ;;
    
	--right)
	    shift
	    # RIGHT_FREQ=$1; shift
	    RIGHT_FREQ=$(($1+0)); shift
	    ;;
    
	
	--debug|-v)
	    shift
	    DEBUG=`expr $DEBUG + 1`
	    log 1 "DEBUG=$DEBUG"
	    ;;


	-\?|--help)
	    usage
	    exit 2
	    ;;

	
	 '--')
	    break
	    ;;

	,*)
	    break
	    ;;
    esac
done

if [ -z "$AUDIO_OUT" -o  "$AUDIO_OUT" = "-" ]; then
    log 1 "Call init audio"
    init_audio_out
fi    
log 1 "Using AUDIO_OUT=$AUDIO_OUT"

if  [ -z "$FILE" ]; then
    FILE=$SOUND_DIR/sine-${LEFT_FREQ}l-${RIGHT_FREQ}r-${DURATION}s.wav
fi

# ------------------------------------------------------------------
# actions

# Output usage - if no commands given
if [  $# -lt 1 ]; then
    usage
    exit 2
fi

DURATION_CMD=""
if [ $DURATION -gt 0 ]; then
   DURATION_CMD=":d=$DURATION"
fi
log 3 "DURATION_CMD=$DURATION_CMD"

while :
do

    log 3 "cmdline parameters left $#"
    if [  $# -lt 1 ]; then
	    break
    fi

    CMD=$1
    shift

    case "$CMD" in


        version) 
	        echo "$0 - $VERSION"
	        ;;

        true)
            ;;

        list-devices) 
            aplay -l
            echo "------------------------------------------------------------------"
            echo "Hardware devices"
            aplay -L | grep "^hw:"
            echo "------------------------------------------------------------------"
            echo "ffmpeg sinks"
            ffmpeg -sinks
	        ;;
        
        alsa-devices) 
            echo "------------------------------------------------------------------"
            echo "Alsa Hardware devices"
            aplay -L | grep "^hw:"
	        ;;
            

        play)
            echo "Running in host '$(hostname)' on $(date)"
            echo "FILE=$FILE"
            echo "AUDIO_OUT=$AUDIO_OUT"
            # ffplay -f lavfi "aevalsrc=exprs=sin(2*PI*${LEFT_FREQ}*t)|sin(2*PI*${RIGHT_FREQ}*t)" -ac 2
            set -x
            ffplay  -hide_banner \
                    -autoexit \
                    -f alsa $AUDIO_OUT \
                    $FILE
            set +x
            ;;
	    
        fplay)
            echo "Running in host '$(hostname)' on $(date)"
            echo "FILE=$FILE"
            echo "AUDIO_OUT=$AUDIO_OUT"
            # ffplay -f lavfi "aevalsrc=exprs=sin(2*PI*${LEFT_FREQ}*t)|sin(2*PI*${RIGHT_FREQ}*t)" -ac 2
            set -x
            ffmpeg \
                    -f alsa $AUDIO_OUT \
                    -i $FILE
            set +x
            ;;

        gen-stereo)
            echo "Running in host '$(hostname)' on $(date)"
            echo "LEFT_FREQ=$LEFT_FREQ, RIGHT_FREQ=$RIGHT_FREQ, FILE=$FILE"            
            echo "AUDIO_OUT=$AUDIO_OUT"
            echo "RGAIN=$RGAIN"
            echo "LGAIN=$LGAIN"
            echo "DURATION_CMD=$DURATION_CMD"
            echo "MONO_OR_STEREO_CMD=$MONO_OR_STEREO_CMD"
            set -x
            ffmpeg \
                -hide_banner -nostdin -y \
                -f lavfi -i "sine=frequency=$LEFT_FREQ$DURATION_CMD" \
                -f lavfi  -i "sine=frequency=$RIGHT_FREQ$DURATION_CMD" \
                -filter_complex "join=inputs=2[joined];[joined]aeval=$LGAIN*val(ch)|$RGAIN*val(ch)${MONO_OR_STEREO_CMD}[aout]" \
                -map "[aout]" \
                -ac 2 \
                -f alsa hw:CARD=Audio,DEV=0
            set +x
            ;;


        gen2)
            echo "Running in host '$(hostname)' on $(date)"
            echo "LEFT_FREQ=$LEFT_FREQ, RIGHT_FREQ=$RIGHT_FREQ, FILE=$FILE"            
            echo "AUDIO_OUT=$AUDIO_OUT"
            echo "RGAIN=$RGAIN"
            echo "LGAIN=$LGAIN"
            echo "DURATION_CMD=$DURATION_CMD"
            set -x
            ffmpeg \
                -hide_banner -nostdin -y \
                -f lavfi -i "sine=frequency=$LEFT_FREQ$DURATION_CMD" \
                -f lavfi  -i "sine=frequency=$RIGHT_FREQ$DURATION_CMD" \
                -filter_complex "join=inputs=2[joined];[joined]aeval=$LGAIN*val(ch)|$RGAIN*val(ch)[aout]" -map "[aout]" \
                -f alsa $AUDIO_OUT
            set +x
            ;;

        gen)
            # Config command
            echo "DURATION_CMD=$DURATION_CMD"
            echo "LEFT_FREQ=$LEFT_FREQ, RIGHT_FREQ=$RIGHT_FREQ"            
            echo "AUDIO_OUT=$AUDIO_OUT"
            echo "GAIN=$GAIN"
            echo "FILE=$FILE"
            echo "MONO_OR_STEREO_CMD=$MONO_OR_STEREO_CMD"
            (set -x ; ffmpeg \
                -hide_banner -nostdin -y \
                 -f lavfi -i "sine=frequency=$LEFT_FREQ$DURATION_CMD" \
                 -f lavfi  -i "sine=frequency=$RIGHT_FREQ$DURATION_CMD"  \
                 -filter_complex "join, volume=volume=$GAIN ${MONO_OR_STEREO_CMD}[aout]" \
                 -map "[aout]" -ac 2 -f alsa $AUDIO_OUT \
                 )
            ;;
	    
        sine)
            echo "Running in host '$(hostname)' on $(date)"
            echo "LEFT_FREQ=$LEFT_FREQ, RIGHT_FREQ=$RIGHT_FREQ, FILE=$FILE"
            set -x 
            ffmpeg -nostdin -y \
                    -filter_complex "aevalsrc=exprs=sin(2*PI*$LEFT_FREQ*t)|sin(2*PI*$RIGHT_FREQ*t):s=44100:d=$DURATION" \
                    -ac 2 \
                    $FILE
            set +x
            ls -ltr $FILE
            ;;
	    
	    
	    ,*)
	        usage
	        echo  "Unknown action: $CMD"
	        exit 3
	        ;;

    esac

done


# https://stackoverflow.com/questions/5109038/linux-sine-wave-audio-generator
# ffplay -nodisp -f lavfi -i "sine=f=1000"
# ffplay -nodisp -f lavfi -i "sine=frequency=1000:sample_rate=44100:duration=10:channels=1[outl];sine=frequency=1500:sample_rate=44100:duration=10:channels=1[outr];[outl][outr]amerge=inputs=2" -ac 2
# ffplay -f lavfi "aevalsrc=exprs=sin(2*PI*1000*t)|sin(2*PI*1500*t):s=44100:d=10" -ac 2
#+END_SRC

** Copy source ~resouces~ - directory

#+call: src-rsync[:dir .](SDIR="resources/", DDIR="resources/"")

#+RESULTS:
#+begin_example
Rsync SDIR=resources/ from host=eero to jrr5.local:resources/ on ma 17.3.2025 09.10.02 +0200
rsync -a --delete --update --verbose --checksum --recursive resources/ jrr5:resources/
total 20
drwxrwxr-x 2 jj jj   10 maalis 16 15:04 sprite
-rw-rw-r-- 1 jj jj 1483 maalis 16 15:04 08-keyboard-nok.svg
-rw-rw-r-- 1 jj jj 2336 maalis 16 15:04 07-keyboard-ok.svg
drwxrwxr-x 3 jj jj    4 maalis 16 19:24 channels
sending incremental file list
./
07-keyboard-ok.svg
08-keyboard-nok.svg
channels/
channels/rondo.yaml
channels/icons/
channels/icons/rondo.png
sprite/
sprite/01-net-ok.png
sprite/02-net-nok.png
sprite/03-stream-play.png
sprite/04-stream-paused.png
sprite/05-dot.png
sprite/06-dash.png
sprite/07-keyboard-ok.png
sprite/08-keyboard-nok.png

sent 229.609 bytes  received 271 bytes  153.253,33 bytes/sec
total size is 228.310  speedup is 0,99
#+end_example

** Copy config ~cnf~ -directory

#+call: src-rsync[:dir .](SDIR="cnf/", DDIR="cnf/"")

#+RESULTS:
#+begin_example
Rsync SDIR=cnf/ from host=eero to jrr5.local:cnf/ on ma 17.3.2025 10.16.56 +0200
rsync -a --delete --update --verbose --checksum --recursive cnf/ jrr5:cnf/
total 14
-rw-rw-r-- 1 jj jj 343 maalis 16 19:21 jrr_streams.yaml
drwxrwxr-x 2 jj jj  16 maalis 17 10:16 icons
sending incremental file list
./
icons/
icons/JÄRVIRADIO.png
icons/YLE-1.png
icons/YLE-SUOMI.png
icons/classic.png
icons/jrr-help.png
icons/jrr-stop.png
icons/jrr.png
icons/järviradio.png
icons/järviratio.png
icons/radio-suomi.png
icons/rondo.png
icons/yle-1.jpeg
icons/yle-puhe.png
icons/yle-radio-1.png

sent 128.553 bytes  received 293 bytes  257.692,00 bytes/sec
total size is 127.565  speedup is 0,99
#+end_example

** Create =~/icons/v2=

Show icon files to copy to dest
#+BEGIN_SRC bash :eval no-export :results output :dir .
echo "Running in host '$(hostname)' on $(date)"
ls runner/icons
#+END_SRC

#+RESULTS:
#+begin_example
Running in host 'eero' on ma 13.1.2025 14.10.09 +0200
classic.png
järviradio.png
järviratio.png
jrr-help.png
jrr.png
jrr-stop.png
radio-suomi.png
rondo.png
yle-1.jpeg
yle-puhe.png
yle-radio-1.png
#+end_example

#+BEGIN_SRC bash :eval no-export :results output :dir .
echo "Running in host '$(hostname)' on $(date)"
SDIR=runner/icons/
DDIR=.icons/
rsync -a  --verbose  --checksum --recursive  $SDIR/ jrr5:$DDIR/
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ma 13.1.2025 14.35.31 +0200
: sending incremental file list
: ./
: JÄRVIRADIO.png
: 
: sent 8.087 bytes  received 38 bytes  5.416,67 bytes/sec
: total size is 186.874  speedup is 23,00


Show icons on destination
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in host '$(hostname)' on $(date)"
ls -ltr .icons
#+END_SRC

#+RESULTS:
#+begin_example
Running in host 'jrr5' on Mon Jan 13 14:17:34 EET 2025
total 200
-rw-r--r-- 1 pi pi  8584 Mar 16  2020 yle-radio-1.png
-rw-r--r-- 1 pi pi  7501 Mar 16  2020 radio-suomi.png
-rw-r--r-- 1 pi pi  6805 Mar 16  2020 yle-puhe.png
-rw-r--r-- 1 pi pi 30975 Mar 16  2020 järviradio.png
-rw-r--r-- 1 pi pi  9873 Mar 16  2020 jrr.png
-rw-r--r-- 1 pi pi 11144 Mar 16  2020 jrr-stop.png
-rw-rw-r-- 1 pi pi 33672 Mar 17  2020 classic.png
-rw-rw-r-- 1 pi pi 25408 Mar 17  2020 järviratio.png
-rw------- 1 pi pi  8251 May  8  2020 jrr-help.png
-rw-rw-r-- 1 pi pi 29271 Mar 26  2023 rondo.png
-rw-rw-r-- 1 pi pi  2123 Dec 13 12:50 yle-1.jpeg
drwxr-xr-x 2 pi pi  4096 Dec 13 12:52 v2
#+end_example

Help on conversion
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
python3 jrr.py --help
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi host 'jrr5' on Mon Jan 13 14:17:58 EET 2025
usage: jrr.py [-v] [--disable_existing_loggers] [--help] {radio,convert} ...

positional arguments:
  {radio,convert}       Commands
    radio               Run radio daemon
    convert             Convert icons

options:
  -v, --verbose
  --disable_existing_loggers
                        Default True (=imported loggers disabled)
  --help                help for help if you need some help
Command 'radio'
usage: jrr.py radio [-h]

options:
  -h, --help  show this help message and exit

Command 'convert'
usage: jrr.py convert [-h] [--icons-from ICONS_FROM] [--icons-to ICONS_TO]
                      [--width WIDTH] [--height HEIGHT] [--yes] [--bw]

options:
  -h, --help            show this help message and exit
  --icons-from ICONS_FROM
                        Icon images from '/home/pi/.icons')
  --icons-to ICONS_TO   Icon images to '/home/pi/.icons/v2')
  --width WIDTH         Display width '200')
  --height HEIGHT       Display height '200')
  --yes, -y             Override '(default = False')
  --bw                  Black and white '(default = False = color')

#+end_example

Convert iconns

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
python3 test.py convert  --yes
#+END_SRC


#+RESULTS:
#+begin_example
Running in /home/pi host 'jrr5' on Mon Jan 13 14:35:36 EET 2025
/home/pi/.icons/v2/jrr.png - created
/home/pi/.icons/v2/jrr-help.png - created
/home/pi/.icons/v2/jrr-stop.png - created
/home/pi/.icons/v2/järviradio.png - created
/home/pi/.icons/v2/JÄRVIRADIO.png - created
/home/pi/.icons/v2/yle-radio-1.png - created
/home/pi/.icons/v2/yle-1.jpeg - created
/home/pi/.icons/v2/järviratio.png - created
/home/pi/.icons/v2/classic.png - created
/home/pi/.icons/v2/yle-puhe.png - created
/home/pi/.icons/v2/YLE-SUOMI.png - created
/home/pi/.icons/v2/rondo.png - created
/home/pi/.icons/v2/radio-suomi.png - created
/home/pi/.icons/v2/YLE-1.png - created
#+end_example

** Deploy app
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
echo "var=$var"

#+END_SRC

#+call: src-rsync[:dir .](SDIR="bin/", DDIR="jrr/bin/"")

#+RESULTS:
: Rsync SDIR=bin/ from host=eero to jrr5.local:jrr/bin/ on ti 1.7.2025 16.08.12 +0300
: rsync -a --delete --update --verbose --checksum --recursive bin/ jrr5:jrr/bin/
: total 5
: -rwxr-xr-x 1 jj jj 6699 heinä   1 16:05 jrr.sh
: sending incremental file list
: 
: sent 93 bytes  received 19 bytes  224,00 bytes/sec
: total size is 6.699  speedup is 59,81

#+call: src-rsync[:dir .](SDIR="jrr.py", DDIR="jrr/")

#+RESULTS:
: Rsync SDIR=jrr.py from host=eero to jrr5.local:jrr on ti 1.7.2025 15.16.08 +0300
: rsync -a --delete --update --verbose --checksum --recursive jrr.py jrr5:jrr
: -rwxr-xr-x 1 jj jj 128 tammi  14 08:54 jrr.py
: sending incremental file list
: jrr.py
: 
: sent 249 bytes  received 35 bytes  568,00 bytes/sec
: total size is 128  speedup is 0,45


#+call: src-rsync[:dir .](SDIR="src/", DDIR="jrr/src.init/")

#+RESULTS:
#+begin_example
Rsync SDIR=src/ from host=eero to jrr5.local:jrr/src.init/ on to 3.7.2025 13.33.17 +0300
rsync -a --delete --update --verbose --checksum --recursive src/ jrr5:jrr/src.init/
total 364
-rw-rw-r-- 1 jj jj  6032 joulu   9  2024 epd2in13b_V3.py
-rw-rw-r-- 1 jj jj  5904 joulu   9  2024 epd2in13bc.py
drwxrwxr-x 3 jj jj     3 joulu   9  2024 lib
-rw-rw-r-- 1 jj jj 12641 joulu   9  2024 epd2in13d.py
-rw-rw-r-- 1 jj jj   108 joulu  11  2024 pushbutton_coro.py
-rw-rw-r-- 1 jj jj 13797 joulu  13  2024 epd2in13d_async.py
-rw-rw-r-- 1 jj jj   230 joulu  13  2024 convert.py
-rw-rw-r-- 1 jj jj    86 joulu  14  2024 exceptions.py
-rw-rw-r-- 1 jj jj  7577 joulu  16  2024 epd2in13b_V3_async.py
-rw-rw-r-- 1 jj jj  6818 joulu  16  2024 epd2in13bc_async.py
-rw-rw-r-- 1 jj jj 10812 joulu  18  2024 epdconfig_async.py
-rw-rw-r-- 1 jj jj  7585 joulu  18  2024 epd2in7b_V2_async.py
drwxrwxr-x 2 jj jj    21 joulu  19  2024 pic
-rw-rw-r-- 1 jj jj  2886 joulu  29  2024 spriter.py
-rw-rw-r-- 1 jj jj  1097 joulu  29  2024 clock_coro.py
drwxrwxr-x 2 jj jj     7 joulu  30  2024 examples
-rw-rw-r-- 1 jj jj 20517 joulu  30  2024 epd2in7_V2_async.py
-rw-rw-r-- 1 jj jj  6388 tammi   9 19:12 test_image.py
-rw-rw-r-- 1 jj jj  1594 tammi  11 11:44 publish_subsrcibe.py
-rwxr-xr-x 1 jj jj  4459 tammi  15 10:30 demo_keyboard.py
-rw-rw-r-- 1 jj jj  8960 tammi  17 12:41 streamer_coro.py
-rw-rw-r-- 1 jj jj  2309 maalis 14 14:02 reader_coro.py
-rw-rw-r-- 1 jj jj   343 maalis 16 19:21 jrr_streams.yaml
-rw-rw-r-- 1 jj jj 17170 touko   8 12:05 dscreen.py
-rw-rw-r-- 1 jj jj   833 touko   8 15:47 helpers.py
-rw-rw-r-- 1 jj jj  5420 touko   8 15:57 kb_coro.py
-rw-rw-r-- 1 jj jj  3226 touko   9 20:35 tft_ili9486.py
-rwxrwxr-x 1 jj jj     0 touko   9 20:37 __init__.py
-rw-rw-r-- 1 jj jj  4399 touko  16 10:54 gpio_coro.py
-rw-rw-r-- 1 jj jj  3063 touko  16 12:31 stdin_coro.py
drwxrwxr-x 3 jj jj    28 touko  16 12:31 debug
-rwxr-xr-x 1 jj jj 13966 touko  21 12:21 demo_ili9486.py
drwxrwxr-x 4 jj jj    12 touko  22 10:55 Python_ILI9486
-rw-rw-r-- 1 jj jj  6477 touko  22 11:01 console.py
-rw-rw-r-- 1 jj jj  4910 touko  28 09:08 jrr.py
-rw-rw-r-- 1 jj jj  9210 touko  30 10:00 kb.py
drwxrwxr-x 2 jj jj     5 kesä    2 10:50 resources
-rw-rw-r-- 1 jj jj   839 kesä    6 08:46 wifi.py
-rw-rw-r-- 1 jj jj  2064 kesä    6 14:10 network_coro.py
-rw-rw-r-- 1 jj jj 10151 kesä    9 09:55 channel_manager.py
drwxrwxr-x 3 jj jj     4 kesä    9 13:35 cnf
-rw-rw-r-- 1 jj jj  4142 kesä   10 09:59 jrr_converter.py
-rw-rw-r-- 1 jj jj  1767 kesä   27 10:51 apu.py
-rw-rw-r-- 1 jj jj  1393 heinä   2 11:01 github.py
-rw-rw-r-- 1 jj jj  8156 heinä   2 11:03 utils.py
-rw-rw-r-- 1 jj jj 19170 heinä   2 14:38 messages.py
-rw-rw-r-- 1 jj jj 20034 heinä   2 14:46 screen_coro.py
-rw-rw-r-- 1 jj jj 12436 heinä   2 15:54 firmware.py
-rw-rw-r-- 1 jj jj  4997 heinä   2 15:59 config.py
-rw-rw-r-- 1 jj jj  1578 heinä   3 08:52 jrr_dapp.py
-rw-rw-r-- 1 jj jj 15666 heinä   3 09:03 constants.py
-rw-rw-r-- 1 jj jj 43070 heinä   3 09:07 screen.py
drwxrwxr-x 2 jj jj    60 heinä   3 09:07 __pycache__
-rw-rw-r-- 1 jj jj    10 heinä   3 11:55 VERSION
-rwxr-xr-x 1 jj jj 14396 heinä   3 12:29 jrr_streamer.sh
-rw-rw-r-- 1 jj jj 96556 heinä   3 13:31 jrr_radio.py
sending incremental file list

sent 14.743 bytes  received 37 bytes  9.853,33 bytes/sec
total size is 13.989.900  speedup is 946,54
#+end_example

Create symlink ~src~ pointing to ~src.init~ show ~src/VERSION~
#+name: src-init
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
cd jrr
rm -f src
ln -s src.init src
# ls -latr
cat src/VERSION
#+END_SRC

#+RESULTS: src-init
: Running in /home/pi host 'jrr5' on Thu Jul  3 14:46:26 EEST 2025
: 0.0.3-beta2

#+BEGIN_SRC bash :eval no-export :results output :dir .
echo "Running in $(pwd) host '$(hostname)' on $(date)"
cat src/VERSION
#+END_SRC

#+RESULTS:
: Running in /home/jj/work/jrr host 'eero' on to 3.7.2025 14.46.51 +0300
: 0.0.4-alpha1


** Create ~.venv~ with python installs
:PROPERTIES:
:header-args+: :dir  /ssh:jrr5:jrr
:END:


#+BEGIN_SRC bash :eval no-export :results output
echo "Creating .venv in  $(pwd) host '$(hostname)' on $(date)"
ls -latr .venv 2>&1; true
#+END_SRC

#+RESULTS:
: Creating .venv in  /home/pi/jrr host 'jrr5' on Tue Jul  1 15:23:18 EEST 2025
: ls: cannot access '.venv': No such file or directory

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
python -m venv .venv
#+END_SRC

#+RESULTS:
: Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 15:23:27 EEST 2025

Os python version
#+BEGIN_SRC bash :eval no-export :results output
  echo "Running in $(pwd) host '$(hostname)' on $(date)"
  which python 
  python --version
#+END_SRC

#+RESULTS:
: Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 15:24:20 EEST 2025
: /bin/python
: Python 3.11.2


Virtual env python version
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
.venv/bin/python3 --version
#+END_SRC

#+RESULTS:
: Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 15:24:26 EEST 2025
: Python 3.11.2

*** Install requirements from ~src/Python_ILI9486~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
ls -latr
#+END_SRC

#+RESULTS:
: Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 15:26:27 EEST 2025
: total 24
: -rwxr-xr-x  1 pi pi  128 Jan 14 08:54 jrr.py
: drwx------ 24 pi pi 4096 Jul  1 14:47 ..
: drwxr-xr-x  3 pi pi 4096 Jul  1 15:15 src.init
: drwxr-xr-x  3 pi pi 4096 Jul  1 15:20 bin
: drwxr-xr-x  5 pi pi 4096 Jul  1 15:23 .
: drwxr-xr-x  5 pi pi 4096 Jul  1 15:23 .venv


#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"

.venv/bin/pip install -r src.init/Python_ILI9486/requirements.txt
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 15:29:50 EEST 2025
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Collecting Pillow
  Downloading pillow-11.3.0-cp311-cp311-manylinux_2_27_aarch64.manylinux_2_28_aarch64.whl (6.0 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 6.0/6.0 MB 2.3 MB/s eta 0:00:00

Collecting rpi-lgpio
  Using cached https://www.piwheels.org/simple/rpi-lgpio/rpi_lgpio-0.6-py3-none-any.whl (11 kB)
Collecting spidev
  Downloading spidev-3.7.tar.gz (11 kB)
  Installing build dependencies ... [?25l- \ | / - \ done
[?25h  Getting requirements to build wheel ... [?25l- \ done
[?25h  Preparing metadata (pyproject.toml) ... [?25l- \ done
[?25hCollecting numpy
  Downloading numpy-2.3.1-cp311-cp311-manylinux_2_28_aarch64.whl (14.6 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 14.6/14.6 MB 2.0 MB/s eta 0:00:00

Collecting lgpio>=0.1.0.1
  Using cached lgpio-0.2.2.0-cp311-cp311-manylinux_2_34_aarch64.whl (364 kB)
Building wheels for collected packages: spidev
  Building wheel for spidev (pyproject.toml) ... [?25l- \ | / - \ done
[?25h  Created wheel for spidev: filename=spidev-3.7-cp311-cp311-linux_aarch64.whl size=42693 sha256=a8a9fb8cb9b5e6f89559afa5a9fba3c41c185d32ac5afdc1d8383b6b92f389ac
  Stored in directory: /home/pi/.cache/pip/wheels/e4/cc/1a/dfbbd5fd5c41025641f6589e53225f54387cb4c551461ef763
Successfully built spidev
Installing collected packages: spidev, lgpio, rpi-lgpio, Pillow, numpy
Successfully installed Pillow-11.3.0 lgpio-0.2.2.0 numpy-2.3.1 rpi-lgpio-0.6 spidev-3.7
#+end_example

Test ILI9486 -driver

#+call: ILI9486-example(TIMEOUT="10s")



*** Install ~evdev~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
.venv/bin/pip install evdev
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 16:01:32 EEST 2025
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Collecting evdev
  Downloading evdev-1.9.2.tar.gz (33 kB)
  Installing build dependencies ... [?25l- \ | / done
[?25h  Getting requirements to build wheel ... [?25l- \ done
[?25h  Preparing metadata (pyproject.toml) ... [?25l- \ done
[?25hBuilding wheels for collected packages: evdev
  Building wheel for evdev (pyproject.toml) ... [?25l- \ | / - \ | / - \ | done
[?25h  Created wheel for evdev: filename=evdev-1.9.2-cp311-cp311-linux_aarch64.whl size=113348 sha256=6fe9fccd4874b158b1c051032174767a92396e85df7a9f2a3e6392ae5a4c4629
  Stored in directory: /home/pi/.cache/pip/wheels/72/97/d0/ea1b02915719d1cdb6a8810aa7683524c7aceedc5812cdeed7
Successfully built evdev
Installing collected packages: evdev
Successfully installed evdev-1.9.2
#+end_example

*** Install ~pyyaml~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
.venv/bin/pip install pyyaml
#+END_SRC

#+RESULTS:
: Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 16:02:20 EEST 2025
: Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
: Collecting pyyaml
:   Using cached PyYAML-6.0.2-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl (736 kB)
: Installing collected packages: pyyaml
: Successfully installed pyyaml-6.0.2


*** Install ~requests~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
.venv/bin/pip install requests
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi/jrr host 'jrr5' on Tue Jul  1 16:02:34 EEST 2025
Looking in indexes: https://pypi.org/simple, https://www.piwheels.org/simple
Collecting requests
  Downloading requests-2.32.4-py3-none-any.whl (64 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 64.8/64.8 kB 536.9 kB/s eta 0:00:00

Collecting charset_normalizer<4,>=2
  Downloading charset_normalizer-3.4.2-cp311-cp311-manylinux_2_17_aarch64.manylinux2014_aarch64.whl (142 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 142.8/142.8 kB 2.3 MB/s eta 0:00:00

Collecting idna<4,>=2.5
  Using cached https://www.piwheels.org/simple/idna/idna-3.10-py3-none-any.whl (70 kB)
Collecting urllib3<3,>=1.21.1
  Downloading urllib3-2.5.0-py3-none-any.whl (129 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 129.8/129.8 kB 2.9 MB/s eta 0:00:00

Collecting certifi>=2017.4.17
  Downloading certifi-2025.6.15-py3-none-any.whl (157 kB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 157.7/157.7 kB 955.2 kB/s eta 0:00:00

Installing collected packages: urllib3, idna, charset_normalizer, certifi, requests
Successfully installed certifi-2025.6.15 charset_normalizer-3.4.2 idna-3.10 requests-2.32.4 urllib3-2.5.0
#+end_example

** Service ~jrr5~ and management script ~jrr.sh~
*** Järviradioradio management script ~bin/jrr.sh~

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"

#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Tue Jul  1 16:04:16 EEST 2025



#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
cat jrr/bin/jrr.sh
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi host 'jrr5' on Tue Jul  1 16:07:37 EEST 2025
#!/bin/bash
# Järviradioradion management script

# ------------------------------------------------------------------
# Default confits
VERSION=0.2
DEBUG=1                     # log verbosity
# JRR_LOG=                  # default daemon output not save to log file
JRR_DEBUG=""                # default WARNING, more -v's --> more output
# JRR_DEBUG="-v -v"  
ALL_LINES=""                # default - only one console line per time tick
# ALL_LINES="--all-lines"

# ------------------------------------------------------------------
# Subrus
usage() {
    echo 
    echo usage: $(basename $0)
    echo $0 - $VERSION
    echo ""
    echo "Järviradioradio controller script"
    echo ""
    echo "Usage:"
    echo "$0 [options]  -- <commands>"
    echo "options:"
    echo "--sh_trace"
    echo "--version             : print out version number && exit 0"
    echo "--debug|-v            : increment DEBUG='$DEBUG' level (in script $0)"
    echo "--jrr-debug           : increment JRR_DEBUG='$JRR_DEBUG' level "
    echo "--all-lines           : output all lines in console mode "
# echo "--jrr-log FILE        : daemon output JRR_LOG='$JRR_LOG'"
    echo "-?|--help             : usage"
    echo ""
    echo "commands:"
    echo "daemon                : Run jrr -application (as systemd service)"
    echo "daemon-kill           : Kill jrr -application (from systemd service \$MAINPID)"
    echo "kill                  : Stop jrr -service and finish also console output"
    echo "daemon-stop           : SIGTERM to jrr -application (from systemd service \$MAINPID)"
    echo "stop                  : Stop jrr -service"
    echo "start                 : start jrr -service"    
    echo "status                : Show process ids for jrr.py and ffmpeg streamer process"
    echo "kill-ffmpeg           : Kill ffmpeg streamer process"    
    echo ""
    echo "Examples:"
    echo ""
    echo ""

}

log() {
    local LEVEL=$1
    local MSG=$2
    if [ $DEBUG -ge $LEVEL ]; then
       	# echo $(date $TS_FORMAT): $0'|'$MSG 1>&2
       	echo "$MSG" 1>&2
    fi
}

kill_streamer() {
    killall ffmpeg
}


shutdown() {
    log 1 "Shutdown called - send SIGTERM to CHILD_PID=$CHILD_PID"
    kill -SIGTERM $CHILD_PID
    exit 0
}

do_stop() {
    if [ ! -z "$MAINPID" ]; then
        log 1 "do_stop: send SIGTERM to MAINPID=$MAINPID"                
        kill -SIGTERM $MAINPID
    else
        JRR_PID=$(pgrep -f jrr.py)
        if [ ! -z "$JRR_PID" ]; then
            log 1 "do_stop - send SIGTERM to JRR_PID=$JRR_PID"
            kill -SIGTERM $JRR_PID
        else
            log 1 "do_stop: no jrr.py process found"
        fi
    fi
}

do_kill() {
    JRR_PID=$(pgrep -f jrr.py)
    if [ ! -z "$JRR_PID" ]; then
        log 1 "do_kill: $JRR_ID still running - SIGKILL (-9)"
        kill -9 $JRR_PID
    else
        log 1 "do_kill: no jrr.py process found"
    fi
}



# ------------------------------------------------------------------
# Starting


MSG="'$(whoami)' runs '$0 $*' on '$(hostname):$(pwd)'"
log 1 "$MSG"
# logger "$MSG"

# ------------------------------------------------------------------
# Options section
while :
do
    if [ -z "$1" ]; then
	    break
    fi

    log 3 "Check option for '$1'"

    case "$1" in
        
	--sh_trace|--sh-trace)
	    set -x
	    shift
	    ;;
	
	--version)
        echo $0 VERSION=$VERSION
        exit 2
	    ;;
	
	--debug|-v)
	    shift
	    DEBUG=`expr $DEBUG + 1`
	    log 1 "DEBUG=$DEBUG"
	    ;;

	--jrr_debug|--jrr-debug)
	    shift
	    JRR_DEBUG="$JRR_DEBUG -v"
	    log 1 "setting JRR_DEBUG=$JRR_DEBUG"
	    ;;

	--all-lines|--all_lines)
	    shift
	    ALL_LINES="--all-lines"
	    log 1 "setting ALL_LINES=$ALL_LINES"
	    ;;

	# --jrr_log|--jrr-log)
	#     shift
	#     JRR_LOG=$1
	#     shift
	#     log 1 "setting JRR_LOG=$JRR_LOG"
	#     ;;


	-\?|--help)
	    usage
	    exit 2
	    ;;

	
	 '--')
	    break
	    ;;

	,*)
	    break
	    ;;
    esac
done

# ------------------------------------------------------------------
# Fix parameters for command use


# ------------------------------------------------------------------
# Command section
# Output usage - if no commands given
if [  $# -lt 1 ]; then
    usage
    exit 2
fi

while :
do

    log 3 "cmdline parameters left $#"
    if [  $# -lt 1 ]; then
	    break
    fi

    CMD=$1
    shift

    log 2 "CMD=$1"
    case "$CMD" in


        version) 
	        echo "$0 - $VERSION"
	        ;;
        
        kill-ffpmeg|kill-streamer) 
	        kill_streamer
	        ;;
        
        status)
            # (set -x; ps -ef | grep -e jrr -e ffmpeg -e python )

            P=$(ps -ef | grep 'jrr.sh daemon'  | grep -v grep)
            ISTAT2=$?
            echo "jrr.sh: status=$ISTAT2/$P"            
            
            P=$(ps -ef | grep jrr.py  | grep -v grep)
            ISTAT3=$?
            echo "jrr.py: status=$ISTAT3/$P"

	        P=$(ps -ef | grep ffmpeg | grep -v grep)
            ISTAT1=$?
            echo "ffmpeg: status=$ISTAT1/$P"
            
            if [ $ISTAT3 != 0  ]; then
                exit $ISTAT3
            fi
            if [ $ISTAT2 != 0  ]; then
                exit $ISTAT2
            fi
            if [ $ISTAT1 != 0 ]; then
                exit $ISTAT1
            fi
	        ;;
        
        daemon)
	        kill_streamer
            do_kill
            log 1 "User '$(whoami)' launching järviradioradio daemon"
            CMD=".venv/bin/python ./jrr.py $JRR_DEBUG radio $ALL_LINES"
            log 1 "User '$(whoami)' runs CMD='$CMD' in directory $(pwd) with PATH='$PATH'"
            trap shutdown SIGTERM
            $CMD 2>&1 &
            CHILD_PID=$!
            log 1 "Wait for CHILD_PID=$CHILD_PID"
            wait $CHILD_PID
            log 1 "järviradioradio '$CMD' - exits STATUS='$ISTAT'"
            # hopefully systemd is happy with this
            exit 0
	        ;;

        stop)
            sudo systemctl stop jrr
            # Continue with daemon stop
            kill_streamer
            do_stop
            ;;
        
        start)
            sudo systemctl start jrr
            ;;
        
        daemon-stop)
            kill_streamer
            do_stop
            ;;
        
        
        kill)
            sudo systemctl stop jrr
            # Continue with daemon stop
            kill_streamer
            do_stop
            sleep 1
            do_kill
            ;;
            
        daemon-kill)
            kill_streamer
            do_stop
            sleep 1
            do_kill
            ;;
        
        true)
            ;;

	    
	    ,*)
	        usage
	        echo  "Unknown action: $CMD"
	        exit 3
	        ;;

    esac

done

exit 0
#+end_example



Show version number
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
jrr.sh --version ; echo ISTAT=$?
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Tue Jul  1 16:08:34 EEST 2025
: /home/pi/jrr/bin/jrr.sh VERSION=0.2
: ISTAT=2

Help
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
jrr.sh --help ; echo ISTAT=$?
#+END_SRC

#+RESULTS:
#+begin_example
Running in /home/pi host 'jrr5' on Tue Jul  1 16:08:41 EEST 2025

usage: jrr.sh
/home/pi/jrr/bin/jrr.sh - 0.2

Järviradioradio controller script

Usage:
/home/pi/jrr/bin/jrr.sh [options]  -- <commands>
options:
--sh_trace
--version             : print out version number && exit 0
--debug|-v            : increment DEBUG='1' level (in script /home/pi/jrr/bin/jrr.sh)
--jrr-debug           : increment JRR_DEBUG='' level 
--all-lines           : output all lines in console mode 
-?|--help             : usage

commands:
daemon                : Run jrr -application (as systemd service)
daemon-kill           : Kill jrr -application (from systemd service $MAINPID)
kill                  : Stop jrr -service and finish also console output
daemon-stop           : SIGTERM to jrr -application (from systemd service $MAINPID)
stop                  : Stop jrr -service
start                 : start jrr -service
status                : Show process ids for jrr.py and ffmpeg streamer process
kill-ffmpeg           : Kill ffmpeg streamer process

Examples:


ISTAT=2
#+end_example

Stop ffpmeg process
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
jrr.sh kill-ffpmeg ; echo ISTAT=$?
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Mar 12 15:24:30 EET 2025
: ISTAT=0

Start järviradioradio daemon (this *hangs*)
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
jrr.sh daemon ; echo ISTAT=$?
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Mar 12 15:08:59 EET 2025
: ISTAT=1

Launch xterm and use ssh to run ~jrr.sh daemon~, instread
#+BEGIN_SRC elisp :noweb yes :results output :eval no-export :exports none 
(start-process "server" "buf-server" "xterm"  "-T" "jrr5 app" "-fa" "'Monospace'" "-fs" "12"  "-hold" "-e"  "bash" "-c" "ssh jrr5 'bin/jrr.sh daemon'")
#+END_SRC

#+RESULTS:

stop järviradioradio daemon (if it running)
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
jrr.sh stop ; echo ISTAT=$?
#+END_SRC
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
jrr.sh stop ; echo ISTAT=$?
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Mar 12 15:36:20 EET 2025
: ISTAT=1

*** Service configuration  ~jrr.service~ 
:PROPERTIES:
:header-args+: :var  SVC="jrr"
:ORDERED:  t
:END:

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
echo "SVC=$SVC"
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Mar 12 19:04:45 EET 2025
: SVC=jrr

#+BEGIN_SRC bash :eval no-export :results output
cat <<EOF | sudo tee /etc/systemd/system/$SVC.service
#
# jrr.service
#
# Admin
# - enabled -> started automagically on system boot
# - enter console mode = 'systemctl stop jrr'
# - stop console mode = 'jrr.sh kill'
# - check status 'jrr.sh status'
# - recover normal operation after console mode: 'systemctl restart jrr'
#
# Configuration
# - jrr.sh
#     - set log level for application
#     - console output option
# 

[Unit]
Description=Järvidio service
# After=network.target
# Before=shutdown.target
# StopWhenUnneeded=no  # defaults false

[Service]
Type=simple
# Three stop use cases
# 1) UI button 'reboot'
#     --> jrr.py exits
#     --> systemd ExecStart 'jrr.sh daemon'
#
# 2) Volume knob button
# -> jrr.py signal publish HALT (source GPIO)
# -> jrr.py stop coros, publish HALT_ACK
# -> jrr.py -> start piping console to LCD display
# -> jrr.py run system command 'sudo halt'
# -> systemd: kill -SIGTERM $MAINPID
# -> jrr.py (shutdown_handler_1st):
# -> systemd shuts down system
# -> systemd send SIGTERM to all remaing processes
# -> jrr.py (shutdown_handler_2nd): blank LCD && os.exit
#
# 3) Softare shutdown
# -> user systemctl stop jrr
# -> systemd: kill -SIGTERM $MAINPID
# -> jrr.py (shutdown_handler_1st):
# -> user jrr.sh stop () -> send SIGTERM
# -> user jrr.sh kill -> send SIGKILL
#
KillMode=none  
Restart=always
RestartSec=1
User=pi
Group=pi
# RemainAfterExit=yes
WorkingDirectory=/home/pi/jrr

ExecStart=/home/pi/jrr/bin/jrr.sh daemon

ExecStop=/home/pi/jrr/bin/jrr.sh daemon-stop

ExecReload=/home/pi/jrr/bin/jrr.sh daemon-kill
ExecReload=sleep 1
ExecReload=/home/pi/jrr/bin/jrr.sh daemon

TimeoutStopSec=infinity
StandardOutput=journal
StandardError=journal
    
[Install]
WantedBy=multi-user.target

EOF
#+END_SRC

#+RESULTS:
#+begin_example
#
# jrr.service
#
# Admin
# - enabled -> started automagically on system boot
# - enter console mode = 'systemctl stop jrr'
# - stop console mode = 'jrr.sh kill'
# - check status 'jrr.sh status'
# - recover normal operation after console mode: 'systemctl restart jrr'
#
# Configuration
# - jrr.sh
#     - set log level for application
#     - console output option
# 

[Unit]
Description=Järvidio service
# After=network.target
# Before=shutdown.target
# StopWhenUnneeded=no  # defaults false

[Service]
Type=simple
# Three stop use cases
# 1) UI button 'reboot'
#     --> jrr.py exits
#     --> systemd ExecStart 'jrr.sh daemon'
#
# 2) Volume knob button
# -> jrr.py signal publish HALT (source GPIO)
# -> jrr.py stop coros, publish HALT_ACK
# -> jrr.py -> start piping console to LCD display
# -> jrr.py run system command 'sudo halt'
# -> systemd: kill -SIGTERM 
# -> jrr.py (shutdown_handler_1st):
# -> systemd shuts down system
# -> systemd send SIGTERM to all remaing processes
# -> jrr.py (shutdown_handler_2nd): blank LCD && os.exit
#
# 3) Softare shutdown
# -> user systemctl stop jrr
# -> systemd: kill -SIGTERM 
# -> jrr.py (shutdown_handler_1st):
# -> user jrr.sh stop () -> send SIGTERM
# -> user jrr.sh kill -> send SIGKILL
#
KillMode=none  
Restart=always
RestartSec=1
User=pi
Group=pi
# RemainAfterExit=yes
WorkingDirectory=/home/pi

ExecStart=/home/pi/jrr/bin/jrr.sh daemon

ExecStop=/home/pi/jrr/bin/jrr.sh daemon-stop

ExecReload=/home/pi/jrr/bin/jrr.sh daemon-kill
ExecReload=sleep 1
ExecReload=/home/pi/jrr/bin/jrr.sh daemon

TimeoutStopSec=infinity
StandardOutput=journal
StandardError=journal
    
[Install]
WantedBy=multi-user.target

#+end_example


#+call: svc-reload()

#+RESULTS:
: Running in /home/pi host 'jrr5' on Sun May 18 17:42:06 EEST 2025

#+call: svc-status()

#+RESULTS:
#+begin_example
Status of SVC=jrr in host 'jrr5' on Sun May 18 17:40:27 EEST 2025
○ jrr.service - Järvidio service
     Loaded: loaded (/etc/systemd/system/jrr.service; enabled; preset: enabled)
     Active: inactive (dead) since Sun 2025-05-18 17:26:32 EEST; 13min ago
   Duration: 1min 43.292s
    Process: 592 ExecStart=/home/pi/bin/jrr.sh daemon (code=exited, status=0/SUCCESS)
    Process: 1319 ExecStop=/home/pi/bin/jrr.sh daemon-stop (code=exited, status=0/SUCCESS)
   Main PID: 592 (code=exited, status=0/SUCCESS)
        CPU: 19.462s

May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,277 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'clock': <Task pending name='clock' coro=<clock_coro() running at /home/pi/src/clock_coro.py:42> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[TaskGroup._on_task_done()]>
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,279 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'kb': <Task pending name='kb' coro=<kb_coro() running at /home/pi/src/kb_coro.py:150> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[TaskGroup._on_task_done()]>
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,280 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'stdin': <Task pending name='stdin' coro=<stdin_coro() running at /home/pi/src/stdin_coro.py:88> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[TaskGroup._on_task_done()]>
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,282 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'spy-default': <Task pending name='spy-default' coro=<reader_coro() running at /home/pi/src/reader_coro.py:51> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[TaskGroup._on_task_done()]>
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,283 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'buttons': <Task pending name='buttons' coro=<GPIO_button_coro() running at /home/pi/src/gpio_coro.py:159> wait_for=<Future pending cb=[Task.task_wakeup()]> cb=[TaskGroup._on_task_done()]>
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,285 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'screen': <Task finished name='screen' coro=<screen_coro() done, defined at /home/pi/src/screen_coro.py:466> result='screen - exiting'>
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,286 WARNING  [jrr_radio.py:1506] name: 'master' msg 'MsgHalt_HaltAck(message_type='HALT-ACK', source=<HALT_SOURCE.SIGNAL: 2>)' received -->  cancel task 'streamer': <Task finished name='streamer' coro=<streamer_coro() done, defined at /home/pi/src/streamer_coro.py:187> result="streamer_cor....SIGNAL: 2>)'">
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,287 WARNING  [jrr_radio.py:1755] system_shutdown: starting
May 18 17:26:33 jrr5 jrr.sh[629]: 2025-05-18:17:26:33,288 WARNING  [console.py:48] CONSOLE mode starting - outputting system logs to console
May 18 17:27:52 jrr5 jrr.sh[629]: 2025-05-18:17:27:52,281 WARNING  [jrr_radio.py:1769] shutdown_handler: started with signame SIGTERM, signum: 15
Warning: The unit file, source configuration file or drop-ins of jrr.service changed on disk. Run 'systemctl daemon-reload' to reload units.
#+end_example

Enable service (to persist boots)
#+call: svc-enable()

#+RESULTS:
: Enable of SVC=jrr in host jrr5 on Wed Mar 12 19:05:00 EET 2025
: Created symlink /etc/systemd/system/multi-user.target.wants/jrr.service → /etc/systemd/system/jrr.service.

#+call: svc-disable()

#+RESULTS:
: Disable of SVC=jrr in host jrr5 on Wed Mar 12 19:06:58 EET 2025
: sudo systemctl disable jrr

#+call: svc-restart()

#+RESULTS:
: Restart SVC=jrr in host jrr5 on Wed Mar 12 19:05:14 EET 2025

#+call: svc-start()

#+RESULTS:
: Start SVC=jrr in host jrr5 on Wed Mar 12 19:37:26 EET 2025

#+call: svc-stop()

#+RESULTS:
: Stop SVC=jrr in host jrr5 on Wed Mar 12 19:35:19 EET 2025

#+call: svc-status()

#+RESULTS:
#+begin_example
Status of SVC=jrr in host 'jrr5' on Wed Mar 12 19:07:04 EET 2025
× jrr.service - Järvidio service
     Loaded: loaded (/etc/systemd/system/jrr.service; enabled; preset: enabled)
     Active: failed (Result: exit-code) since Wed 2025-03-12 19:06:54 EET; 10s ago
   Duration: 69ms
    Process: 7255 ExecStart=/home/pi/bin/jrr.sh daemon (code=exited, status=1/FAILURE)
   Main PID: 7255 (code=exited, status=1/FAILURE)
        CPU: 71ms

Mar 12 19:06:54 jrr5 systemd[1]: jrr.service: Scheduled restart job, restart counter is at 5.
Mar 12 19:06:54 jrr5 systemd[1]: Stopped jrr.service - Järvidio service.
Mar 12 19:06:54 jrr5 systemd[1]: jrr.service: Start request repeated too quickly.
Mar 12 19:06:54 jrr5 systemd[1]: jrr.service: Failed with result 'exit-code'.
Mar 12 19:06:54 jrr5 systemd[1]: Failed to start jrr.service - Järvidio service.
#+end_example

#+call: svc-stop()

#+RESULTS:
: Stop SVC=jrr-shutdown in host jrr5 on Wed Mar 12 14:38:18 EET 2025

*** Running main ~jrr.py~ -manually

Issue command in terminal with session to ~pi@jrr5.local~

#+begin_example
killall ffmpeg ; .venv/bin/python ./jrr.py -v -v  radio |   tee ../tmp/apu.log
#+end_example

or launch xterm session with the command above

#+BEGIN_SRC elisp :noweb yes :results output :eval no-export :exports none 
(start-process "server" "buf-server" "xterm"  "-T" "app-run" "-fa" "'Monospace'" "-fs" "12"  "-hold" "-e"  "bash" "-c" "ssh jrr5 'ffmpeg ; .venv/bin/python ./jrr.py -v -v  radio |   tee tmp/apu.log'")
#+END_SRC

#+RESULTS:

*** Test management script ~bin/jrr.sh~

Issue command in terminal session (e.g. ssh jrr5)

#+begin_example
ffmpeg ; .venv/bin/python ./jrr.py -v -v  radio |   tee tmp/apu.log
#+end_example

or launch xterm with the command above

#+call: jrr-launch()

Check if it running
#+call: jrr-status()

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Mar 12 19:03:42 EET 2025
: Wed Mar 12 19:03:42 EET 2025: /home/pi/bin/jrr.sh|User 'pi' starting script '/home/pi/bin/jrr.sh' on host 'jrr5' in directory '/home/pi'
: pi          6247    6240  0 19:03 pts/1    00:00:00 grep ffmpeg
: ISTAT=0


: Running in /home/pi host 'jrr5' on Wed Mar 12 19:03:14 EET 2025
: Wed Mar 12 19:03:14 EET 2025: /home/pi/bin/jrr.sh|User 'pi' starting script '/home/pi/bin/jrr.sh' on host 'jrr5' in directory '/home/pi'
: pi          6046    6035  4 19:00 ?        00:00:06 ffmpeg -hide_banner -nostdin -i https://jarviradio.radiotaajuus.fi:9000/jr -filter_complex [0:a]volume=volume=1 ,pan=mono|c0=0.5*c0+0.5*c1[aout] -map [aout] -ac 2 -f alsa hw:CARD=Audio,DEV=0
: pi          6114    6106  0 19:03 pts/1    00:00:00 grep ffmpeg
: pi          6026    6017  7 19:00 ?        00:00:10 .venv/bin/python ./jrr.py -v radio
: ISTAT=0

Stop 
#+call: jrr-stop()

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Mar 12 19:03:34 EET 2025
: Wed Mar 12 19:03:34 EET 2025: /home/pi/bin/jrr.sh|User 'pi' starting script '/home/pi/bin/jrr.sh' on host 'jrr5' in directory '/home/pi'
: Wed Mar 12 19:03:34 EET 2025: /home/pi/bin/jrr.sh|Force stop
: Wed Mar 12 19:03:34 EET 2025: /home/pi/bin/jrr.sh|Stop Järviradioradio process id 6026
: ISTAT=1


** +Service ~jrr-shutdown~ and script ~shutdown.py~+

Ref http://www.barryhubbard.com/raspberry-pi/howto-raspberry-pi-raspbian-power-on-off-gpio-button/#comment-1232

No used, 

*** +Create script =~/bin/shutdown.py=+

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Fri May  9 10:13:44 EEST 2025


*Not used*
#+BEGIN_SRC bash :eval no :results output :
FILE=~/bin/shutdown.py
cat <<HERE | tee $FILE
#!/usr/bin/python
import RPi.GPIO as GPIO
import time
import subprocess
import logging
import logging.handlers

logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
handler = logging.handlers.SysLogHandler(address = '/dev/log')
formatter = logging.Formatter('%(module)s.%(funcName)s: %(message)s')
handler.setFormatter(formatter)
logger.addHandler(handler)       

# we will use the pin numbering to match the pins on the Pi, instead of the 
# GPIO pin outs (makes it easier to keep track of things)

# use the same pin that is used for the reset button (one button to rule them all!)
resetChannel = 26
logger.info("Using GPIO %s for shutdown  ", resetChannel)

GPIO.setmode(GPIO.BCM)
# GPIO.setmode(GPIO.BOARD)  
GPIO.cleanup(resetChannel)
# Using internal pullup
##GPIO.setup(resetChannel, GPIO.IN, pull_up_down = GPIO.PUD_UP)  
GPIO.setup(resetChannel, GPIO.IN ) 


edgeToCheck = True  # shutdown TRUE: switch opens and pull up raises True to input
## edgeToCheck = False # shutdown FALSE: switch closes to ground and False to input

# Assume script starts in stable state
buttonState1 = GPIO.input(resetChannel)

while True:
    #grab the current button state
    oldButtonState1 = buttonState1
    buttonState1 = GPIO.input(resetChannel)
    print( 'oldButtonState1=', oldButtonState1, 'buttonState1=', buttonState1)
    if buttonState1 != oldButtonState1:
      logger.warning("button state change %s -> %s on GPIO %s",
      oldButtonState1, buttonState1, resetChannel)       

    # check to see if button has been pushed and we are in correct state
    if buttonState1 != oldButtonState1 and buttonState1 == edgeToCheck:
      print( 'Shutdown starting')
      logger.warning("Shutdown started on state change in GPIO %s", resetChannel)
      subprocess.call('shutdown -h now', shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
      #subprocess.call('reboot', shell=True, stdout=subprocess.PIPE, stderr=subprocess.PIPE)

    #     
    time.sleep(.1)
HERE
chmod +x $FILE
#+END_SRC

*** +Test script =~/bin/shutdown.py=+

#+BEGIN_SRC sh :eval no-export :results output :var IP="jrr5"
ssh -t $IP sudo python bin/shutdown.py
#+END_SRC

#+RESULTS:

Now push button closing pin 5 to ground.

After shutdown close power (or long press to reboot)

*** +Add =~/bin/shutdown.py= to /erc/rc.local+

Default config

#+name: rc-local-show
#+BEGIN_SRC bash :eval no-export :results output
FILE=/etc/rc.local
echo "Content of FILE=$FILE  $(pwd) host '$(hostname)' on $(date)"
cat $FILE
#+END_SRC

#+RESULTS: rc-local-show
: Content of FILE=/etc/rc.local  /home/pi host 'jrr5' on Sun Jan 26 21:43:16 EET 2025


#+name: rc-local-change
#+BEGIN_SRC bash :eval no-export :results output
FILE=/etc/rc.local
ORIG=$FILE.orig1

echo "Init FILE=$FILE in $(pwd) host '$(hostname)' on $(date)"
if [ ! -f $FILE ]; then
    sudo touch $FILE
fi

if  [ ! -f $ORIG ] ; then
    echo No backup yet for $FILE - create $ORIG
    sudo cp $FILE $ORIG
    ## ls -ltr $ORIG
else
    echo $ORIG exists - not copied
fi
  ## Configure
START="added from org-document jrr5.org - start"
END="added from org-document jrr5.org - end"

echo "modifying $FILE on host '$(hostname)'"

sudo sed -i -e "/$START/,/$END/d" $FILE

cat <<HERE | sudo tee -a $FILE
# $START
echo "Starting shutdown.py in background"
python /home/pi/bin/shutdown.py &  
# $END
HERE
sudo chmod +x $FILE
#+END_SRC


#+RESULTS: rc-local-change
: Init FILE=/etc/rc.local in /home/pi host 'jrr5' on Sun Jan 26 21:51:06 EET 2025
: /etc/rc.local.orig1 exists - not copied
: modifying /etc/rc.local on host 'jrr5'
: # added from org-document jrr5.org - start
: echo "Starting shutdown.py in background"
: python /home/pi/bin/shutdown.py &  
: # added from org-document jrr5.org - end


#+call: rc-local-show()

#+RESULTS:
: Content of FILE=/etc/rc.local  /home/pi host 'jrr5' on Sun Jan 26 21:47:54 EET 2025
: # added from org-document jrr5.org - start
: echo "Starting shutdown.py in background"
: python /home/pi/bin/shutdown.py &  
: # added from org-document jrr5.org - end


#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
sudo rm -f /etc/rc.local
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Sun Jan 26 21:56:07 EET 2025

*** +systemd ~jrr-shutdown.service~+
:PROPERTIES:
:header-args+: :var  SVC="jrr-shutdown"
:END:

#+BEGIN_SRC bash :eval no :results output 
cat <<EOF | sudo tee /etc/systemd/system/$SVC.service
[Unit]
Description=Järvidio shutdown service


[Service]
Type=simple
# Restart=always
# RestartSec=1
# ExecStart=/home/pi/bin/shutdown.py
ExecStart=/bin/bash -c "dmesg -w | /home/pi/src/demo_ili9486.py pipe"
# RemainAfterExit=true
#ExecStop=/bin/bash -c "dmesg -W | /home/pi/src/demo_ili9486.py pipe"
#ExecStop=/bin/bash -c "dmesg -w | /home/pi/src/demo_ili9486.py pipe"
StandardOutput=journal
StandardError=journal

    
[Install]
# WantedBy=multi-user.target
WantedBy=shutdown.target

EOF
#+END_SRC

#+RESULTS:
#+begin_example
[Unit]
Description=Järvidio shutdown service


[Service]
Type=simple
# Restart=always
# RestartSec=1
# ExecStart=/home/pi/bin/shutdown.py
ExecStart=/bin/bash -c "dmesg -w | /home/pi/src/demo_ili9486.py pipe"
# RemainAfterExit=true
#ExecStop=/bin/bash -c "dmesg -W | /home/pi/src/demo_ili9486.py pipe"
#ExecStop=/bin/bash -c "dmesg -w | /home/pi/src/demo_ili9486.py pipe"
StandardOutput=journal
StandardError=journal

    
[Install]
# WantedBy=multi-user.target
WantedBy=shutdown.target

#+end_example

*NOT USED*
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
sudo rm -f /etc/systemd/system/jrr-shutdown.service
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Thu May 22 12:12:45 EEST 2025


#+call: svc-status()

#+RESULTS:
: Status of SVC=jrr-shutdown in host 'jrr5' on Thu May 22 12:12:16 EEST 2025
: ○ jrr-shutdown.service - Järvidio shutdown service
:      Loaded: loaded (/etc/systemd/system/jrr-shutdown.service; disabled; preset: enabled)
:      Active: inactive (dead)


Should not exist
#+call: svc-status()

#+RESULTS:
: Status of SVC=jrr-shutdown in host 'jrr5' on Thu May 22 12:13:10 EEST 2025
: Unit jrr-shutdown.service could not be found.


*Notice*: shutdown service disbaled, because shutdown by in jrr-application
#+call: svc-disable()

* Admin
:PROPERTIES:
:header-args+: :dir  /ssh:jrr5:
:END:

** Troubleshooting
*** Ping IP

#+BEGIN_SRC bash :eval no-export :results output :dir .
echo "Running in host '$(hostname)' on $(date)"
echo "JRR5_IP=$JRR5_IP"
#+END_SRC

#+RESULTS:
: Running in host 'eero' on ke 30.4.2025 08.58.38 +0300
: JRR5_IP=192.168.1.241


#+call: ping-ip[:dir "."]()

#+RESULTS:
: Ping JRR5_IP=192.168.1.241 on ke 30.4.2025 08.58.41 +0300
: PING 192.168.1.241 (192.168.1.241) 56(84) bytes of data.
: 64 bytes from 192.168.1.241: icmp_seq=1 ttl=64 time=5.36 ms
: 64 bytes from 192.168.1.241: icmp_seq=2 ttl=64 time=5.46 ms
: 64 bytes from 192.168.1.241: icmp_seq=3 ttl=64 time=3.04 ms
: 
: --- 192.168.1.241 ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2003ms
: rtt min/avg/max/mdev = 3.035/4.618/5.463/1.120 ms

*** Ping jrr5.local

#+call: ping-ip[:dir "."](JRR5_IP="jrr5.local")

#+RESULTS:
: Ping JRR5_IP=jrr5.local on ke 30.4.2025 08.58.46 +0300
: PING jrr5.local (192.168.1.241) 56(84) bytes of data.
: 64 bytes from jrr5.local (192.168.1.241): icmp_seq=1 ttl=64 time=2.65 ms
: 64 bytes from jrr5.local (192.168.1.241): icmp_seq=2 ttl=64 time=6.13 ms
: 64 bytes from jrr5.local (192.168.1.241): icmp_seq=3 ttl=64 time=5.84 ms
: 
: --- jrr5.local ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2004ms
: rtt min/avg/max/mdev = 2.650/4.871/6.125/1.575 ms

*** ssh connection

#+call: greet-tramp()

#+RESULTS:
: Greet Wed Apr 30 08:58:59 EEST 2025 from host 'jrr5' (using eshell tramp)

*** +Run Waveshare epaper demo in demo directory+
:PROPERTIES:
:header-args+: :dir /ssh:jrr5:tmp/RaspberryPi_JetsonNano/python/examples
:END:

Ref. chapger Waveshare epd demo, where examples are installed into

#+call: edp-demo-ls()

#+RESULTS:
: List DEMOS='epd*2in13*' for 2.13 inch display in host 'jrr5' on Wed Dec 18 08:15:27 EET 2024
: epd_2in13_V2_test.py  epd_2in13_test.py      epd_2in13bc_test.py
: epd_2in13_V3_test.py  epd_2in13b_V3_test.py  epd_2in13d_test.py
: epd_2in13_V4_test.py  epd_2in13b_V4_test.py  epd_2in13g_test.py

Choose one to run

#+call: edp-demo[](EXAMPLE="epd_2in13bc_test.py")

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in13bc_test.py' in /home/pi/tmp/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Fri Dec 13 08:35:53 EET 2024
-rw-r--r-- 1 pi pi 3768 Dec 22  2023 epd_2in13bc_test.py
INFO:root:epd2in13bc Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:Drawing
INFO:root:1.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:2.Drawing on the Vertical image...
DEBUG:waveshare_epd.epd2in13bc:Vertical
DEBUG:waveshare_epd.epd2in13bc:Vertical
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:3.read bmp file
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:4.read bmp file on window
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:Horizontal
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy
DEBUG:waveshare_epd.epd2in13bc:e-Paper busy release
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example

#+call: edp-demo[](EXAMPLE="epd_2in13b_V3_test.py")

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in13b_V3_test.py' in /home/pi/tmp/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Thu Dec 12 22:17:05 EET 2024
-rwxr-xr-x 1 pi pi 3761 Dec 22  2023 epd_2in13b_V3_test.py
INFO:root:epd2in13b_V3 Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
INFO:root:Drawing
INFO:root:1.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in13b_V3:Horizontal
DEBUG:waveshare_epd.epd2in13b_V3:Horizontal
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
INFO:root:2.Drawing on the Vertical image...
DEBUG:waveshare_epd.epd2in13b_V3:Vertical
DEBUG:waveshare_epd.epd2in13b_V3:Vertical
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
INFO:root:3.read bmp file
DEBUG:waveshare_epd.epd2in13b_V3:Horizontal
DEBUG:waveshare_epd.epd2in13b_V3:Horizontal
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
INFO:root:4.read bmp file on window
DEBUG:waveshare_epd.epd2in13b_V3:Horizontal
DEBUG:waveshare_epd.epd2in13b_V3:Horizontal
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy
DEBUG:waveshare_epd.epd2in13b_V3:e-Paper busy release
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example

#+call: edp-demo[](EXAMPLE="epd_2in13d_test.py")

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in13d_test.py' in /home/pi/tmp/RaspberryPi_JetsonNano/python/examples host 'jrr5' on Mon Dec  9 12:53:36 EET 2024
-rw-r--r-- 1 pi pi 3146 Dec 22  2023 epd_2in13d_test.py
INFO:root:epd2in13d Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:1.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:3.read bmp file
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:4.read bmp file on window
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:5.show time...
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example

*** +Run waveshare epar in ~src~ directory+
:PROPERTIES:
:header-args+: :dir /ssh:jrr5:src/examples
:END:

Expect demo to run also unde src direcory
#+call: edp-demo-ls()

#+RESULTS:
: List DEMOS='epd*2in13*' for 2.13 inch display in host 'jrr5' on Mon Dec  9 13:03:06 EET 2024
: epd_2in13d_test.py

#+call: edp-demo[](EXAMPLE="epd_2in13d_test.py")

#+RESULTS:
#+begin_example
Running EXAMPLE='epd_2in13d_test.py' in /home/pi/src/examples host 'jrr5' on Mon Dec  9 13:03:28 EET 2024
-rw-rw-r-- 1 pi pi 3146 Dec  9 13:02 epd_2in13d_test.py
INFO:root:epd2in13d Demo
INFO:root:init and Clear
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:1.Drawing on the Horizontal image...
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:3.read bmp file
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:4.read bmp file on window
DEBUG:waveshare_epd.epd2in13d:Horizontal
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:5.show time...
INFO:root:Clear...
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
DEBUG:waveshare_epd.epd2in13d:e-Paper busy
DEBUG:waveshare_epd.epd2in13d:e-Paper busy release
INFO:root:Goto Sleep...
DEBUG:waveshare_epd.epdconfig:spi end
DEBUG:waveshare_epd.epdconfig:close 5V, Module enters 0 power consumption ...
#+end_example

*** Run ffmpeg directly

RUn using script
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
killall ffmpeg
/home/pi/src/jrr_streamer.sh --mono --file https://icecast.live.yle.fi/radio/YleRS/icecast.audio --gain 1 play
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Jan 15 13:26:26 EET 2025
: /home/pi/src/jrr_streamer.sh --mono --file https://icecast.live.yle.fi/radio/YleRS/icecast.audio --gain 1 play

Direct 
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
killall ffmpeg
ffmpeg -hide_banner -nostdin -i https://jarviradio.radiotaajuus.fi:9000/jr -filter_complex '[0:a]volume=volume=1 ,pan=mono|c0=0.5*c0+0.5*c1[aout]' -map '[aout]' -ac 2 -f alsa hw:CARD=Audio,DEV=0
#+END_SRC

#+BEGIN_SRC elisp :noweb yes :results output :eval no-export :exports none 
(start-process "server" "buf-server" "xterm"  "-T" "ffmpeg" "-fa" "'Monospace'" "-fs" "12"  "-hold" "-e"  "bash" "-c" "ssh jrr5 echo ffmpeg -hide_banner -nostdin -i https://jarviradio.radiotaajuus.fi:9000/jr -filter_complex \'[0:a]volume=volume=1 ,pan=mono|c0=0.5*c0+0.5*c1[aout]\' -map \'[aout]\' -ac 2 -f alsa hw:CARD=Audio,DEV=0")
#+END_SRC

#+RESULTS:

*** Admin services
**** SVC="jrr-shutdown"
:PROPERTIES:
:header-args+:   :var  SVC="jrr-shutdown"
:END:


#+call: svc-status()

#+RESULTS:
#+begin_example
Status of SVC=jrr-shutdown in host 'jrr5' on Wed Apr 30 09:03:30 EEST 2025
● jrr-shutdown.service - Järvidio shutdown service
     Loaded: loaded (/etc/systemd/system/jrr-shutdown.service; enabled; preset: enabled)
     Active: active (running) since Thu 2025-03-20 00:06:01 EET; 1 month 10 days ago
   Main PID: 403 (shutdown.py)
      Tasks: 4 (limit: 760)
        CPU: 3.808s
     CGroup: /system.slice/jrr-shutdown.service
             └─403 /usr/bin/python /home/pi/bin/shutdown.py

Mar 20 00:06:01 jrr5 systemd[1]: Started jrr-shutdown.service - Järvidio shutdown service.
Mar 20 00:06:04 jrr5 shutdown.<module>[403]: Using GPIO 26 for shutdown
#+end_example

#+call: svc-stop()

#+RESULTS:
: Stop SVC=jrr-shutdown in host jrr5 on Thu Feb 13 15:26:47 EET 2025

#+call: svc-start()

#+RESULTS:
: Start SVC=jrr-shutdown in host jrr5 on Thu Feb 13 12:35:58 EET 2025

#+call: svc-enable()

#+RESULTS:
: Enable of SVC=jrr-shutdown in host jrr5 on Thu Feb 13 12:36:18 EET 2025

**** SVC="jrr"
:PROPERTIES:
:header-args+:   :var  SVC="jrr"
:END:


#+call: svc-status()

#+RESULTS:
#+begin_example
Status of SVC=jrr in host 'jrr5' on Wed Apr 30 09:03:44 EEST 2025
● jrr.service - Järvidio service
     Loaded: loaded (/etc/systemd/system/jrr.service; enabled; preset: enabled)
     Active: active (running) since Wed 2025-04-30 08:57:02 EEST; 6min ago
   Main PID: 2715 (jrr.sh)
      Tasks: 6 (limit: 760)
        CPU: 30.365s
     CGroup: /system.slice/jrr.service
             ├─2715 /bin/bash /home/pi/bin/jrr.sh daemon
             └─2730 .venv/bin/python ./jrr.py -v radio

Apr 30 08:57:02 jrr5 systemd[1]: Started jrr.service - Järvidio service.
Apr 30 08:57:02 jrr5 jrr.sh[2715]: Wed 30 Apr 08:57:02 EEST 2025: /home/pi/bin/jrr.sh|User 'pi' starting script '/home/pi/bin/jrr.sh' with parameters 'daemon' on host 'jrr5' in directory '/home/pi'
Apr 30 08:57:02 jrr5 jrr.sh[2724]: ffmpeg: no process found
Apr 30 08:57:02 jrr5 jrr.sh[2715]: Wed 30 Apr 08:57:02 EEST 2025: /home/pi/bin/jrr.sh|User 'pi' launching järviradioradio daemon
Apr 30 08:57:02 jrr5 jrr.sh[2715]: Wed 30 Apr 08:57:02 EEST 2025: /home/pi/bin/jrr.sh|User 'pi' runs CMD='.venv/bin/python ./jrr.py -v radio' in directory /home/pi with PATH='/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin'
#+end_example

#+call: svc-stop()

#+RESULTS:
: Stop SVC=jrr in host jrr5 on Wed Apr 30 09:03:56 EEST 2025

#+call: svc-start()

#+RESULTS:
: Start SVC=jrr in host jrr5 on Thu Mar 13 17:15:44 EET 2025

#+call: svc-enable()

#+RESULTS:
: Enable of SVC=jrr-shutdown in host jrr5 on Thu Feb 13 12:36:18 EET 2025

**** Test ~jrr.sh~

#+call: jrr-status()

#+RESULTS:
: Running in /home/pi host 'jrr5' on Wed Apr 30 09:04:19 EEST 2025
: Wed Apr 30 09:04:19 EEST 2025: /home/pi/bin/jrr.sh|User 'pi' starting script '/home/pi/bin/jrr.sh' with parameters 'status' on host 'jrr5' in directory '/home/pi'
: ISTAT=1

Run ~jrr.sh~ -daemon on xterm session
#+call: jrr-launch()

#+RESULTS:

*** Check logs

Open xterm with ~journalctl -f~
#+call: syslog-tail()

#+RESULTS:

#+call: dmesg-tail()

#+RESULTS:

** Hello Worlds
*** ~tramp-path~: show path on remote

Notice: .profile loaded only for login shells

#+BEGIN_SRC bash :eval no-export :results output
hostname
shopt -q login_shell && echo 'Login shell' || echo 'Non-login shell'
#+END_SRC

#+RESULTS:
: jrr5
: Non-login shell


#+name: tramp-path
#+BEGIN_SRC bash :eval no-export :results output
echo "Path info in host '$(hostname)' on $(date) for user $(whoami)"
echo PATH=$PATH
#+END_SRC

#+RESULTS: tramp-path
: Path info host jrr5 on Wed Nov 20 15:13:47 EET 2024 for user pi
: PATH=/bin:/usr/bin:/sbin:/usr/sbin:/usr/local/bin:/usr/local/sbin

*** ~greet-tramp~: Test ssh connection (over emacs tramp)

#+name: greet-tramp
#+BEGIN_SRC bash :eval no-export :results output 
echo "Greet $(date) from host '$(hostname)' (using eshell tramp)"
#+END_SRC

#+RESULTS: greet-tramp
: Greet Tue Jun  4 10:13:54 AM EEST 2024 from host 'sorsa' (using eshell tramp)
*** ~greet-login~: Test ssh connection using login shell

#+name: greet-login
#+BEGIN_SRC sh :eval no-export :results output
echo 'echo PATH@$(hostname)--login=$PATH ' | bash --login
#+END_SRC

#+RESULTS: greet-login
: PATH@sorsa--login=/home/pi/.local/bin:/home/pi/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/local/games:/usr/games

*** ~ssh-path~: show path for ssh connection to TARGET

#+name: ssh-path
#+BEGIN_SRC bash :eval no-export :results output :dir "." :var TARGET="jrr5"
echo "call ssh TARGET=$TARGET from $(hostname) on $(date)"
ssh  $TARGET  'echo PATH@$(hostname)=$PATH'
#+END_SRC

#+RESULTS: ssh-path
: call ssh TARGET=jrr5 from eero on ke 20.11.2024 15.18.25 +0200
: PATH@jrr5=/usr/local/bin:/usr/bin:/bin:/usr/games

*** ~ping-ip~

#+BEGIN_SRC bash :eval no-export :results output :dir "."
echo Ping JRR5_IP=$JRR5_IP on $(date)
#+END_SRC

#+RESULTS:
: Ping JRR5_IP=192.168.100.106 on pe 2.8.2024 12.27.49 +0300


#+name: ping-ip
#+BEGIN_SRC sh :eval no-export :results output :noweb yes :dir "."
echo Ping JRR5_IP=$JRR5_IP on $(date)
ping -c 3 $JRR5_IP
#+END_SRC

#+RESULTS: ping-ip
: Ping JRR5_IP=192.168.100.106 on pe 2.8.2024 12.27.51 +0300
: PING 192.168.100.106 (192.168.100.106) 56(84) bytes of data.
: 64 bytes from 192.168.100.106: icmp_seq=1 ttl=64 time=0.043 ms
: 64 bytes from 192.168.100.106: icmp_seq=2 ttl=64 time=0.060 ms
: 64 bytes from 192.168.100.106: icmp_seq=3 ttl=64 time=0.078 ms
: 
: --- 192.168.100.106 ping statistics ---
: 3 packets transmitted, 3 received, 0% packet loss, time 2036ms
: rtt min/avg/max/mdev = 0.043/0.060/0.078/0.014 ms

** Os admin
*** ~hosti~: Hostname
Installation hostname

#+name: hosti
#+BEGIN_SRC bash :eval no-export :results output :exports both
echo $(hostname) on $(date)
#+END_SRC

#+RESULTS: hosti
: jrr5 on Tue Nov 19 13:41:36 EET 2024

#+RESULTS:
: sorsa

*** ~mem~: free memory

#+name: mem
#+BEGIN_SRC bash :eval no-export :results output
echo memory on $(hostname) on $(date)
free -h
#+END_SRC

#+RESULTS: mem
: memory on eero on ma 3.6.2024 23.00.25 +0300
:                total        used        free      shared  buff/cache   available
: Mem:            31Gi        23Gi       1,7Gi       3,2Gi       6,1Gi       4,1Gi
: Swap:          2,0Gi          0B       2,0Gi

#+RESULTS:
: sorsa
:                total        used        free      shared  buff/cache   available
: Mem:           909Mi       257Mi       139Mi        10Mi       512Mi       583Mi
: Swap:           99Mi          0B        99Mi


The RAM information of the Raspberry Pi system is also stored in the
memory information of a processor and you can retrieve this
information through the following command:
#+BEGIN_SRC bash :eval no-export :results output
cat /proc/meminfo
#+END_SRC

#+RESULTS:
#+begin_example
MemTotal:         931460 kB
MemFree:          142500 kB
MemAvailable:     597760 kB
Buffers:           23376 kB
Cached:           473824 kB
SwapCached:            0 kB
Active:            82968 kB
Inactive:         601576 kB
Active(anon):        944 kB
Inactive(anon):   197280 kB
Active(file):      82024 kB
Inactive(file):   404296 kB
Unevictable:          16 kB
Mlocked:              16 kB
SwapTotal:        102396 kB
SwapFree:         102396 kB
Dirty:                40 kB
Writeback:             0 kB
AnonPages:        187568 kB
Mapped:           136172 kB
Shmem:             10872 kB
KReclaimable:      27992 kB
Slab:              53608 kB
SReclaimable:      27992 kB
SUnreclaim:        25616 kB
KernelStack:        3852 kB
PageTables:         5636 kB
NFS_Unstable:          0 kB
Bounce:                0 kB
WritebackTmp:          0 kB
CommitLimit:      568124 kB
Committed_AS:    1234060 kB
VmallocTotal:   259653632 kB
VmallocUsed:       10988 kB
VmallocChunk:          0 kB
Percpu:              688 kB
CmaTotal:         262144 kB
CmaFree:          101604 kB
#+end_example

*** ~architecture~: Architecture

#+name: architecture
#+BEGIN_SRC bash :eval no-export :results output
uname -m
#+END_SRC

#+RESULTS: architecture
: aarch64

#+RESULTS:
: aarch64

*** ~top~:

#+name: top
#+BEGIN_SRC bash :eval no-export :results output
  echo "Top processes in host '$(hostname)' on $(date)"
  top -bn1 | head -20
#+END_SRC

#+RESULTS: top
#+begin_example
Top processes in host 'sorsa' on Wed Jun  5 02:30:54 PM EEST 2024
top - 14:30:54 up  6:15,  7 users,  load average: 0.33, 0.14, 0.10
Tasks: 226 total,   1 running, 225 sleeping,   0 stopped,   0 zombie
%Cpu(s): 11.1 us, 22.2 sy,  0.0 ni, 66.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st 
MiB Mem :   7809.0 total,   6130.4 free,    500.3 used,   1314.3 buff/cache     
MiB Swap:    200.0 total,    200.0 free,      0.0 used.   7308.7 avail Mem 

    PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND
  30759 pi        20   0   14240   4864   2816 R  11.8   0.1   0:00.04 top
      1 root      20   0  170060  13316   8760 S   0.0   0.2   0:20.17 systemd
      2 root      20   0       0      0      0 S   0.0   0.0   0:00.04 kthreadd
      3 root      20   0       0      0      0 S   0.0   0.0   0:00.00 pool_wo+
      4 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+
      5 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+
      6 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+
      7 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+
      9 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+
     12 root       0 -20       0      0      0 I   0.0   0.0   0:00.00 kworker+
     13 root      20   0       0      0      0 I   0.0   0.0   0:00.00 rcu_tas+
     14 root      20   0       0      0      0 I   0.0   0.0   0:00.00 rcu_tas+
     15 root      20   0       0      0      0 I   0.0   0.0   0:00.00 rcu_tas+
#+end_example

*** ~cpu-info~: CPU info

#+name: cpu-info
#+BEGIN_SRC bash :eval no-export :results output :exports both
cat /proc/cpuinfo
#+END_SRC

#+RESULTS: cpu-info
#+begin_example
processor	: 0
BogoMIPS	: 108.00
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd08
CPU revision	: 3

processor	: 1
BogoMIPS	: 108.00
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd08
CPU revision	: 3

processor	: 2
BogoMIPS	: 108.00
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd08
CPU revision	: 3

processor	: 3
BogoMIPS	: 108.00
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd08
CPU revision	: 3

Revision	: d03115
Serial		: 100000006ca06014
Model		: Raspberry Pi 4 Model B Rev 1.5
#+end_example

#+RESULTS:
#+begin_example
processor	: 0
BogoMIPS	: 38.40
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd03
CPU revision	: 4

processor	: 1
BogoMIPS	: 38.40
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd03
CPU revision	: 4

processor	: 2
BogoMIPS	: 38.40
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd03
CPU revision	: 4

processor	: 3
BogoMIPS	: 38.40
Features	: fp asimd evtstrm crc32 cpuid
CPU implementer	: 0x41
CPU architecture: 8
CPU variant	: 0x0
CPU part	: 0xd03
CPU revision	: 4

Hardware	: BCM2835
Revision	: a020d3
Serial		: 0000000021bed90e
Model		: Raspberry Pi 3 Model B Plus Rev 1.3
#+end_example

*** ~kernel-version~: Kernel version

#+name: kernel-version
#+BEGIN_SRC bash :eval no-export :results output :exports both
uname -a
#+END_SRC

#+RESULTS: kernel-version
: Linux sorsa 6.6.20+rpt-rpi-v8 #1 SMP PREEMPT Debian 1:6.6.20-1+rpt1 (2024-03-07) aarch64 GNU/Linux

: Linux sorsa 5.15.84-v8+ #1613 SMP PREEMPT Thu Jan 5 12:03:08 GMT 2023 aarch64 GNU/Linux

*** ~os-version~: Operating system release

#+name: os-version
#+BEGIN_SRC bash :eval no-export :results output :exports both
cat /etc/os-release
#+END_SRC

#+RESULTS: os-version
: PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
: NAME="Debian GNU/Linux"
: VERSION_ID="12"
: VERSION="12 (bookworm)"
: VERSION_CODENAME=bookworm
: ID=debian
: HOME_URL="https://www.debian.org/"
: SUPPORT_URL="https://www.debian.org/support"
: BUG_REPORT_URL="https://bugs.debian.org/"

#+RESULTS:
: PRETTY_NAME="Debian GNU/Linux 12 (bookworm)"
: NAME="Debian GNU/Linux"
: VERSION_ID="12"
: VERSION="12 (bookworm)"
: VERSION_CODENAME=bookworm
: ID=debian
: HOME_URL="https://www.debian.org/"
: SUPPORT_URL="https://www.debian.org/support"
: BUG_REPORT_URL="https://bugs.debian.org/"

*** Forget wlan

#+BEGIN_SRC bash :eval no-export :results output
  echo "Show known wlan configs in host '$(hostname)' on $(date)"
  sudo cat /etc/wpa_supplicant/wpa_supplicant.conf
#+END_SRC

#+RESULTS:
: Show known wlan configs in host 'sorsa' on Wed Jun  5 09:07:56 PM EEST 2024
: ctrl_interface=DIR=/var/run/wpa_supplicant GROUP=netdev
: update_config=1

#+begin_example
wpa_supplicant.conf is not used with the now default Network Manager.

Left click on the network icon and select [Advance Options] then [Edit Connections]
Select the connection and click on [-].
-OR-
Use the command line tool:


sudo nmtui

#+end_example

*** ~raspi-info~

#+BEGIN_SRC bash :eval no-export :results output
echo $(hostname)
raspinfo
#+END_SRC

#+RESULTS:
#+begin_example
welleri
System Information
------------------

Raspberry Pi 4 Model B Rev 1.5
PRETTY_NAME="Debian GNU/Linux 11 (bullseye)"
NAME="Debian GNU/Linux"
VERSION_ID="11"
VERSION="11 (bullseye)"

Raspberry Pi reference 2023-05-03
Generated using pi-gen, https://github.com/RPi-Distro/pi-gen, 7c750947a959fb626a70c09fd17c65815df192ac, stage4

Linux welleri 6.1.21-v8+ #1642 SMP PREEMPT Mon Apr  3 17:24:16 BST 2023 aarch64 GNU/Linux
Revision	: c03115
Serial		: 1000000061bcfc69
Model		: Raspberry Pi 4 Model B Rev 1.5
Throttled flag  : throttled=0x0
Camera          : supported=0 detected=0, libcamera interfaces=0

Videocore information
---------------------

Mar 17 2023 10:50:39 
Copyright (c) 2012 Broadcom
version 82f3750a65fadae9a38077e3c2e217ad158c8d54 (clean) (release) (start)

alloc failures:     0
compactions:        0
legacy block fails: 0

Filesystem information
----------------------
Filesystem     1K-blocks    Used Available Use% Mounted on
/dev/root      244762244 8221472 224034748   4% /
devtmpfs         1677960       0   1677960   0% /dev
tmpfs            1942184       0   1942184   0% /dev/shm
tmpfs             776876    1328    775548   1% /run
tmpfs               5120       4      5116   1% /run/lock
/dev/sda1         258094   31155    226939  13% /boot
tmpfs             388436      20    388416   1% /run/user/1000

Filename				Type		Size		Used		Priority
/var/swap                               file		102396		0		-2

Package version information
---------------------------
raspberrypi-ui-mods:
  Installed: 1.20230127
raspberrypi-sys-mods:
  Installed: 20230510~bullseye
openbox:
  Installed: 3.6.1-9+rpt1+deb11u1
lxpanel:
  Installed: 0.10.1-2+rpt19
pcmanfm:
  Installed: 1.3.2-1+rpt9
rpd-plym-splash:
  Installed: 0.32

Networking Information
----------------------

br-af637c9bbb91: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet x.x.x.x  netmask x.x.x.x  broadcast x.x.x.x
        inet6 y::y.y.y.y  prefixlen 64  scopeid 0x20<link>
        ether m.m.m.m  txqueuelen 0  (Ethernet)
        RX packets 12  bytes 1203 (1.1 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 67  bytes 7523 (7.3 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

docker0: flags=4099<UP,BROADCAST,MULTICAST>  mtu 1500
        inet x.x.x.x  netmask x.x.x.x  broadcast x.x.x.x
        ether m.m.m.m  txqueuelen 0  (Ethernet)
        RX packets 0  bytes 0 (0.0 B)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 0  bytes 0 (0.0 B)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet x.x.x.x  netmask x.x.x.x  broadcast x.x.x.x
        inet6 y::y.y.y.y  prefixlen 64  scopeid 0x20<link>
        ether m.m.m.m  txqueuelen 1000  (Ethernet)
        RX packets 263  bytes 31027 (30.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 333  bytes 28821 (28.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
        inet x.x.x.x  netmask x.x.x.x
        inet6 ::1  prefixlen 128  scopeid 0x10<host>
        loop  txqueuelen 1000  (Local Loopback)
        RX packets 225  bytes 21757 (21.2 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 225  bytes 21757 (21.2 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0

vethf390115: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet x.x.x.x  netmask x.x.x.x  broadcast x.x.x.x
        inet6 y::y.y.y.y  prefixlen 64  scopeid 0x20<link>
        ether m.m.m.m  txqueuelen 0  (Ethernet)
        RX packets 12  bytes 1371 (1.3 KiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 211  bytes 40353 (39.4 KiB)
        TX errors 0  dropped 1 overruns 0  carrier 0  collisions 0

wlan0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet x.x.x.x  netmask x.x.x.x  broadcast x.x.x.x
        inet6 y::y.y.y.y  prefixlen 64  scopeid 0x20<link>
        ether m.m.m.m  txqueuelen 1000  (Ethernet)
        RX packets 385366  bytes 30147400 (28.7 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 1470  bytes 236590 (231.0 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


USB Information
---------------

/:  Bus 02.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/4p, 5000M
    |__ Port 2: Dev 2, If 0, Class=Mass Storage, Driver=uas, 5000M
/:  Bus 01.Port 1: Dev 1, Class=root_hub, Driver=xhci_hcd/1p, 480M
    |__ Port 1: Dev 2, If 0, Class=Hub, Driver=hub/4p, 480M

Display Information
-------------------

Running (F)KMS and X

Screen 0: minimum 320 x 200, current 800 x 480, maximum 7680 x 7680
HDMI-1 disconnected (normal left inverted right x axis y axis)
	Identifier: 0x45
	Timestamp:  497711
	Subpixel:   unknown
	Clones:    
	CRTCs:      3
	Transform:  1.000000 0.000000 0.000000
	            0.000000 1.000000 0.000000
	            0.000000 0.000000 1.000000
	           filter: 
	Output format: Automatic 
		supported: Automatic, RGB, YCbCr 4:2:2, YCbCr 4:4:4
	Broadcast RGB: Automatic 
		supported: Automatic, Full, Limited 16:235
	max bpc: 8 
		range: (8, 12)
	bottom margin: 0 
		range: (0, 100)
	top margin: 0 
		range: (0, 100)
	right margin: 0 
		range: (0, 100)
	left margin: 0 
		range: (0, 100)
	Colorspace: Default 
		supported: Default, SMPTE_170M_YCC, BT709_YCC, XVYCC_601, XVYCC_709, SYCC_601, opYCC_601, opRGB, BT2020_CYCC, BT2020_RGB, BT2020_YCC, DCI-P3_RGB_D65, DCI-P3_RGB_Theater
	link-status: Good 
		supported: Good, Bad
	CONNECTOR_ID: 32 
		supported: 32
	non-desktop: 0 
		range: (0, 1)
HDMI-2 disconnected primary (normal left inverted right x axis y axis)
	Identifier: 0x46
	Timestamp:  497711
	Subpixel:   unknown
	Clones:    
	CRTCs:      4
	Transform:  1.000000 0.000000 0.000000
	            0.000000 1.000000 0.000000
	            0.000000 0.000000 1.000000
	           filter: 
	_MUTTER_PRESENTATION_OUTPUT: 0 
	Output format: Automatic 
		supported: Automatic, RGB, YCbCr 4:2:2, YCbCr 4:4:4
	Broadcast RGB: Automatic 
		supported: Automatic, Full, Limited 16:235
	max bpc: 8 
		range: (8, 12)
	bottom margin: 0 
		range: (0, 100)
	top margin: 0 
		range: (0, 100)
	right margin: 0 
		range: (0, 100)
	left margin: 0 
		range: (0, 100)
	Colorspace: Default 
		supported: Default, SMPTE_170M_YCC, BT709_YCC, XVYCC_601, XVYCC_709, SYCC_601, opYCC_601, opRGB, BT2020_CYCC, BT2020_RGB, BT2020_YCC, DCI-P3_RGB_D65, DCI-P3_RGB_Theater
	link-status: Good 
		supported: Good, Bad
	CONNECTOR_ID: 42 
		supported: 42
	non-desktop: 0 
		range: (0, 1)

Connector 0 (32) HDMI-A-1 (disconnected)
  Encoder 0 (31) TMDS
Connector 1 (42) HDMI-A-2 (disconnected)
  Encoder 1 (41) TMDS


HDMI0:             HDMI_HOTPLUG = 0x00000000
HDMI1:             HDMI_HOTPLUG = 0x00000000

/sys/kernel/debug/dri/1/state:
plane[47]: plane-0
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[64]: plane-1
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[75]: plane-2
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[86]: plane-3
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[97]: plane-4
	crtc=(null)
	fb=0
	crtc-pos=800x480+0+0
	src-pos=800.000000x480.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[108]: plane-5
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[119]: plane-6
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=1
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[129]: plane-7
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=2
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[139]: plane-8
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=3
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[149]: plane-9
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=4
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[159]: plane-10
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=5
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[169]: plane-11
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=6
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[179]: plane-12
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=7
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[189]: plane-13
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=8
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[199]: plane-14
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=9
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[209]: plane-15
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=a
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[219]: plane-16
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=b
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[229]: plane-17
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=c
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[239]: plane-18
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=d
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[249]: plane-19
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=e
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[259]: plane-20
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=f
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[269]: plane-21
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=10
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[279]: plane-22
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=11
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[289]: plane-23
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=11
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[299]: plane-24
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=11
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[309]: plane-25
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=11
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[319]: plane-26
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=0
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
plane[329]: plane-27
	crtc=(null)
	fb=0
	crtc-pos=0x0+0+0
	src-pos=0.000000x0.000000+0.000000+0.000000
	rotation=1
	normalized-zpos=11
	color-encoding=ITU-R BT.709 YCbCr
	color-range=YCbCr limited range
crtc[57]: txp
	enable=0
	active=0
	self_refresh_active=0
	planes_changed=0
	mode_changed=0
	active_changed=0
	connectors_changed=0
	color_mgmt_changed=0
	plane_mask=0
	connector_mask=0
	encoder_mask=0
	mode: "": 0 0 0 0 0 0 0 0 0 0 0x0 0x0
crtc[74]: pixelvalve-0
	enable=0
	active=0
	self_refresh_active=0
	planes_changed=0
	mode_changed=0
	active_changed=0
	connectors_changed=0
	color_mgmt_changed=0
	plane_mask=0
	connector_mask=0
	encoder_mask=0
	mode: "": 0 0 0 0 0 0 0 0 0 0 0x0 0x0
crtc[85]: pixelvalve-1
	enable=0
	active=0
	self_refresh_active=0
	planes_changed=0
	mode_changed=0
	active_changed=0
	connectors_changed=0
	color_mgmt_changed=0
	plane_mask=0
	connector_mask=0
	encoder_mask=0
	mode: "": 0 0 0 0 0 0 0 0 0 0 0x0 0x0
crtc[96]: pixelvalve-2
	enable=0
	active=0
	self_refresh_active=0
	planes_changed=0
	mode_changed=0
	active_changed=0
	connectors_changed=0
	color_mgmt_changed=0
	plane_mask=0
	connector_mask=0
	encoder_mask=0
	mode: "": 0 0 0 0 0 0 0 0 0 0 0x0 0x0
crtc[107]: pixelvalve-4
	enable=0
	active=0
	self_refresh_active=0
	planes_changed=1
	mode_changed=0
	active_changed=0
	connectors_changed=0
	color_mgmt_changed=0
	plane_mask=0
	connector_mask=0
	encoder_mask=0
	mode: "": 0 0 0 0 0 0 0 0 0 0 0x0 0x0
crtc[118]: pixelvalve-3
	enable=0
	active=0
	self_refresh_active=0
	planes_changed=0
	mode_changed=0
	active_changed=0
	connectors_changed=0
	color_mgmt_changed=0
	plane_mask=0
	connector_mask=0
	encoder_mask=0
	mode: "": 0 0 0 0 0 0 0 0 0 0 0x0 0x0
connector[32]: HDMI-A-1
	crtc=(null)
	self_refresh_aware=0
	max_requested_bpc=8
connector[42]: HDMI-A-2
	crtc=(null)
	self_refresh_aware=0
	max_requested_bpc=8
connector[63]: Writeback-1
	crtc=(null)
	self_refresh_aware=0
	max_requested_bpc=0



config.txt
----------

arm_64bit=1
arm_boost=1
arm_freq=1800
audio_pwm_mode=514
camera_auto_detect=1
config_hdmi_boost=5
core_freq=500
core_freq_min=200
disable_commandline_tags=2
disable_l2cache=1
disable_overscan=1
display_auto_detect=1
display_hdmi_rotate=-1
display_lcd_rotate=-1
dvfs=3
enable_gic=1
enable_uart=1
force_eeprom_read=1
force_pwm_open=1
framebuffer_ignore_alpha=1
framebuffer_swap=1
gpu_freq=500
gpu_freq_min=250
init_uart_clock=0x2dc6c00
lcd_framerate=60
mask_gpu_interrupt0=3072
mask_gpu_interrupt1=25635
max_framebuffers=2
over_voltage_avs=-10000
pause_burst_frames=1
program_serial_random=1
total_mem=4096
hdmi_force_cec_address:0=65535
hdmi_force_cec_address:1=65535
hdmi_pixel_freq_limit:0=0x11e1a300
hdmi_pixel_freq_limit:1=0x11e1a300
device_tree=-
overlay_prefix=overlays/
hdmi_cvt:0=
hdmi_cvt:1=
hdmi_edid_filename:0=
hdmi_edid_filename:1=
hdmi_timings:0=
hdmi_timings:1=

cmdline.txt
-----------
coherent_pool=1M 8250.nr_uarts=1 snd_bcm2835.enable_headphones=0 snd_bcm2835.enable_headphones=1 snd_bcm2835.enable_hdmi=1 snd_bcm2835.enable_hdmi=0  smsc95xx.macaddr=D8:3A:DD:2A:85:90 vc_mem.mem_base=0x3eb00000 vc_mem.mem_size=0x3ff00000  console=tty1 root=PARTUUID=1b6efd41-02 rootfstype=ext4 fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles

raspi-gpio settings
-------------------

BANK0 (GPIO 0 to 27):
GPIO 0: level=1 fsel=0 func=INPUT pull=UP
GPIO 1: level=1 fsel=0 func=INPUT pull=UP
GPIO 2: level=1 fsel=4 alt=0 func=SDA1 pull=UP
GPIO 3: level=1 fsel=4 alt=0 func=SCL1 pull=UP
GPIO 4: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 5: level=1 fsel=0 func=INPUT pull=UP
GPIO 6: level=1 fsel=0 func=INPUT pull=UP
GPIO 7: level=1 fsel=0 func=INPUT pull=UP
GPIO 8: level=1 fsel=0 func=INPUT pull=UP
GPIO 9: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 10: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 11: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 12: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 13: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 14: level=1 fsel=2 alt=5 func=TXD1 pull=NONE
GPIO 15: level=1 fsel=2 alt=5 func=RXD1 pull=UP
GPIO 16: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 17: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 18: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 19: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 20: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 21: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 22: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 23: level=1 fsel=0 func=INPUT pull=DOWN
GPIO 24: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 25: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 26: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 27: level=0 fsel=0 func=INPUT pull=DOWN
BANK1 (GPIO 28 to 45):
GPIO 28: level=1 fsel=2 alt=5 func=RGMII_MDIO pull=UP
GPIO 29: level=0 fsel=2 alt=5 func=RGMII_MDC pull=DOWN
GPIO 30: level=0 fsel=7 alt=3 func=CTS0 pull=UP
GPIO 31: level=0 fsel=7 alt=3 func=RTS0 pull=NONE
GPIO 32: level=1 fsel=7 alt=3 func=TXD0 pull=NONE
GPIO 33: level=1 fsel=7 alt=3 func=RXD0 pull=UP
GPIO 34: level=1 fsel=7 alt=3 func=SD1_CLK pull=NONE
GPIO 35: level=1 fsel=7 alt=3 func=SD1_CMD pull=UP
GPIO 36: level=1 fsel=7 alt=3 func=SD1_DAT0 pull=UP
GPIO 37: level=0 fsel=7 alt=3 func=SD1_DAT1 pull=UP
GPIO 38: level=1 fsel=7 alt=3 func=SD1_DAT2 pull=UP
GPIO 39: level=1 fsel=7 alt=3 func=SD1_DAT3 pull=UP
GPIO 40: level=0 fsel=4 alt=0 func=PWM1_0 pull=NONE
GPIO 41: level=0 fsel=4 alt=0 func=PWM1_1 pull=NONE
GPIO 42: level=0 fsel=1 func=OUTPUT pull=UP
GPIO 43: level=1 fsel=0 func=INPUT pull=UP
GPIO 44: level=1 fsel=0 func=INPUT pull=UP
GPIO 45: level=1 fsel=0 func=INPUT pull=UP
BANK2 (GPIO 46 to 53):
GPIO 46: level=0 fsel=0 func=INPUT pull=UP
GPIO 47: level=0 fsel=0 func=INPUT pull=UP
GPIO 48: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 49: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 50: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 51: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 52: level=0 fsel=0 func=INPUT pull=DOWN
GPIO 53: level=0 fsel=0 func=INPUT pull=DOWN

vcdbg log messages
------------------

005124.001: brfs: File read: /mfs/sd/config.txt
005124.985: brfs: File read: 2122 bytes
005146.458: HDMI0:EDID error reading EDID block 0 attempt 0
005147.473: HDMI0:EDID giving up on reading EDID block 0
005159.278: HDMI1:EDID error reading EDID block 0 attempt 0
005160.294: HDMI1:EDID giving up on reading EDID block 0
005161.368: brfs: File read: /mfs/sd/config.txt
005931.332: gpioman: gpioman_get_pin_num: pin DISPLAY_DSI_PORT not defined
005933.856: *** Restart logging
005933.876: brfs: File read: 2122 bytes
005939.281: hdmi: HDMI0:EDID error reading EDID block 0 attempt 0
005940.299: hdmi: HDMI0:EDID giving up on reading EDID block 0
005945.341: hdmi: HDMI0:EDID error reading EDID block 0 attempt 0
005946.357: hdmi: HDMI0:EDID giving up on reading EDID block 0
005946.375: hdmi: HDMI:hdmi_get_state is deprecated, use hdmi_get_display_state instead
005951.418: hdmi: HDMI1:EDID error reading EDID block 0 attempt 0
005952.432: hdmi: HDMI1:EDID giving up on reading EDID block 0
005957.474: hdmi: HDMI1:EDID error reading EDID block 0 attempt 0
005958.491: hdmi: HDMI1:EDID giving up on reading EDID block 0
005958.506: hdmi: HDMI:hdmi_get_state is deprecated, use hdmi_get_display_state instead
005958.520: HDMI0: hdmi_pixel_encoding: 300000000
005958.534: HDMI1: hdmi_pixel_encoding: 300000000
005958.876: kernel=
005963.775: dtb_file 'bcm2711-rpi-4-b.dtb'
005966.343: brfs: File read: /mfs/sd/bcm2711-rpi-4-b.dtb
005966.358: Loaded 'bcm2711-rpi-4-b.dtb' to 0x100 size 0xcd71
005979.445: brfs: File read: 52593 bytes
005987.992: brfs: File read: /mfs/sd/overlays/overlay_map.dtb
006068.403: brfs: File read: 2347 bytes
006069.727: brfs: File read: /mfs/sd/config.txt
006070.137: dtparam: i2c_arm=on
006078.856: dtparam: audio=on
006083.427: brfs: File read: 2122 bytes
006094.206: brfs: File read: /mfs/sd/overlays/vc4-kms-v3d-pi4.dtbo
006155.364: Loaded overlay 'vc4-kms-v3d'
006313.200: brfs: File read: 3913 bytes
006314.102: brfs: File read: /mfs/sd/cmdline.txt
006314.143: Read command line from file 'cmdline.txt':
006314.155: 'console=tty1 root=PARTUUID=1b6efd41-02 rootfstype=ext4 fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles'
006424.707: brfs: File read: 124 bytes
006761.416: brfs: File read: /mfs/sd/kernel8.img
006761.436: Loaded 'kernel8.img' to 0x80000 size 0x7d6bd0
007932.088: Kernel relocated to 0x200000
007932.101: Device tree loaded to 0x2eff2c00 (size 0xd3c0)
007935.297: bfs_xhci_stop
007935.305: XHCI-STOP
007935.389: xHC ver: 256 HCS: 05000420 fc000031 00e70004 HCC: 002841eb
007935.407: USBSTS 18
010015.808: vchiq_core: vchiq_init_state: slot_zero = 0xcf000000, is_master = 1

dmesg log
---------

[    0.000000] Booting Linux on physical CPU 0x0000000000 [0x410fd083]
[    0.000000] Linux version 6.1.21-v8+ (dom@buildbot) (aarch64-linux-gnu-gcc-8 (Ubuntu/Linaro 8.4.0-3ubuntu1) 8.4.0, GNU ld (GNU Binutils for Ubuntu) 2.34) #1642 SMP PREEMPT Mon Apr  3 17:24:16 BST 2023
[    0.000000] random: crng init done
[    0.000000] Machine model: Raspberry Pi 4 Model B Rev 1.5
[    0.000000] efi: UEFI not found.
[    0.000000] Reserved memory: created CMA memory pool at 0x000000000ec00000, size 512 MiB
[    0.000000] OF: reserved mem: initialized node linux,cma, compatible id shared-dma-pool
[    0.000000] Zone ranges:
[    0.000000]   DMA      [mem 0x0000000000000000-0x000000003fffffff]
[    0.000000]   DMA32    [mem 0x0000000040000000-0x00000000fbffffff]
[    0.000000]   Normal   empty
[    0.000000] Movable zone start for each node
[    0.000000] Early memory node ranges
[    0.000000]   node   0: [mem 0x0000000000000000-0x000000003b2fffff]
[    0.000000]   node   0: [mem 0x0000000040000000-0x00000000fbffffff]
[    0.000000] Initmem setup node 0 [mem 0x0000000000000000-0x00000000fbffffff]
[    0.000000] On node 0, zone DMA32: 19712 pages in unavailable ranges
[    0.000000] On node 0, zone DMA32: 16384 pages in unavailable ranges
[    0.000000] percpu: Embedded 29 pages/cpu s78504 r8192 d32088 u118784
[    0.000000] pcpu-alloc: s78504 r8192 d32088 u118784 alloc=29*4096
[    0.000000] pcpu-alloc: [0] 0 [0] 1 [0] 2 [0] 3 
[    0.000000] Detected PIPT I-cache on CPU0
[    0.000000] CPU features: detected: Spectre-v2
[    0.000000] CPU features: detected: Spectre-v3a
[    0.000000] CPU features: detected: Spectre-v4
[    0.000000] CPU features: detected: Spectre-BHB
[    0.000000] CPU features: kernel page table isolation forced ON by KASLR
[    0.000000] CPU features: detected: Kernel page table isolation (KPTI)
[    0.000000] CPU features: detected: ARM erratum 1742098
[    0.000000] CPU features: detected: ARM errata 1165522, 1319367, or 1530923
[    0.000000] alternatives: applying boot alternatives
[    0.000000] Built 1 zonelists, mobility grouping on.  Total pages: 996660
[    0.000000] Kernel command line: coherent_pool=1M 8250.nr_uarts=1 snd_bcm2835.enable_headphones=0 snd_bcm2835.enable_headphones=1 snd_bcm2835.enable_hdmi=1 snd_bcm2835.enable_hdmi=0  smsc95xx.macaddr=m.m.m.m vc_mem.mem_base=0x3eb00000 vc_mem.mem_size=0x3ff00000  console=tty1 root=PARTUUID=1b6efd41-02 rootfstype=ext4 fsck.repair=yes rootwait quiet splash plymouth.ignore-serial-consoles
[    0.000000] Unknown kernel command line parameters "splash", will be passed to user space.
[    0.000000] Dentry cache hash table entries: 524288 (order: 10, 4194304 bytes, linear)
[    0.000000] Inode-cache hash table entries: 262144 (order: 9, 2097152 bytes, linear)
[    0.000000] mem auto-init: stack:off, heap alloc:off, heap free:off
[    0.000000] software IO TLB: area num 4.
[    0.000000] software IO TLB: mapped [mem 0x0000000037300000-0x000000003b300000] (64MB)
[    0.000000] Memory: 3355924K/4049920K available (11776K kernel code, 2106K rwdata, 3688K rodata, 4160K init, 1077K bss, 169708K reserved, 524288K cma-reserved)
[    0.000000] SLUB: HWalign=64, Order=0-3, MinObjects=0, CPUs=4, Nodes=1
[    0.000000] ftrace: allocating 39744 entries in 156 pages
[    0.000000] ftrace: allocated 156 pages with 4 groups
[    0.000000] trace event string verifier disabled
[    0.000000] rcu: Preemptible hierarchical RCU implementation.
[    0.000000] rcu: 	RCU event tracing is enabled.
[    0.000000] rcu: 	RCU restricting CPUs from NR_CPUS=256 to nr_cpu_ids=4.
[    0.000000] 	Trampoline variant of Tasks RCU enabled.
[    0.000000] 	Rude variant of Tasks RCU enabled.
[    0.000000] 	Tracing variant of Tasks RCU enabled.
[    0.000000] rcu: RCU calculated value of scheduler-enlistment delay is 25 jiffies.
[    0.000000] rcu: Adjusting geometry for rcu_fanout_leaf=16, nr_cpu_ids=4
[    0.000000] NR_IRQS: 64, nr_irqs: 64, preallocated irqs: 0
[    0.000000] Root IRQ handler: gic_handle_irq
[    0.000000] GIC: Using split EOI/Deactivate mode
[    0.000000] rcu: srcu_init: Setting srcu_struct sizes based on contention.
[    0.000000] arch_timer: cp15 timer(s) running at 54.00MHz (phys).
[    0.000000] clocksource: arch_sys_counter: mask: 0xffffffffffffff max_cycles: 0xc743ce346, max_idle_ns: 440795203123 ns
[    0.000000] sched_clock: 56 bits at 54MHz, resolution 18ns, wraps every 4398046511102ns
[    0.000305] Console: colour dummy device 80x25
[    0.000367] printk: console [tty1] enabled
[    0.000428] Calibrating delay loop (skipped), value calculated using timer frequency.. 108.00 BogoMIPS (lpj=216000)
[    0.000453] pid_max: default: 32768 minimum: 301
[    0.000584] LSM: Security Framework initializing
[    0.000784] Mount-cache hash table entries: 8192 (order: 4, 65536 bytes, linear)
[    0.000844] Mountpoint-cache hash table entries: 8192 (order: 4, 65536 bytes, linear)
[    0.002095] cgroup: Disabling memory control group subsystem
[    0.004280] cblist_init_generic: Setting adjustable number of callback queues.
[    0.004298] cblist_init_generic: Setting shift to 2 and lim to 1.
[    0.004475] cblist_init_generic: Setting shift to 2 and lim to 1.
[    0.004645] cblist_init_generic: Setting shift to 2 and lim to 1.
[    0.005078] rcu: Hierarchical SRCU implementation.
[    0.005091] rcu: 	Max phase no-delay instances is 1000.
[    0.006393] EFI services will not be available.
[    0.006899] smp: Bringing up secondary CPUs ...
[    0.007991] Detected PIPT I-cache on CPU1
[    0.008144] CPU1: Booted secondary processor 0x0000000001 [0x410fd083]
[    0.009272] Detected PIPT I-cache on CPU2
[    0.009390] CPU2: Booted secondary processor 0x0000000002 [0x410fd083]
[    0.010482] Detected PIPT I-cache on CPU3
[    0.010605] CPU3: Booted secondary processor 0x0000000003 [0x410fd083]
[    0.010753] smp: Brought up 1 node, 4 CPUs
[    0.010774] SMP: Total of 4 processors activated.
[    0.010787] CPU features: detected: 32-bit EL0 Support
[    0.010796] CPU features: detected: 32-bit EL1 Support
[    0.010809] CPU features: detected: CRC32 instructions
[    0.010941] CPU: All CPU(s) started at EL2
[    0.010964] alternatives: applying system-wide alternatives
[    0.012786] devtmpfs: initialized
[    0.024729] Enabled cp15_barrier support
[    0.024768] Enabled setend support
[    0.024989] clocksource: jiffies: mask: 0xffffffff max_cycles: 0xffffffff, max_idle_ns: 7645041785100000 ns
[    0.025024] futex hash table entries: 1024 (order: 4, 65536 bytes, linear)
[    0.037552] pinctrl core: initialized pinctrl subsystem
[    0.038408] DMI not present or invalid.
[    0.039074] NET: Registered PF_NETLINK/PF_ROUTE protocol family
[    0.042592] DMA: preallocated 1024 KiB GFP_KERNEL pool for atomic allocations
[    0.042941] DMA: preallocated 1024 KiB GFP_KERNEL|GFP_DMA pool for atomic allocations
[    0.043882] DMA: preallocated 1024 KiB GFP_KERNEL|GFP_DMA32 pool for atomic allocations
[    0.043974] audit: initializing netlink subsys (disabled)
[    0.044260] audit: type=2000 audit(0.044:1): state=initialized audit_enabled=0 res=1
[    0.044857] thermal_sys: Registered thermal governor 'step_wise'
[    0.044947] cpuidle: using governor menu
[    0.045352] hw-breakpoint: found 6 breakpoint and 4 watchpoint registers.
[    0.045567] ASID allocator initialised with 32768 entries
[    0.045729] Serial: AMBA PL011 UART driver
[    0.059557] bcm2835-mbox fe00b880.mailbox: mailbox enabled
[    0.080269] raspberrypi-firmware soc:firmware: Attached to firmware from 2023-03-17T10:50:39, variant start
[    0.084283] raspberrypi-firmware soc:firmware: Firmware hash is 82f3750a65fadae9a38077e3c2e217ad158c8d54
[    0.100173] KASLR enabled
[    0.137384] bcm2835-dma fe007000.dma: DMA legacy API manager, dmachans=0x1
[    0.143142] SCSI subsystem initialized
[    0.143392] usbcore: registered new interface driver usbfs
[    0.143451] usbcore: registered new interface driver hub
[    0.143517] usbcore: registered new device driver usb
[    0.143906] usb_phy_generic phy: supply vcc not found, using dummy regulator
[    0.144136] usb_phy_generic phy: dummy supplies not allowed for exclusive requests
[    0.144493] pps_core: LinuxPPS API ver. 1 registered
[    0.144506] pps_core: Software ver. 5.3.6 - Copyright 2005-2007 Rodolfo Giometti <giometti@linux.it>
[    0.144532] PTP clock support registered
[    0.145645] vgaarb: loaded
[    0.146369] clocksource: Switched to clocksource arch_sys_counter
[    0.147378] VFS: Disk quotas dquot_6.6.0
[    0.147459] VFS: Dquot-cache hash table entries: 512 (order 0, 4096 bytes)
[    0.147640] FS-Cache: Loaded
[    0.147834] CacheFiles: Loaded
[    0.158697] NET: Registered PF_INET protocol family
[    0.159208] IP idents hash table entries: 65536 (order: 7, 524288 bytes, linear)
[    0.164158] tcp_listen_portaddr_hash hash table entries: 2048 (order: 3, 32768 bytes, linear)
[    0.164218] Table-perturb hash table entries: 65536 (order: 6, 262144 bytes, linear)
[    0.164245] TCP established hash table entries: 32768 (order: 6, 262144 bytes, linear)
[    0.164449] TCP bind hash table entries: 32768 (order: 8, 1048576 bytes, linear)
[    0.165401] TCP: Hash tables configured (established 32768 bind 32768)
[    0.165622] UDP hash table entries: 2048 (order: 4, 65536 bytes, linear)
[    0.165702] UDP-Lite hash table entries: 2048 (order: 4, 65536 bytes, linear)
[    0.166012] NET: Registered PF_UNIX/PF_LOCAL protocol family
[    0.166883] RPC: Registered named UNIX socket transport module.
[    0.166902] RPC: Registered udp transport module.
[    0.166912] RPC: Registered tcp transport module.
[    0.166922] RPC: Registered tcp NFSv4.1 backchannel transport module.
[    0.166947] PCI: CLS 0 bytes, default 64
[    0.169633] hw perfevents: enabled with armv8_cortex_a72 PMU driver, 7 counters available
[    0.170021] kvm [1]: IPA Size Limit: 44 bits
[    0.171433] kvm [1]: vgic interrupt IRQ9
[    0.171670] kvm [1]: Hyp mode initialized successfully
[    1.304106] Initialise system trusted keyrings
[    1.304547] workingset: timestamp_bits=46 max_order=20 bucket_order=0
[    1.312116] zbud: loaded
[    1.315058] NFS: Registering the id_resolver key type
[    1.315094] Key type id_resolver registered
[    1.315105] Key type id_legacy registered
[    1.315218] nfs4filelayout_init: NFSv4 File Layout Driver Registering...
[    1.315234] nfs4flexfilelayout_init: NFSv4 Flexfile Layout Driver Registering...
[    1.316655] Key type asymmetric registered
[    1.316673] Asymmetric key parser 'x509' registered
[    1.316761] Block layer SCSI generic (bsg) driver version 0.4 loaded (major 247)
[    1.317034] io scheduler mq-deadline registered
[    1.317052] io scheduler kyber registered
[    1.319224] irq_brcmstb_l2: registered L2 intc (/soc/interrupt-controller@7ef00100, parent irq: 27)
[    1.327243] brcm-pcie fd500000.pcie: host bridge /scb/pcie@7d500000 ranges:
[    1.327286] brcm-pcie fd500000.pcie:   No bus range found for /scb/pcie@7d500000, using [bus 00-ff]
[    1.327375] brcm-pcie fd500000.pcie:      MEM 0x0600000000..0x063fffffff -> 0x00c0000000
[    1.327458] brcm-pcie fd500000.pcie:   IB MEM 0x0000000000..0x00ffffffff -> 0x0400000000
[    1.328460] brcm-pcie fd500000.pcie: PCI host bridge to bus 0000:00
[    1.328480] pci_bus 0000:00: root bus resource [bus 00-ff]
[    1.328498] pci_bus 0000:00: root bus resource [mem 0x600000000-0x63fffffff] (bus address [0xc0000000-0xffffffff])
[    1.328574] pci 0000:00:00.0: [14e4:2711] type 01 class 0x060400
[    1.328830] pci 0000:00:00.0: PME# supported from D0 D3hot
[    1.332731] pci 0000:00:00.0: bridge configuration invalid ([bus 00-00]), reconfiguring
[    1.333000] pci_bus 0000:01: supply vpcie3v3 not found, using dummy regulator
[    1.333191] pci_bus 0000:01: supply vpcie3v3aux not found, using dummy regulator
[    1.333310] pci_bus 0000:01: supply vpcie12v not found, using dummy regulator
[    1.396463] brcm-pcie fd500000.pcie: link up, 5.0 GT/s PCIe x1 (SSC)
[    1.396554] pci 0000:01:00.0: [1106:3483] type 00 class 0x0c0330
[    1.396625] pci 0000:01:00.0: reg 0x10: [mem 0x00000000-0x00000fff 64bit]
[    1.396894] pci 0000:01:00.0: PME# supported from D0 D3hot
[    1.397403] pci_bus 0000:01: busn_res: [bus 01-ff] end is updated to 01
[    1.397447] pci 0000:00:00.0: BAR 8: assigned [mem 0x600000000-0x6000fffff]
[    1.397471] pci 0000:01:00.0: BAR 0: assigned [mem 0x600000000-0x600000fff 64bit]
[    1.397514] pci 0000:00:00.0: PCI bridge to [bus 01]
[    1.397535] pci 0000:00:00.0:   bridge window [mem 0x600000000-0x6000fffff]
[    1.406002] Serial: 8250/16550 driver, 1 ports, IRQ sharing enabled
[    1.409238] iproc-rng200 fe104000.rng: hwrng registered
[    1.409827] vc-mem: phys_addr:0x00000000 mem_base=0x3eb00000 mem_size:0x3ff00000(1023 MiB)
[    1.411431] gpiomem-bcm2835 fe200000.gpiomem: Initialised: Registers at 0xfe200000
[    1.424347] brd: module loaded
[    1.432985] loop: module loaded
[    1.433832] Loading iSCSI transport class v2.0-870.
[    1.439237] bcmgenet fd580000.ethernet: GENET 5.0 EPHY: 0x0000
[    1.502514] unimac-mdio unimac-mdio.-19: Broadcom UniMAC MDIO bus
[    1.503655] usbcore: registered new interface driver r8152
[    1.503736] usbcore: registered new interface driver lan78xx
[    1.503797] usbcore: registered new interface driver smsc95xx
[    1.549873] pci 0000:00:00.0: enabling device (0000 -> 0002)
[    1.550058] xhci_hcd 0000:01:00.0: xHCI Host Controller
[    1.550089] xhci_hcd 0000:01:00.0: new USB bus registered, assigned bus number 1
[    1.550850] xhci_hcd 0000:01:00.0: hcc params 0x002841eb hci version 0x100 quirks 0x0000e40000000890
[    1.551880] xhci_hcd 0000:01:00.0: xHCI Host Controller
[    1.551903] xhci_hcd 0000:01:00.0: new USB bus registered, assigned bus number 2
[    1.551925] xhci_hcd 0000:01:00.0: Host supports USB 3.0 SuperSpeed
[    1.552316] usb usb1: New USB device found, idVendor=1d6b, idProduct=0002, bcdDevice= 6.01
[    1.552336] usb usb1: New USB device strings: Mfr=3, Product=2, SerialNumber=1
[    1.552352] usb usb1: Product: xHCI Host Controller
[    1.552365] usb usb1: Manufacturer: Linux 6.1.21-v8+ xhci-hcd
[    1.552377] usb usb1: SerialNumber: 0000:01:00.0
[    1.553116] hub 1-0:1.0: USB hub found
[    1.553186] hub 1-0:1.0: 1 port detected
[    1.554156] usb usb2: New USB device found, idVendor=1d6b, idProduct=0003, bcdDevice= 6.01
[    1.554177] usb usb2: New USB device strings: Mfr=3, Product=2, SerialNumber=1
[    1.554192] usb usb2: Product: xHCI Host Controller
[    1.554204] usb usb2: Manufacturer: Linux 6.1.21-v8+ xhci-hcd
[    1.554217] usb usb2: SerialNumber: 0000:01:00.0
[    1.554936] hub 2-0:1.0: USB hub found
[    1.555032] hub 2-0:1.0: 4 ports detected
[    1.556822] dwc_otg: version 3.00a 10-AUG-2012 (platform bus)
[    1.557163] dwc_otg: FIQ enabled
[    1.557174] dwc_otg: NAK holdoff enabled
[    1.557184] dwc_otg: FIQ split-transaction FSM enabled
[    1.557203] Module dwc_common_port init
[    1.557751] usbcore: registered new interface driver uas
[    1.557868] usbcore: registered new interface driver usb-storage
[    1.558088] mousedev: PS/2 mouse device common for all mice
[    1.564640] sdhci: Secure Digital Host Controller Interface driver
[    1.564658] sdhci: Copyright(c) Pierre Ossman
[    1.565363] sdhci-pltfm: SDHCI platform and OF driver helper
[    1.569037] ledtrig-cpu: registered to indicate activity on CPUs
[    1.569407] hid: raw HID events driver (C) Jiri Kosina
[    1.569625] usbcore: registered new interface driver usbhid
[    1.569638] usbhid: USB HID core driver
[    1.578068] NET: Registered PF_PACKET protocol family
[    1.578182] Key type dns_resolver registered
[    1.579576] registered taskstats version 1
[    1.579656] Loading compiled-in X.509 certificates
[    1.580633] Key type .fscrypt registered
[    1.580648] Key type fscrypt-provisioning registered
[    1.596304] uart-pl011 fe201000.serial: there is not valid maps for state default
[    1.597018] uart-pl011 fe201000.serial: cts_event_workaround enabled
[    1.597171] fe201000.serial: ttyAMA0 at MMIO 0xfe201000 (irq = 36, base_baud = 0) is a PL011 rev2
[    1.605241] bcm2835-aux-uart fe215040.serial: there is not valid maps for state default
[    1.606132] fe215040.serial: ttyS0 at MMIO 0xfe215040 (irq = 37, base_baud = 62500000) is a 16550
[    1.607723] bcm2835-wdt bcm2835-wdt: Broadcom BCM2835 watchdog timer
[    1.608151] bcm2835-power bcm2835-power: Broadcom BCM2835 power domains driver
[    1.609426] mmc-bcm2835 fe300000.mmcnr: mmc_debug:0 mmc_debug2:0
[    1.609446] mmc-bcm2835 fe300000.mmcnr: DMA channel allocated
[    1.645314] mmc1: Controller never released inhibit bit(s).
[    1.649073] of_cfs_init
[    1.649209] of_cfs_init: OK
[    1.685870] mmc0: SDHCI controller on fe340000.mmc [fe340000.mmc] using ADMA
[    1.686216] Waiting for root device PARTUUID=1b6efd41-02...
[    1.736915] mmc1: new high speed SDIO card at address 0001
[    1.806399] usb 1-1: new high-speed USB device number 2 using xhci_hcd
[    1.956998] usb 1-1: New USB device found, idVendor=2109, idProduct=3431, bcdDevice= 4.21
[    1.957021] usb 1-1: New USB device strings: Mfr=0, Product=1, SerialNumber=0
[    1.957036] usb 1-1: Product: USB2.0 Hub
[    1.958785] hub 1-1:1.0: USB hub found
[    1.959102] hub 1-1:1.0: 4 ports detected
[    2.082882] usb 2-2: new SuperSpeed USB device number 2 using xhci_hcd
[    2.104006] usb 2-2: New USB device found, idVendor=174c, idProduct=1156, bcdDevice= 1.00
[    2.104027] usb 2-2: New USB device strings: Mfr=2, Product=3, SerialNumber=1
[    2.104043] usb 2-2: Product: Forty
[    2.104056] usb 2-2: Manufacturer: Argon
[    2.104069] usb 2-2: SerialNumber: 0000000000E4
[    2.116775] scsi host0: uas
[    2.118044] scsi 0:0:0:0: Direct-Access     Argon    Forty            0    PQ: 0 ANSI: 6
[    2.121246] sd 0:0:0:0: [sda] 500118192 512-byte logical blocks: (256 GB/238 GiB)
[    2.121441] sd 0:0:0:0: [sda] Write Protect is off
[    2.121460] sd 0:0:0:0: [sda] Mode Sense: 43 00 00 00
[    2.121796] sd 0:0:0:0: [sda] Write cache: enabled, read cache: enabled, doesn't support DPO or FUA
[    2.122264] sd 0:0:0:0: [sda] Preferred minimum I/O size 512 bytes
[    2.122282] sd 0:0:0:0: [sda] Optimal transfer size 33553920 bytes
[    2.125769]  sda: sda1 sda2
[    2.126313] sd 0:0:0:0: [sda] Attached SCSI disk
[    2.138140] EXT4-fs (sda2): INFO: recovery required on readonly filesystem
[    2.138163] EXT4-fs (sda2): write access will be enabled during recovery
[    4.679530] EXT4-fs (sda2): recovery complete
[    4.680911] EXT4-fs (sda2): mounted filesystem with ordered data mode. Quota mode: none.
[    4.681012] VFS: Mounted root (ext4 filesystem) readonly on device 8:2.
[    4.681835] devtmpfs: mounted
[    4.689846] Freeing unused kernel memory: 4160K
[    4.690043] Run /sbin/init as init process
[    4.690054]   with arguments:
[    4.690063]     /sbin/init
[    4.690073]     splash
[    4.690083]   with environment:
[    4.690091]     HOME=/
[    4.690100]     TERM=linux
[    4.844466] systemd[1]: System time before build time, advancing clock.
[    4.994246] NET: Registered PF_INET6 protocol family
[    4.996172] Segment Routing with IPv6
[    4.996215] In-situ OAM (IOAM) with IPv6
[    5.040477] systemd[1]: systemd 247.3-7+deb11u2 running in system mode. (+PAM +AUDIT +SELINUX +IMA +APPARMOR +SMACK +SYSVINIT +UTMP +LIBCRYPTSETUP +GCRYPT +GNUTLS +ACL +XZ +LZ4 +ZSTD +SECCOMP +BLKID +ELFUTILS +KMOD +IDN2 -IDN +PCRE2 default-hierarchy=unified)
[    5.041474] systemd[1]: Detected architecture arm64.
[    5.042589] systemd[1]: Set hostname to <welleri>.
[    5.573611] systemd[1]: /lib/systemd/system/plymouth-start.service:16: Unit configured to use KillMode=none. This is unsafe, as it disables systemd's process lifecycle management for the service. Please update your service to use a safer KillMode=, such as 'mixed' or 'control-group'. Support for KillMode=none is deprecated and will eventually be removed.
[    5.703045] systemd[1]: Queued start job for default target Graphical Interface.
[    5.769751] systemd[1]: Created slice system-getty.slice.
[    5.771966] systemd[1]: Created slice system-modprobe.slice.
[    5.773769] systemd[1]: Created slice system-systemd\x2dfsck.slice.
[    5.775360] systemd[1]: Created slice User and Session Slice.
[    5.775890] systemd[1]: Started Forward Password Requests to Wall Directory Watch.
[    5.776959] systemd[1]: Set up automount Arbitrary Executable File Formats File System Automount Point.
[    5.777418] systemd[1]: Reached target Slices.
[    5.777551] systemd[1]: Reached target Swap.
[    5.778575] systemd[1]: Listening on Syslog Socket.
[    5.779273] systemd[1]: Listening on fsck to fsckd communication Socket.
[    5.779647] systemd[1]: Listening on initctl Compatibility Named Pipe.
[    5.780863] systemd[1]: Listening on Journal Audit Socket.
[    5.781642] systemd[1]: Listening on Journal Socket (/dev/log).
[    5.782693] systemd[1]: Listening on Journal Socket.
[    5.785405] systemd[1]: Listening on udev Control Socket.
[    5.786262] systemd[1]: Listening on udev Kernel Socket.
[    5.787289] systemd[1]: Condition check resulted in Huge Pages File System being skipped.
[    5.792405] systemd[1]: Mounting POSIX Message Queue File System...
[    5.797924] systemd[1]: Mounting RPC Pipe File System...
[    5.804390] systemd[1]: Mounting Kernel Debug File System...
[    5.810659] systemd[1]: Mounting Kernel Trace File System...
[    5.811372] systemd[1]: Condition check resulted in Kernel Module supporting RPCSEC_GSS being skipped.
[    5.820191] systemd[1]: Starting Restore / save the current clock...
[    5.840380] systemd[1]: Starting Set the console keyboard layout...
[    5.846833] systemd[1]: Starting Create list of static device nodes for the current kernel...
[    5.852435] systemd[1]: Starting Load Kernel Module configfs...
[    5.857843] systemd[1]: Starting Load Kernel Module drm...
[    5.867750] systemd[1]: Starting Load Kernel Module fuse...
[    5.870231] systemd[1]: Condition check resulted in Set Up Additional Binary Formats being skipped.
[    5.876593] systemd[1]: Starting File System Check on Root Device...
[    5.887285] systemd[1]: Starting Journal Service...
[    5.895870] systemd[1]: Starting Load Kernel Modules...
[    5.902288] systemd[1]: Starting Coldplug All udev Devices...
[    5.920058] systemd[1]: Mounted POSIX Message Queue File System.
[    5.920944] systemd[1]: Mounted RPC Pipe File System.
[    5.921671] systemd[1]: Mounted Kernel Debug File System.
[    5.922423] systemd[1]: Mounted Kernel Trace File System.
[    5.924975] systemd[1]: Finished Restore / save the current clock.
[    5.928264] systemd[1]: Finished Create list of static device nodes for the current kernel.
[    5.934700] systemd[1]: modprobe@configfs.service: Succeeded.
[    5.936470] systemd[1]: Finished Load Kernel Module configfs.
[    5.943775] systemd[1]: Mounting Kernel Configuration File System...
[    5.964426] systemd[1]: Mounted Kernel Configuration File System.
[    5.974940] fuse: init (API version 7.37)
[    5.977902] systemd[1]: Started File System Check Daemon to report status.
[    5.988673] systemd[1]: modprobe@fuse.service: Succeeded.
[    5.990152] systemd[1]: Finished Load Kernel Module fuse.
[    6.000042] i2c_dev: i2c /dev entries driver
[    6.002836] systemd[1]: Mounting FUSE Control File System...
[    6.015570] systemd[1]: Finished Load Kernel Modules.
[    6.021868] systemd[1]: Starting Apply Kernel Variables...
[    6.028248] systemd[1]: Mounted FUSE Control File System.
[    6.081582] systemd[1]: Finished Apply Kernel Variables.
[    6.091368] systemd[1]: modprobe@drm.service: Succeeded.
[    6.092842] systemd[1]: Finished Load Kernel Module drm.
[    6.336895] systemd[1]: Started Journal Service.
[    6.518519] EXT4-fs (sda2): re-mounted. Quota mode: none.
[    6.608324] systemd-journald[141]: Received client request to flush runtime journal.
[    6.644335] systemd-journald[141]: File /var/log/journal/fc19aee517bf4fe3ade438f1591af2df/system.journal corrupted or uncleanly shut down, renaming and replacing.
[    7.557341] mc: Linux media interface: v0.10
[    7.623239] vc_sm_cma: module is from the staging directory, the quality is unknown, you have been warned.
[    7.645046] bcm2835_vc_sm_cma_probe: Videocore shared memory driver
[    7.645111] [vc_sm_connected_init]: start
[    7.661301] [vc_sm_connected_init]: installed successfully
[    7.685434] brcmstb-i2c fef04500.i2c:  @97500hz registered in polling mode
[    7.688622] brcmstb-i2c fef09500.i2c:  @97500hz registered in polling mode
[    7.806556] snd_bcm2835: module is from the staging directory, the quality is unknown, you have been warned.
[    7.832656] bcm2835_audio bcm2835_audio: card created with 8 channels
[    7.842332] videodev: Linux video capture interface: v2.00
[    8.095647] [drm] Initialized v3d 1.0.0 20180419 for fec00000.v3d on minor 0
[    8.128527] bcm2835_mmal_vchiq: module is from the staging directory, the quality is unknown, you have been warned.
[    8.129602] bcm2835_mmal_vchiq: module is from the staging directory, the quality is unknown, you have been warned.
[    8.236529] bcm2835_isp: module is from the staging directory, the quality is unknown, you have been warned.
[    8.247055] bcm2835_v4l2: module is from the staging directory, the quality is unknown, you have been warned.
[    8.249122] bcm2835_codec: module is from the staging directory, the quality is unknown, you have been warned.
[    8.249200] rpivid_hevc: module is from the staging directory, the quality is unknown, you have been warned.
[    8.268412] bcm2835-isp bcm2835-isp: Device node output[0] registered as /dev/video13
[    8.269580] bcm2835-isp bcm2835-isp: Device node capture[0] registered as /dev/video14
[    8.275706] cfg80211: Loading compiled-in X.509 certificates for regulatory database
[    8.275943] bcm2835-isp bcm2835-isp: Device node capture[1] registered as /dev/video15
[    8.276668] bcm2835-isp bcm2835-isp: Device node stats[2] registered as /dev/video16
[    8.276710] bcm2835-isp bcm2835-isp: Register output node 0 with media controller
[    8.276732] bcm2835-isp bcm2835-isp: Register capture node 1 with media controller
[    8.276751] bcm2835-isp bcm2835-isp: Register capture node 2 with media controller
[    8.276767] bcm2835-isp bcm2835-isp: Register capture node 3 with media controller
[    8.287022] bcm2835-codec bcm2835-codec: Device registered as /dev/video10
[    8.287081] bcm2835-codec bcm2835-codec: Loaded V4L2 decode
[    8.290997] rpivid feb10000.codec: Device registered as /dev/video19
[    8.291125] sd 0:0:0:0: Attached scsi generic sg0 type 0
[    8.292658] bcm2835-codec bcm2835-codec: Device registered as /dev/video11
[    8.292720] bcm2835-codec bcm2835-codec: Loaded V4L2 encode
[    8.298147] bcm2835-isp bcm2835-isp: Device node output[0] registered as /dev/video20
[    8.300003] bcm2835-isp bcm2835-isp: Device node capture[0] registered as /dev/video21
[    8.302906] bcm2835-isp bcm2835-isp: Device node capture[1] registered as /dev/video22
[    8.303397] bcm2835-isp bcm2835-isp: Device node stats[2] registered as /dev/video23
[    8.303433] bcm2835-isp bcm2835-isp: Register output node 0 with media controller
[    8.303460] bcm2835-isp bcm2835-isp: Register capture node 1 with media controller
[    8.303491] bcm2835-isp bcm2835-isp: Register capture node 2 with media controller
[    8.303508] bcm2835-isp bcm2835-isp: Register capture node 3 with media controller
[    8.303760] bcm2835-isp bcm2835-isp: Loaded V4L2 bcm2835-isp
[    8.307612] cfg80211: Loaded X.509 cert 'sforshee: 00b28ddf47aef9cea7'
[    8.313718] cfg80211: loaded regulatory.db is malformed or signature is missing/invalid
[    8.326218] bcm2835-codec bcm2835-codec: Device registered as /dev/video12
[    8.326300] bcm2835-codec bcm2835-codec: Loaded V4L2 isp
[    8.330472] bcm2835-codec bcm2835-codec: Device registered as /dev/video18
[    8.330531] bcm2835-codec bcm2835-codec: Loaded V4L2 image_fx
[    8.337989] bcm2835-codec bcm2835-codec: Device registered as /dev/video31
[    8.338064] bcm2835-codec bcm2835-codec: Loaded V4L2 encode_image
[    8.436793] brcmfmac: F1 signature read @0x18000000=0x15264345
[    8.445784] brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
[    8.455062] usbcore: registered new interface driver brcmfmac
[    8.686663] brcmfmac: brcmf_c_preinit_dcmds: Firmware: BCM4345/6 wl0: Nov  1 2021 00:37:25 version 7.45.241 (1a2f2fa CY) FWID 01-703fd60
[    8.687080] vc4-drm gpu: bound fe400000.hvs (ops vc4_hvs_ops [vc4])
[    8.721470] Registered IR keymap rc-cec
[    8.721671] rc rc0: vc4-hdmi-0 as /devices/platform/soc/fef00700.hdmi/rc/rc0
[    8.721899] input: vc4-hdmi-0 as /devices/platform/soc/fef00700.hdmi/rc/rc0/input0
[    8.726969] vc4-drm gpu: bound fef00700.hdmi (ops vc4_hdmi_ops [vc4])
[    8.729684] Registered IR keymap rc-cec
[    8.729887] rc rc1: vc4-hdmi-1 as /devices/platform/soc/fef05700.hdmi/rc/rc1
[    8.730099] input: vc4-hdmi-1 as /devices/platform/soc/fef05700.hdmi/rc/rc1/input1
[    8.733504] vc4-drm gpu: bound fef05700.hdmi (ops vc4_hdmi_ops [vc4])
[    8.734099] vc4-drm gpu: bound fe004000.txp (ops vc4_txp_ops [vc4])
[    8.734636] vc4-drm gpu: bound fe206000.pixelvalve (ops vc4_crtc_ops [vc4])
[    8.735123] vc4-drm gpu: bound fe207000.pixelvalve (ops vc4_crtc_ops [vc4])
[    8.735558] vc4-drm gpu: bound fe20a000.pixelvalve (ops vc4_crtc_ops [vc4])
[    8.735851] vc4-drm gpu: bound fe216000.pixelvalve (ops vc4_crtc_ops [vc4])
[    8.736307] vc4-drm gpu: bound fec12000.pixelvalve (ops vc4_crtc_ops [vc4])
[    8.740278] [drm] Initialized vc4 0.0.0 20140616 for gpu on minor 1
[    8.934338] Console: switching to colour frame buffer device 100x30
[    8.953376] vc4-drm gpu: [drm] fb0: vc4drmfb frame buffer device
[   10.176225] 8021q: 802.1Q VLAN Support v1.8
[   10.525420] uart-pl011 fe201000.serial: no DMA platform data
[   10.690634] Adding 102396k swap on /var/swap.  Priority:-2 extents:5 across:232902656k SSFS
[   10.844286] brcmfmac: brcmf_cfg80211_set_power_mgmt: power save enabled
[   11.235444] bcmgenet fd580000.ethernet: configuring instance for external RGMII (RX delay)
[   11.241484] bcmgenet fd580000.ethernet eth0: Link is Down
[   15.282849] bridge: filtering via arp/ip/ip6tables is no longer available by default. Update your scripts to load br_netfilter if you need this.
[   15.286093] Bridge firewalling registered
[   15.326534] bcmgenet fd580000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx
[   15.326579] IPv6: ADDRCONF(NETDEV_CHANGE): eth0: link becomes ready
[   15.467075] Initializing XFRM netlink socket
[   16.971027] systemd-journald[141]: File /var/log/journal/fc19aee517bf4fe3ade438f1591af2df/user-1000.journal corrupted or uncleanly shut down, renaming and replacing.
[   17.499509] br-af637c9bbb91: port 1(vethf390115) entered blocking state
[   17.499532] br-af637c9bbb91: port 1(vethf390115) entered disabled state
[   17.499873] device vethf390115 entered promiscuous mode
[   17.570202] IPv6: ADDRCONF(NETDEV_CHANGE): veth8f7870a: link becomes ready
[   17.570318] IPv6: ADDRCONF(NETDEV_CHANGE): vethf390115: link becomes ready
[   17.570414] br-af637c9bbb91: port 1(vethf390115) entered blocking state
[   17.570424] br-af637c9bbb91: port 1(vethf390115) entered forwarding state
[   17.570522] IPv6: ADDRCONF(NETDEV_CHANGE): br-af637c9bbb91: link becomes ready
[   18.413149] Bluetooth: Core ver 2.22
[   18.413264] NET: Registered PF_BLUETOOTH protocol family
[   18.413273] Bluetooth: HCI device and connection manager initialized
[   18.413296] Bluetooth: HCI socket layer initialized
[   18.413308] Bluetooth: L2CAP socket layer initialized
[   18.413328] Bluetooth: SCO socket layer initialized
[   18.516062] Bluetooth: HCI UART driver ver 2.3
[   18.516094] Bluetooth: HCI UART protocol H4 registered
[   18.516184] Bluetooth: HCI UART protocol Three-wire (H5) registered
[   18.516383] Bluetooth: HCI UART protocol Broadcom registered
[   20.130862] br-af637c9bbb91: port 1(vethf390115) entered disabled state
[   20.132129] eth0: renamed from veth8f7870a
[   20.167669] br-af637c9bbb91: port 1(vethf390115) entered blocking state
[   20.167692] br-af637c9bbb91: port 1(vethf390115) entered forwarding state
[   20.581273] Bluetooth: BNEP (Ethernet Emulation) ver 1.3
[   20.581295] Bluetooth: BNEP filters: protocol multicast
[   20.581311] Bluetooth: BNEP socket layer initialized
[   20.589216] Bluetooth: MGMT ver 1.22
[   20.614584] NET: Registered PF_ALG protocol family
[   21.909348] Bluetooth: RFCOMM TTY layer initialized
[   21.909382] Bluetooth: RFCOMM socket layer initialized
[   21.909403] Bluetooth: RFCOMM ver 1.11
[   26.522368] usb 1-1.4: new low-speed USB device number 3 using xhci_hcd
[   26.629823] usb 1-1.4: New USB device found, idVendor=093a, idProduct=2510, bcdDevice= 1.00
[   26.629845] usb 1-1.4: New USB device strings: Mfr=1, Product=2, SerialNumber=0
[   26.629851] usb 1-1.4: Product: USB OPTICAL MOUSE
[   26.629856] usb 1-1.4: Manufacturer: PIXART
[   26.640788] input: PIXART USB OPTICAL MOUSE as /devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1/1-1/1-1.4/1-1.4:1.0/0003:093A:2510.0001/input/input2
[   26.641251] hid-generic 0003:093A:2510.0001: input,hidraw0: USB HID v1.11 Mouse [PIXART USB OPTICAL MOUSE] on usb-0000:01:00.0-1.4/input0
[  192.578431] usb 1-1.3: new low-speed USB device number 4 using xhci_hcd
[  192.686096] usb 1-1.3: New USB device found, idVendor=413c, idProduct=2005, bcdDevice= 1.05
[  192.686125] usb 1-1.3: New USB device strings: Mfr=1, Product=2, SerialNumber=0
[  192.686139] usb 1-1.3: Product: DELL USB Keyboard
[  192.686152] usb 1-1.3: Manufacturer: DELL
[  192.695729] input: DELL DELL USB Keyboard as /devices/platform/scb/fd500000.pcie/pci0000:00/0000:00:00.0/0000:01:00.0/usb1/1-1/1-1.3/1-1.3:1.0/0003:413C:2005.0002/input/input3
[  192.755331] hid-generic 0003:413C:2005.0002: input,hidraw1: USB HID v1.10 Keyboard [DELL DELL USB Keyboard] on usb-0000:01:00.0-1.3/input0
[  208.283462] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[  396.932193] usb 1-1.3: USB disconnect, device number 4
[  828.101864] usb 1-1.4: USB disconnect, device number 3
[  969.723396] bcmgenet fd580000.ethernet eth0: Link is Down
[ 3902.505033] bcmgenet fd580000.ethernet eth0: Link is Up - 1Gbps/Full - flow control rx/tx

EEPROM
------

BOOTLOADER: up to date
   CURRENT: Wed Jan 11 17:40:52 UTC 2023 (1673458852)
    LATEST: Wed Jan 11 17:40:52 UTC 2023 (1673458852)
   RELEASE: default (/lib/firmware/raspberrypi/bootloader/default)
            Use raspi-config to change the release.

  VL805_FW: Using bootloader EEPROM
     VL805: up to date
   CURRENT: 000138c0
    LATEST: 000138c0
#+end_example


*** ~create-dir~

#+name: create-dir
#+BEGIN_SRC bash :eval no-export :results output :var DIR="stage"
# DIR=stage
echo "Create DIR=$DIR in host='$(hostname)' on $(date)"
( [ ! -d $DIR ] && mkdir $DIR  && echo Directory $DIR created ) || echo Directory $DIR already exists 
#+END_SRC

** Code admin
*** ~src-rsync~

#+name: src-rsync
#+BEGIN_SRC bash :eval no-export :results output :dir . :var SDIR="src/" DDIR="src/"
echo "Rsync SDIR=$SDIR from host=$(hostname) to jrr5.local:$DDIR on $(date)"
CMD="rsync -a --delete --update --verbose  --checksum --recursive  $SDIR jrr5:$DDIR"
echo $CMD
ls -ltr $SDIR
$CMD
#+END_SRC


#+RESULTS: src-rsync
#+begin_example
Rsync SDIR=src/ from host=eero to jrr5.local:src/ on la 14.12.2024 22.00.52 +0200
rsync -a --delete --update --verbose --checksum --recursive src/ jrr5:src/
total 139
-rwxrwxr-x 1 jj jj     1 joulu   4 10:25 __init__.py
-rw-rw-r-- 1 jj jj  6032 joulu   9 09:55 epd2in13b_V3.py
-rw-rw-r-- 1 jj jj  5904 joulu   9 09:55 epd2in13bc.py
drwxrwxr-x 3 jj jj     3 joulu   9 12:51 lib
-rw-rw-r-- 1 jj jj 12641 joulu   9 13:02 epd2in13d.py
drwxrwxr-x 2 jj jj    17 joulu   9 13:02 pic
-rw-rw-r-- 1 jj jj  1253 joulu  10 14:22 publish_subsrcibe.py
-rw-rw-r-- 1 jj jj   108 joulu  11 12:11 pushbutton_coro.py
-rw-rw-r-- 1 jj jj  3341 joulu  12 14:11 gpio_coro.py
-rw-rw-r-- 1 jj jj 10729 joulu  12 19:03 epdconfig_async.py
-rw-rw-r-- 1 jj jj 13797 joulu  13 08:20 epd2in13d_async.py
drwxrwxr-x 2 jj jj     5 joulu  13 08:39 examples
-rw-rw-r-- 1 jj jj  6770 joulu  13 08:47 epd2in13bc_async.py
-rw-rw-r-- 1 jj jj  7576 joulu  13 08:53 epd2in13b_V3_async.py
-rw-rw-r-- 1 jj jj   369 joulu  13 11:15 apu.py
-rw-rw-r-- 1 jj jj   304 joulu  13 11:16 apu.png
-rw-rw-r-- 1 jj jj   230 joulu  13 11:54 convert.py
-rw-rw-r-- 1 jj jj  3526 joulu  13 12:35 jrr.py
-rw-rw-r-- 1 jj jj  1704 joulu  13 12:39 jrr_converter.py
-rw-rw-r-- 1 jj jj  2716 joulu  13 12:45 constants.py
-rw-rw-r-- 1 jj jj  6313 joulu  13 12:53 screen_coro.py
-rw-rw-r-- 1 jj jj  3061 joulu  13 13:54 stdin_coro.py
-rw-rw-r-- 1 jj jj    86 joulu  14 14:16 exceptions.py
-rw-rw-r-- 1 jj jj  4692 joulu  14 21:44 jrr_radio.py
-rw-rw-r-- 1 jj jj  1993 joulu  14 21:46 reader_coro.py
-rw-rw-r-- 1 jj jj  3472 joulu  14 21:52 debugger.py
drwxrwxr-x 2 jj jj    18 joulu  14 21:52 __pycache__
sending incremental file list

sent 3.098 bytes  received 17 bytes  6.230,00 bytes/sec
total size is 5.472.656  speedup is 1.756,87
#+end_example


** 3.5inch TFT demo

#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
#+END_SRC

#+RESULTS:
: Running in /home/pi host 'jrr5' on Tue Jul  1 16:01:01 EEST 2025

*** ~ILI9486-example~: Run example code

#+name: ILI9486-example
#+BEGIN_SRC bash :eval no-export :results output :var TIMEOUT="10s"
DEMO_DIR=jrr/src.init/Python_ILI9486
echo DEMO_DIR=$DEMO_DIR
echo TIMEOUT=$TIMEOUT
cd $DEMO_DIR
echo "Running in $(pwd) host '$(hostname)' on $(date)"
timeout $TIMEOUT $HOME/.venv/bin/python image.py 2>&1; true
#+END_SRC

#+RESULTS: ILI9486-example
#+begin_example
DEMO_DIR=jrr/src.init/Python_ILI9486
TIMEOUT=10s
Running in /home/pi/jrr/src.init/Python_ILI9486 host 'jrr5' on Tue Jul  1 16:01:06 EEST 2025
Initialized display with landscape mode = True and dimensions (480, 320)
Loading image...
Drawing image
Drawing partial image
Turning on inverted mode
Turning off inverted mode
Turning off display
Turning on display
Turning on idle mode
Turning off idle mode
#+end_example

** Log-management
*** ~syslog-tail~: Tail journal

   #+name: syslog-tail
   #+BEGIN_SRC elisp :noweb yes :results output :eval no-export :exports none  :var TERM_HEADER="jrr5 journalctl"
   (start-process "server" "buf-server" "xterm"  "-T" TERM_HEADER "-fa" "'Monospace'" "-fs" "12" "-hold" "-e"  "bash" "-c" "ssh jrr5 journalctl -f")
   #+END_SRC

   #+RESULTS: syslog-tail

*** ~dmesg-tail~: sorsa tail wave-2930150425.csv

   #+name: dmesg-tail
   #+BEGIN_SRC elisp :noweb yes :results output :eval no-export :exports none :var TERM_HEADER="jrr5 dmesg"
   (start-process "server" "buf-server" "xterm"  "-T" "dmesg@sorsa" "-fa" "'Monospace'" "-fs" "12" "-hold" "-e"  "bash" "-c" (concat "ssh jrr5 dmesg -w" ) )
   #+END_SRC

   #+RESULTS: dmesg-tail

   #+RESULTS: wavecsv-tail

*** ~journald-vacuum~: clean up logs

#+name: journald-vacuum
#+BEGIN_SRC bash :eval no-export :results output
echo "Running in $(pwd) host '$(hostname)' on $(date)"
sudo journalctl --flush --rotate --vacuum-time=1s
sudo journalctl --user --flush --rotate --vacuum-time=1s
#+END_SRC

#+RESULTS: journald-vacuum
: Running in /home/pi host 'jrr5' on Wed May 21 14:22:30 EEST 2025



* Notes                                                            :noexport:
** Raspberry PI audio output
:PROPERTIES:
:header-args+: :var  DURATION="60"
:END:


*** List RPI ALSA hw output devices

#+BEGIN_SRC bash :eval no-export :results output :dir /ssh:jrr5:
echo "Running in host '$(hostname)' on $(date)"
sine-gen.sh alsa-devices
#+END_SRC

#+RESULTS:
: Running in host 'jrr5' on Thu Nov 28 13:39:27 EET 2024
: ------------------------------------------------------------------
: Alsa Hardware devices
: hw:CARD=vc4hdmi,DEV=0
: hw:CARD=Headphones,DEV=0
: hw:CARD=Audio,DEV=0

*** USB-DAC, 1000Hz/1000Hz
:PROPERTIES:
:header-args+: :var  LEFT="1000"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Audio,DEV=0"
:END:

#+call: stop-gen()

#+RESULTS:

#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Audio,DEV=0"

#+call: skooppi-screenshot(IMAGE="usb-dac-1000-1000.png")

#+RESULTS:
[[file:pics-keep/usb-dac-1000-1000.png]]

*** USB-DAC, 440Hz/1000Hz
:PROPERTIES:
:header-args+: :var  LEFT="440"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Audio,DEV=0"
:END:

#+call: stop-gen()

#+RESULTS:

#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Audio,DEV=0"

#+call: skooppi-screenshot(IMAGE="usb-dac-440-1000.png")

#+RESULTS:
[[file:pics-keep/usb-dac-440-1000.png]]

*** USB-DAC, 440Hz/1000Hz/mono
:PROPERTIES:
:header-args+: :var  LEFT="440"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Audio,DEV=0"
:header-args+: :var  MONO_OR_STEREO="--mono"
:END:

#+call: stop-gen()

#+RESULTS:

#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Audio,DEV=0"

#+call: skooppi-screenshot(IMAGE="usb-dac-440-1000.png")

#+RESULTS:
[[file:pics-keep/usb-dac-440-1000.png]]

*** USB-DAC, 0Hz/1000Hz
:PROPERTIES:
:header-args+: :var  LEFT="0"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Audio,DEV=0"
:END:

#+call: stop-gen()

#+RESULTS:

#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Audio,DEV=0"

#+call: skooppi-screenshot(IMAGE="usb-dac-0-1000.png")

#+RESULTS:
[[file:pics-keep/usb-dac-0-1000.png]]

*** Headphones, 1000Hz/1000Hz
:PROPERTIES:
:header-args+: :var  LEFT="1000"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Headphones,DEV=0"
:END:

#+call: stop-gen()

#+RESULTS:

#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Headphones,DEV=0"

#+call: skooppi-screenshot(IMAGE="headphone-1000-1000.png")

#+RESULTS:
[[file:pics-keep/headphone-1000-1000.png]]

*** Headphones, 440Hz/1000Hz
:PROPERTIES:
:header-args+: :var  LEFT="440"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Headphones,DEV=0"
:END:


#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Headphones,DEV=0"

#+call: skooppi-screenshot(IMAGE="headphone-440-1000.png")

#+RESULTS:
[[file:pics-keep/headphone-440-1000.png]]

*** Headphones, 0Hz/1000Hz
:PROPERTIES:
:header-args+: :var  LEFT="0"
:header-args+: :var  RIGHT="1000"
:header-args+: :var  DEVICE="hw:CARD=Headphones,DEV=0"
:END:


#+call: sine-gen()

#+RESULTS:
: 
: "hw:CARD=Headphones,DEV=0"

#+call: skooppi-screenshot(IMAGE="headphone-0-1000.png")

#+RESULTS:
[[file:pics-keep/headphone-0-1000.png]]

** Waveshare 2.3 v3 e-paper display

- Readme [[file:bom/2024-12-09-waveshare-2_3_v3.txt]]
- Wikipage [[file:bom/2024-12-09-Waveshare-2.13inch-ePaperHAT-Wiki.pdf]]


* Fin                                                              :noexport:


** Emacs variables

#+RESULTS:

# Local Variables:
# time-stamp-line-limit: -8
# time-stamp-start: "Modified:"
# time-stamp-format: "%:y-%02m-%02d.%02H:%02M"
# time-stamp-time-zone: nil
# time-stamp-end: "; # time-stamp"
# eval: (add-hook 'before-save-hook 'time-stamp)
# org-confirm-babel-evaluate: nil
# End:
#
# Muuta
# org-cdlatex-mode: t
# eval: (cdlatex-mode)
#
# Local ebib:
# org-ref-default-bibliography: "./raspberry.bib"
# org-ref-bibliography-notes: "./raspberry-notes.org"
# org-ref-pdf-directory: "./pdf/"
# org-ref-notes-directory: "."
# bibtex-completion-notes-path: "./raspberry-notes.org"
# ebib-preload-bib-files: ("./raspberry.bib")
# ebib-notes-file: ("./raspberry-notes.org")
# reftex-default-bibliography: ("./raspberry.bib")


Modified:2025-07-03.21:20; # time-stamp
